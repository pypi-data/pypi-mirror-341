"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["25804"],{97547:function(t,e,s){s.a(t,(async function(t,n){try{s.d(e,{c:()=>f,computeStateDisplay:()=>_});s(19083),s(19423),s(61006);var i=s(96194),a=s(20382),o=s(54363),c=s(46467),r=s(64214),u=s(33570),l=s(50602),d=s(87974),m=s(73850),h=t([o,l,c,u,r]);[o,l,c,u,r]=h.then?(await h)():h;const _=(t,e,s,n,i,a,o)=>{const c=null==a?void 0:a[e.entity_id];return f(t,s,n,i,c,e.entity_id,e.attributes,void 0!==o?o:e.state)},f=(t,e,s,n,h,_,f,b)=>{if(b===i.lz||b===i.nZ)return t(`state.default.${b}`);const y=(0,m.M)(_),g="counter"===y||"number"===y||"input_number"===y;if((0,l.sJ)(f,"sensor"===y?s:[])||g){if("duration"===f.device_class&&f.unit_of_measurement&&o.a_.includes(f.unit_of_measurement))try{return(0,o.LU)(e,b,f.unit_of_measurement,null==h?void 0:h.display_precision)}catch(p){}if("monetary"===f.device_class)try{return(0,l.uf)(b,e,Object.assign({style:"currency",currency:f.unit_of_measurement,minimumFractionDigits:2},(0,l.l4)({state:b,attributes:f},h)))}catch(p){}const s=(0,l.uf)(b,e,(0,l.l4)({state:b,attributes:f},h)),n=(null==h?void 0:h.translation_key)&&t(`component.${h.platform}.entity.${y}.${h.translation_key}.unit_of_measurement`)||f.unit_of_measurement;return n?`${s}${(0,d.L)(n,e)}${n}`:s}if("datetime"===y){const t=new Date(b);return(0,r.o0)(t,e,n)}if(["date","input_datetime","time"].includes(y))try{const t=b.split(" ");if(2===t.length)return(0,r.o0)(new Date(t.join("T")),Object.assign(Object.assign({},e),{},{time_zone:a.c_.local}),n);if(1===t.length){if(b.includes("-"))return(0,c.p6)(new Date(`${b}T00:00`),Object.assign(Object.assign({},e),{},{time_zone:a.c_.local}),n);if(b.includes(":")){const t=new Date;return(0,u.mr)(new Date(`${t.toISOString().split("T")[0]}T${b}`),Object.assign(Object.assign({},e),{},{time_zone:a.c_.local}),n)}}return b}catch(v){return b}if(["button","conversation","event","image","input_button","notify","scene","stt","tag","tts","wake_word"].includes(y)||"sensor"===y&&"timestamp"===f.device_class)try{return(0,r.o0)(new Date(b),e,n)}catch(p){return b}return(null==h?void 0:h.translation_key)&&t(`component.${h.platform}.entity.${y}.${h.translation_key}.state.${b}`)||f.device_class&&t(`component.${y}.entity_component.${f.device_class}.state.${b}`)||t(`component.${y}.entity_component._.state.${b}`)||b};n()}catch(_){n(_)}}))},6280:function(t,e,s){s.a(t,(async function(t,n){try{s.d(e,{Nu:()=>k,V3:()=>H,Vk:()=>m,YA:()=>w,xS:()=>_,zP:()=>S});s(19083),s(71695),s(92745),s(61893),s(84283),s(19423),s(11740),s(92519),s(42179),s(89256),s(24931),s(88463),s(57449),s(19814),s(61006),s(39527),s(99790),s(67670),s(41360),s(13334),s(36993),s(47021);var i=s(73850),a=s(97547),o=s(47194),c=t([a]);a=(c.then?(await c)():c)[0];const r=["climate","humidifier","water_heater"],u=["climate","humidifier","input_datetime","thermostat","water_heater","person","device_tracker"],l=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],d=(t,e)=>!t.states[e]||u.includes((0,i.M)(e)),m=(t,e,s,n,i)=>{const a={type:"history/stream",entity_ids:i,start_time:s.toISOString(),end_time:n.toISOString(),minimal_response:!0,no_attributes:!i.some((e=>d(t,e)))},o=new h(t);return t.connection.subscribeMessage((t=>e(o.processMessage(t))),a)};class h{constructor(t,e){this.hass=void 0,this.hoursToShow=void 0,this.combinedHistory=void 0,this.hass=t,this.hoursToShow=e,this.combinedHistory={}}processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,s={};for(const n of Object.keys(this.combinedHistory))s[n]=[];for(const n of Object.keys(t.states))s[n]=[];for(const n of Object.keys(s)){if(n in this.combinedHistory&&n in t.states){const e=this.combinedHistory[n],i=e[e.length-1];s[n]=e.concat(t.states[n]),t.states[n][0].lu<i.lu&&(s[n]=s[n].sort(((t,e)=>t.lu-e.lu)))}else n in this.combinedHistory?s[n]=this.combinedHistory[n]:s[n]=t.states[n];if(e&&n in this.combinedHistory){const t=s[n].filter((t=>t.lu<e));if(!t.length)continue;if(s[n]=s[n].filter((t=>t.lu>=e)),s[n].length&&s[n][0].lu===e)continue;const i=t[t.length-1];i.lu=e,s[n].unshift(i)}}return this.combinedHistory=s,this.combinedHistory}}const _=(t,e,s,n,i,a=!0,o=!0)=>{const c={type:"history/stream",entity_ids:n,start_time:new Date((new Date).getTime()-3600*s*1e3).toISOString(),minimal_response:a,significant_changes_only:o,no_attributes:null!=i?i:!n.some((e=>d(t,e)))},r=new h(t,s);return t.connection.subscribeMessage((t=>e(r.processMessage(t))),c)},f=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||l.every((s=>t.attributes[s]===e.attributes[s]))),b=(t,e,s,n,i,c,r)=>{const u=[],l=c[0];for(const o of c){if(u.length>0&&o.s===u[u.length-1].state)continue;const c={};null!=r&&r.attributes.device_class&&(c.device_class=null==r?void 0:r.attributes.device_class),u.push({state_localize:(0,a.c)(t,e,[],s,n[i],i,Object.assign(Object.assign({},o.a||l.a),c),o.s),state:o.s,last_changed:1e3*(o.lc?o.lc:o.lu)})}return{name:(0,o.a)(i,(null==r?void 0:r.attributes)||l.a),entity_id:i,data:u}},y=(t,e,s,n)=>{const a=[];return Object.keys(s).forEach((t=>{const e=s[t],c=e[0],u=(0,i.M)(t),d=[];for(const s of e){let t;if(r.includes(u)){t={state:s.s,last_changed:1e3*s.lu,attributes:{}};for(const e of l)e in s.a&&(t.attributes[e]=s.a[e])}else t={state:s.s,last_changed:1e3*(s.lc?s.lc:s.lu),attributes:{}};d.length>1&&f(t,d[d.length-1])&&f(t,d[d.length-2])||d.push(t)}const m=t in n?n[t].attributes:"friendly_name"in c.a?c.a:void 0;a.push({domain:u,name:(0,o.a)(t,m||{}),entity_id:t,states:d})})),{unit:t,device_class:e,identifier:Object.keys(s).join(""),data:a}},g=["counter","input_number","number"],p=t=>g.includes(t),v=t=>"unit_of_measurement"in t||"state_class"in t,O=(t,e)=>null!=t.attributes.device_class&&e.includes(t.attributes.device_class),j=" ",w=(t,e,s,n,i=!1)=>{const a={};s.forEach((t=>{t in e&&(a[t]=e[t])}));const o={};Object.entries(a).forEach((([t,e])=>{const s=e.map((t=>({s:null!=t.mean?t.mean.toString():t.state.toString(),lc:t.start/1e3,a:{},lu:t.start/1e3})));o[t]=s}));const c=k(t,o,[],t.localize,n,i,!0);return((null==c?void 0:c.line)||[]).forEach((t=>{t.data.forEach((t=>{t.statistics=t.states,t.states=[]}))})),c},k=(t,e,s,n,a,o=!1,c=!1)=>{const r={},u=[],l={};if(new Set([...s,...Object.keys(e)]).forEach((s=>{s in e?l[s]=e[s]:t.states[s]&&(l[s]=[{s:t.states[s].state,a:t.states[s].attributes,lu:new Date(t.states[s].last_updated).getTime()/1e3}])})),!l)return{line:[],timeline:[]};Object.keys(l).forEach((e=>{var s;const d=l[e];if(0===d.length)return;const m=(0,i.M)(e),h=e in t.states?t.states[e]:void 0,_=h||p(m)?void 0:d.find((t=>t.a&&v(t.a)));let f;f=S(m,h,_,a,c)?(null==h?void 0:h.attributes.unit_of_measurement)||(null==_?void 0:_.a.unit_of_measurement)||j:{zone:n("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[m];const y={climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[m]||(null===(s=(null==h?void 0:h.attributes)||(null==_?void 0:_.a))||void 0===s?void 0:s.device_class),g=$(f,y,o);f?g&&g in r&&e in r[g]?r[g][e].push(...d):g&&(g in r||(r[g]={}),r[g][e]=d):u.push(b(n,t.locale,t.config,t.entities,e,d,h))}));return{line:Object.keys(r).map((e=>{const s=e.split("_"),n=s[0],i=s[1]||void 0;return y(n,i,r[e],t.states)})),timeline:u}},$=(t,e,s)=>s?`${t}_${e||""}`:t,S=(t,e,s,n,i=!1)=>i||p(t)||null!=e&&v(e.attributes)||null!=e&&"sensor"===t&&O(e,n)||null!=s,H=(t,e,s=!0)=>{if(!e)return t;const n=Object.assign(Object.assign({},t),{},{line:[]}),i={};for(const o of t.line){const t=$(o.unit,o.device_class,s);t&&(i[t]={historyItem:o})}for(const o of e.line){const t=$(o.unit,o.device_class,s);t&&(t in i?i[t].ltsItem=o:i[t]={ltsItem:o})}for(const{historyItem:o,ltsItem:c}of Object.values(i)){if(!o||!c){n.line.push(o||c);continue}const t=Object.assign(Object.assign({},o),{},{data:[]}),e=new Set([...o.data.map((t=>t.entity_id)),...c.data.map((t=>t.entity_id))]);for(const s of e){var a;const e=o.data.find((t=>t.entity_id===s)),n=c.data.find((t=>t.entity_id===s));if(!e||!n){t.data.push(e||n);continue}const i=(null===(a=e.states[0])||void 0===a?void 0:a.last_changed)||n.statistics[n.statistics.length-1].last_changed+1,r=[];for(const t of n.statistics){if(t.last_changed>=i)break;r.push(t)}t.data.push(0===r.length?e:Object.assign(Object.assign({},e),{},{statistics:r}))}n.line.push(t)}return n};n()}catch(r){n(r)}}))}}]);
//# sourceMappingURL=25804.fc0dc4e92e5cf2e4.js.map