"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["59060"],{57982:function(t,i,e){e.a(t,(async function(t,n){try{e.d(i,{A:()=>c});var s=e(46467),a=e(33570),o=t([s,a]);function d(t,i,e=0){return n=>{const o=new Date(n);if(e>88)return 0===o.getMonth()?`{bold|${(0,s.NC)(o,t,i)}}`:(0,s.Nh)(o,t,i);if(e>35)return 1===o.getDate()?`{bold|${(0,s.ud)(o,t,i)}}`:(0,s.ud)(o,t,i);if(e>7){const e=(0,s.ud)(o,t,i);return 1===o.getDate()?`{bold|${e}}`:e}return e>2?(0,s.U8)(o,t,i):0===o.getHours()&&0===o.getMinutes()&&0===o.getSeconds()?`{bold|${(0,s.ud)(o,t,i)}}`:(0,a.mr)(o,t,i)}}function c(t,i,e){return{formatter:d(t,i,e),rich:{bold:{fontWeight:"bold"}},hideOverlap:!0}}[s,a]=o.then?(await o)():o,n()}catch(r){n(r)}}))},53259:function(t,i,e){e.a(t,(async function(t,n){try{e.d(i,{J:()=>f,Zx:()=>y,b4:()=>v});e(28457),e(71695),e(92745),e(61893),e(5509),e(19423),e(92519),e(42179),e(89256),e(24931),e(88463),e(57449),e(19814),e(88044),e(39527),e(99790),e(41360),e(13334),e(47021);var s=e(21893),a=e(13809),o=e(38836),r=e(50602),d=e(46467),c=e(33570),u=e(57982),l=t([u,d,c,r]);function _(t,i){let e=new Date(i);return t>2&&0===e.getHours()&&(e=(0,s.b)(e,1)),e.setMinutes(0,0,0),t>35&&e.setDate(1),t>2&&e.setHours(0),e.getTime()}function v(t){return t>35?"month":t>2?"day":"hour"}function f(t,i,e,n,s,o,d,c){const l=(0,a.j)(i,t),h=void 0!==o&&void 0!==d;return{xAxis:{id:"xAxisMain",type:"time",min:t.getTime(),max:_(l,i),axisLabel:(0,u.A)(e,n,l),axisLine:{show:!1},splitLine:{show:!0},minInterval:l>=89?24192e5:l>2?864e5:void 0},yAxis:{type:"value",name:s,nameGap:5,axisLabel:{formatter:t=>(0,r.uf)(Math.abs(t),e)},splitLine:{show:!0}},grid:{top:35,bottom:10,left:10,right:10,containLabel:!0},tooltip:{trigger:"axis",formatter:t=>{if(Array.isArray(t)){const i=[],a=[];return t.forEach((t=>{var e;null!==(e=t.seriesId)&&void 0!==e&&e.startsWith("compare-")?a.push(t):i.push(t)})),[i,a].filter((t=>t.length>0)).map((t=>g(t,e,n,l,h,s,c))).join("<br><br>")}return g([t],e,n,l,h,s,c)}}}}function g(t,i,e,n,s,a,u){var l,h,_;if(!t[0].value)return"";const v=new Date(null!==(l=null===(h=t[0].value)||void 0===h?void 0:h[2])&&void 0!==l?l:null===(_=t[0].value)||void 0===_?void 0:_[0]);let f;f=n>0?`${(0,d.ud)(v,i,e)}`:`${s?`${(0,d.ud)(v,i,e)}: `:""}${(0,c.mr)(v,i,e)} â€“ ${(0,c.mr)((0,o.T)(v,1),i,e)}`;const g=`<h4 style="text-align: center; margin: 0;">${f}</h4>`;let y=0,m=0,b=0,k=0;const p=t.map((t=>{var e;const n=null===(e=t.value)||void 0===e?void 0:e[1],s=(0,r.uf)(n,i);return"0"!==s&&("bar"===t.componentSubType&&(n>0?(y+=n,m++):(b+=n,k++)),`${t.marker} ${t.seriesName}: ${s} ${a}`)})).filter(Boolean);let S="";return 0!==y&&m>1&&u&&(S+=`<br><b>${u(y)}</b>`),0!==b&&k>1&&u&&(S+=`<br><b>${u(b)}</b>`),p.length>0?`${g}${p.join("<br>")}${S}`:""}function y(t){Array.from(new Set(t.map((t=>t.data.map((t=>t[0])))).flat())).sort(((t,i)=>t-i)).forEach(((i,e)=>{const n={},s={};for(let l=t.length-1;l>=0;l--){var a,o,r,d,c;const h=t[l].data[e],_=h&&"object"==typeof h&&"value"in h?h:{value:h},v=null===(a=_.value)||void 0===a?void 0:a[0],f=null!==(o=t[l].stack)&&void 0!==o?o:"";var u;if(void 0!==v)if(v!==i)null===(u=t[l].data)||void 0===u||u.splice(e,0,{value:[i,0],itemStyle:{borderWidth:0}});else 0===(null===(r=_.value)||void 0===r?void 0:r[1])?t[l].data[e]=Object.assign(Object.assign({},_),{},{itemStyle:Object.assign(Object.assign({},_.itemStyle),{},{borderWidth:0})}):!n[f]&&(null===(d=_.value)||void 0===d?void 0:d[1])>0?(t[l].data[e]=Object.assign(Object.assign({},_),{},{itemStyle:Object.assign(Object.assign({},_.itemStyle),{},{borderRadius:[4,4,0,0]})}),n[f]=!0):!s[f]&&(null===(c=_.value)||void 0===c?void 0:c[1])<0&&(t[l].data[e]=Object.assign(Object.assign({},_),{},{itemStyle:Object.assign(Object.assign({},_.itemStyle),{},{borderRadius:[0,0,4,4]})}),s[f]=!0)}}))}[u,d,c,r]=l.then?(await l)():l,n()}catch(h){n(h)}}))},56615:function(t,i,e){e.a(t,(async function(t,n){try{e.r(i),e.d(i,{DEFAULT_DAYS_TO_SHOW:()=>p,HuiStatisticsGraphCard:()=>S});var s=e(73577),a=e(72621),o=(e(52247),e(71695),e(92745),e(40251),e(39527),e(67670),e(41360),e(47021),e(13809)),r=e(21893),d=e(57243),c=e(50778),u=e(35359),l=(e(54977),e(1118)),h=e(53259),_=e(17705),v=e(69223),f=e(93331),g=e(29401),y=t([l,h]);[l,h]=y.then?(await y)():y;let m,b,k=t=>t;const p=30;let S=(0,s.Z)([(0,c.Mo)("hui-statistics-graph-card")],(function(t,i){class n extends i{constructor(...i){super(...i),t(this)}}return{F:n,d:[{kind:"method",static:!0,key:"getConfigElement",value:async function(){return await Promise.all([e.e("46379"),e.e("24199"),e.e("78943"),e.e("67390"),e.e("19551"),e.e("17930")]).then(e.bind(e,23656)),document.createElement("hui-statistics-graph-card-editor")}},{kind:"method",static:!0,key:"getStubConfig",value:function(t,i,e){const n=(0,v.j)(t,1,i,e,["sensor"],(t=>"state_class"in t.attributes));return{type:"statistics-graph",entities:n.length?[n[0]]:[]}}},{kind:"field",decorators:[(0,c.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_statistics",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_metadata",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_unit",value:void 0},{kind:"field",key:"_entities",value(){return[]}},{kind:"field",key:"_names",value(){return{}}},{kind:"field",key:"_interval",value:void 0},{kind:"field",key:"_statTypes",value:void 0},{kind:"field",key:"_energySub",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_energyStart",value:void 0},{kind:"field",decorators:[(0,c.SB)()],key:"_energyEnd",value:void 0},{kind:"method",key:"disconnectedCallback",value:function(){(0,a.Z)(n,"disconnectedCallback",this,3)([]),this._unsubscribeEnergy(),this._interval&&(clearInterval(this._interval),this._interval=void 0)}},{kind:"method",key:"connectedCallback",value:function(){var t;(0,a.Z)(n,"connectedCallback",this,3)([]),this.hasUpdated&&(null!==(t=this._config)&&void 0!==t&&t.energy_date_selection?this._subscribeEnergy():this._setFetchStatisticsTimer())}},{kind:"method",key:"_subscribeEnergy",value:function(){var t;this._energySub||(this._energySub=(0,l.UB)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe((t=>{this._energyStart=t.start,this._energyEnd=t.end,this._getStatistics()})))}},{kind:"method",key:"_unsubscribeEnergy",value:function(){this._energySub&&(this._energySub(),this._energySub=void 0),this._energyStart=void 0,this._energyEnd=void 0}},{kind:"method",key:"getCardSize",value:function(){var t,i,e;return 5+(null!==(t=this._config)&&void 0!==t&&t.title?2:0)+(null!==(i=this._config)&&void 0!==i&&i.hide_legend?0:(null===(e=this._entities)||void 0===e?void 0:e.length)||0)}},{kind:"method",key:"getGridOptions",value:function(){return{columns:12,min_columns:6,min_rows:3}}},{kind:"method",key:"setConfig",value:function(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");const i=t.entities?(0,g.A)(t.entities,!1):[];this._entities=[],i.forEach((t=>{this._entities.push(t.entity),t.name&&(this._names[t.entity]=t.name)})),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,f.Wh)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"willUpdate",value:function(t){if((0,a.Z)(n,"willUpdate",this,3)([t]),!this._config||!t.has("_config"))return;const i=t.get("_config");if(this.hass){if(this._config.energy_date_selection&&!this._energySub)return void this._subscribeEnergy();if(!this._config.energy_date_selection&&this._energySub)return this._unsubscribeEnergy(),void this._setFetchStatisticsTimer();this._config.energy_date_selection&&this._energySub&&t.has("_config")&&(null==i?void 0:i.collection_key)!==this._config.collection_key&&(this._unsubscribeEnergy(),this._subscribeEnergy())}t.has("_config")&&(null==i?void 0:i.entities)!==this._config.entities?this._getStatisticsMetaData(this._entities).then((()=>{this._setFetchStatisticsTimer()})):!t.has("_config")||(null==i?void 0:i.stat_types)===this._config.stat_types&&(null==i?void 0:i.days_to_show)===this._config.days_to_show&&(null==i?void 0:i.period)===this._config.period&&(null==i?void 0:i.unit)===this._config.unit||this._setFetchStatisticsTimer()}},{kind:"method",key:"_setFetchStatisticsTimer",value:function(){var t;this._getStatistics(),clearInterval(this._interval),null!==(t=this._config)&&void 0!==t&&t.energy_date_selection||(this._interval=window.setInterval((()=>this._getStatistics()),this._intervalTimeout))}},{kind:"get",key:"_period",value:function(){var t,i;return null!==(t=null===(i=this._config)||void 0===i?void 0:i.period)&&void 0!==t?t:this._energyStart&&this._energyEnd?(0,h.b4)((0,o.j)(this._energyEnd,this._energyStart)):void 0}},{kind:"method",key:"render",value:function(){var t;return this.hass&&this._config?(0,d.dy)(m||(m=k` <ha-card .header="${0}"> <div class="content ${0}"> <statistics-chart .hass="${0}" .isLoadingData="${0}" .statisticsData="${0}" .metadata="${0}" .period="${0}" .chartType="${0}" .statTypes="${0}" .names="${0}" .unit="${0}" .minYAxis="${0}" .maxYAxis="${0}" .fitYData="${0}" .hideLegend="${0}" .logarithmicScale="${0}" .daysToShow="${0}" .height="${0}"></statistics-chart> </div> </ha-card> `),this._config.title,(0,u.$)({"has-header":!!this._config.title}),this.hass,!this._statistics,this._statistics,this._metadata,this._period,this._config.chart_type||"line",this._statTypes,this._names,this._unit,this._config.min_y_axis,this._config.max_y_axis,this._config.fit_y_data||!1,this._config.hide_legend||!1,this._config.logarithmic_scale||!1,this._config.days_to_show||p,null!==(t=this._config.grid_options)&&void 0!==t&&t.rows?"100%":void 0):d.Ld}},{kind:"get",key:"_intervalTimeout",value:function(){var t;return 1e3*("5minute"===(null===(t=this._config)||void 0===t?void 0:t.period)?5:60)*60}},{kind:"method",key:"_getStatisticsMetaData",value:async function(t){const i=await(0,_.Py)(this.hass,t),e={};i.forEach((t=>{e[t.statistic_id]=t})),this._metadata=e}},{kind:"method",key:"_getStatistics",value:async function(){var t;const i=null!==(t=this._energyStart)&&void 0!==t?t:(0,r.b)(new Date,24*(this._config.days_to_show||p)+1),e=this._energyEnd;try{let t;if(this._config.unit&&this._metadata){const i=Object.values(this._metadata).find((t=>(0,_.dO)(this.hass,null==t?void 0:t.statistic_id,t)===this._config.unit));i&&(t=i.unit_class,this._unit=this._config.unit)}if(!t&&this._metadata){const i=this._metadata[this._entities[0]];t=null==i?void 0:i.unit_class,this._unit=t&&(0,_.dO)(this.hass,i.statistic_id,i)||void 0}const n=t?{[t]:this._unit}:void 0,s=await(0,_.dL)(this.hass,i,e,this._entities,this._period,n,this._statTypes);this._statistics={},this._entities.forEach((t=>{t in s&&(this._statistics[t]=s[t])}))}catch(n){this._statistics=void 0}}},{kind:"field",static:!0,key:"styles",value(){return(0,d.iv)(b||(b=k`ha-card{display:flex;flex-direction:column;height:100%}.content{padding:16px;flex:1}.has-header{padding-top:0}statistics-chart{height:100%}`))}}]}}),d.oi);n()}catch(m){n(m)}}))},32424:function(t,i,e){e.d(i,{E:()=>a});var n=e(53907),s=e(18112);function a(t,i,e){const a=(0,s.Q)(t,null==e?void 0:e.in);return isNaN(i)?(0,n.L)((null==e?void 0:e.in)||t,NaN):i?(a.setDate(a.getDate()+i),a):a}},38836:function(t,i,e){e.d(i,{T:()=>a});var n=e(23711),s=e(76808);function a(t,i,e){return(0,n.n)(t,i*s.vh,e)}},23711:function(t,i,e){e.d(i,{n:()=>a});var n=e(53907),s=e(18112);function a(t,i,e){return(0,n.L)((null==e?void 0:e.in)||t,+(0,s.Q)(t)+i)}},23459:function(t,i,e){e.d(i,{z:()=>a});var n=e(53907),s=e(18112);function a(t,i,e){const a=(0,s.Q)(t,null==e?void 0:e.in);if(isNaN(i))return(0,n.L)((null==e?void 0:e.in)||t,NaN);if(!i)return a;const o=a.getDate(),r=(0,n.L)((null==e?void 0:e.in)||t,a.getTime());r.setMonth(a.getMonth()+i+1,0);return o>=r.getDate()?r:(a.setFullYear(r.getFullYear(),r.getMonth(),o),a)}},14276:function(t,i,e){e.d(i,{_:()=>s});var n=e(18112);function s(t,i){return+(0,n.Q)(t)-+(0,n.Q)(i)}},71185:function(t,i,e){e.d(i,{d:()=>d});e(71695),e(47021);var n=e(18492),s=e(18112);function a(t,i){const e=+(0,s.Q)(t)-+(0,s.Q)(i);return e<0?-1:e>0?1:e}function o(t,i,e){const[s,a]=(0,n.d)(null==e?void 0:e.in,t,i);return 12*(s.getFullYear()-a.getFullYear())+(s.getMonth()-a.getMonth())}var r=e(3938);function d(t,i,e){const[s,d,c]=(0,n.d)(null==e?void 0:e.in,t,t,i),u=a(d,c),l=Math.abs(o(d,c));if(l<1)return 0;1===d.getMonth()&&d.getDate()>27&&d.setDate(30),d.setMonth(d.getMonth()-u*l);let h=a(d,c)===-u;(0,r.h)(s)&&1===l&&1===a(s,c)&&(h=!1);const _=u*(l-+h);return 0===_?0:_}},96500:function(t,i,e){e.d(i,{i:()=>s});var n=e(18112);function s(t,i){const e=(0,n.Q)(t,null==i?void 0:i.in);return e.setHours(23,59,59,999),e}},2621:function(t,i,e){e.d(i,{V:()=>s});var n=e(18112);function s(t,i){const e=(0,n.Q)(t,null==i?void 0:i.in),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}},86319:function(t,i,e){e.d(i,{b:()=>s});var n=e(18112);function s(t,i){return 1===(0,n.Q)(t,null==i?void 0:i.in).getDate()}},3938:function(t,i,e){e.d(i,{h:()=>o});var n=e(96500),s=e(2621),a=e(18112);function o(t,i){const e=(0,a.Q)(t,null==i?void 0:i.in);return+(0,n.i)(e,i)==+(0,s.V)(e,i)}},21893:function(t,i,e){e.d(i,{b:()=>s});var n=e(38836);function s(t,i,e){return(0,n.T)(t,-i,e)}}}]);
//# sourceMappingURL=59060.cea8127d7d2c94d8.js.map