(self.webpackChunkhsfiles_jupyter=self.webpackChunkhsfiles_jupyter||[]).push([[458],{458:function(e,t,o){var i,n,l=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,l){function a(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}r((i=i.apply(e,t||[])).next())}))};i=[o,t,o(830),o(209),o(421),o(310),o(256),o(655)],n=function(e,t,o,i,n,a,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class d extends s.Widget{constructor(){super(),this.addClass("jp-SpinnerWidget");const e=new i.Spinner;this.node.appendChild(e.node)}}function c(e,t){return l(this,void 0,void 0,(function*(){const o=n.ServerConnection.makeSettings(),i=a.URLExt.join(o.baseUrl,"hydroshare",e),l=yield n.ServerConnection.makeRequest(i,t,o),s=yield l.json();if(s.response.error)throw new Error(s.response.error);return s.response}))}function u(e){e.node.style.pointerEvents="none",e.node.style.opacity="0.5",console.log("File browser disabled")}function h(e){e.node.style.pointerEvents="auto",e.node.style.opacity="1",console.log("File browser enabled")}function y(e,t,o,n,a,s,r={}){return l(this,void 0,void 0,(function*(){const l=t.currentWidget;if(l){const y=l.selectedItems().next();if(y&&y.value){const l=y.value.path,f=t.currentWidget;u(f);const p=new d,b=new i.MainAreaWidget({content:p});b.id=`spinner-${o.replace(/\s+/g,"-")}`,b.title.label="Processing...",e.shell.add(b,"main"),e.shell.currentChanged,p.node.style.display="block";try{const e=yield c(n,{method:"POST",body:JSON.stringify(Object.assign({path:l},r))});p.node.style.display="none";const t="function"==typeof a?a(e):a;console.log(t,l),yield(0,i.showDialog)({title:t,body:s(e),buttons:[i.Dialog.okButton({label:"OK"})]})}catch(e){const t=`${o} Failed:`;e instanceof Error?(console.error(t,e.message),yield(0,i.showDialog)({title:`${o} Failed`,body:`Error: ${e.message}.`,buttons:[i.Dialog.okButton({label:"OK"})]})):console.error(t,e)}finally{p.isAttached&&(p.parent=null),b.dispose(),h(f)}}}}))}const f={id:"hsfiles_jupyter:plugin",autoStart:!0,requires:[o.IFileBrowserFactory],activate:(e,t)=>{const{commands:o}=e,{tracker:n}=t;console.log("JupyterLab extension hsfiles_jupyter is activated!"),o.addCommand("upload-to-hydroshare",{label:"Upload File to HydroShare",icon:r.addIcon,execute:()=>l(void 0,void 0,void 0,(function*(){const t=n.currentWidget;if(t){const o=t.selectedItems().next();if(o&&o.value){const t=o.value.path,a=n.currentWidget;u(a);const s=new d,r=new i.MainAreaWidget({content:s});r.id="spinner-upload-to-hydroshare",r.title.label="Processing...",e.shell.add(r,"main"),e.shell.currentChanged,s.node.style.display="block",yield function(e,t,o,n,a,s){return l(this,void 0,void 0,(function*(){try{const e=yield c("status",{method:"POST",body:JSON.stringify({path:o})});if("Exists in HydroShare"===e.status||"Exists in HydroShare but they are different"===e.status||"Exists in HydroShare and they are identical"===e.status){if("Replace"===(yield(0,i.showDialog)({title:"File Already Exists",body:"This file already exists in HydroShare. Would you like to replace it?",buttons:[i.Dialog.cancelButton({label:"Cancel"}),i.Dialog.okButton({label:"Replace"})],defaultButton:0})).button.label){yield c("delete",{method:"POST",body:JSON.stringify({path:o})});const e=yield c("upload",{method:"POST",body:JSON.stringify({path:o})});yield(0,i.showDialog)({title:"File upload to HydroShare was successful",body:e.success,buttons:[i.Dialog.okButton({label:"OK"})]})}}else{const e=yield c("upload",{method:"POST",body:JSON.stringify({path:o})});yield(0,i.showDialog)({title:"File upload to HydroShare was successful",body:e.success,buttons:[i.Dialog.okButton({label:"OK"})]})}}catch(e){const t="Upload file to HydroShare Failed:";e instanceof Error?(console.error(t,e.message),yield(0,i.showDialog)({title:"Upload Failed",body:`Error: ${e.message}.`,buttons:[i.Dialog.okButton({label:"OK"})]})):console.error(t,e)}finally{a.isAttached&&(a.parent=null),s.dispose(),h(n)}}))}(0,0,t,a,s,r)}}}))}),o.addCommand("refresh-from-hydroshare",{label:"Replace with File from HydroShare",icon:r.downloadIcon,execute:()=>l(void 0,void 0,void 0,(function*(){"OK"===(yield(0,i.showDialog)({title:"Replace File",body:"Replace will overwrite the local copy of the file. Are you sure you want replace this file from HydroShare?",buttons:[i.Dialog.cancelButton({label:"Cancel"}),i.Dialog.okButton({label:"OK"})],defaultButton:0})).button.label&&(yield y(e,n,"Replace with file from HydroShare","refresh","File replace from HydroShare was successful",(e=>`${e.success}`)))}))}),o.addCommand("delete-file-from-hydroshare",{label:"Delete File in HydroShare",icon:r.closeIcon,execute:()=>l(void 0,void 0,void 0,(function*(){"OK"===(yield(0,i.showDialog)({title:"Delete File",body:"Are you sure you want to permanently delete this file in HydroShare?",buttons:[i.Dialog.cancelButton({label:"Cancel"}),i.Dialog.okButton({label:"OK"})],defaultButton:0})).button.label&&(yield y(e,n,"Delete file in HydroShare","delete","File delete in HydroShare was successful",(e=>`${e.success}`)))}))}),o.addCommand("check-file-status-with-hydroshare",{label:"Check Status of File in HydroShare",icon:r.infoIcon,execute:()=>y(e,n,"Check status of file in HydroShare","status",(e=>`File Status: ${e.status}`),(e=>`${e.success}`))}),e.contextMenu.addItem({type:"separator",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10}),e.contextMenu.addItem({command:"upload-to-hydroshare",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.1}),e.contextMenu.addItem({command:"refresh-from-hydroshare",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.2}),e.contextMenu.addItem({command:"delete-file-from-hydroshare",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.3}),e.contextMenu.addItem({command:"check-file-status-with-hydroshare",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.4}),e.contextMenu.addItem({type:"separator",selector:'.jp-DirListing-item[data-isdir="false"]',rank:10.5})}};t.default=f}.apply(t,i),void 0===n||(e.exports=n)}}]);