<!-- bedrock-server-manager/bedrock_server_manager/web/templates/api_docs.html -->
{% extends "base.html" %}

{# --- Page Title --- #}
{% block title %}API Documentation - {{ super() }}{% endblock %}

{# --- Specific Styles for API Docs --- #}
{% block head_styles %}
    {# Add specific styles for API docs elements on top of base CSS #}
<style>
    /* --- Section & Endpoint Structure --- */
    .api-section {
        margin-bottom: 35px;
        padding-bottom: 25px;
        border-bottom: 1px solid #555; /* Separator between major sections */
    }

        .api-section:last-child {
            border-bottom: none; /* No border after the last section */
        }

    .api-endpoint {
        margin-bottom: 25px;
        padding: 15px 20px;
        background-color: #3f3f3f; /* Slightly lighter background for endpoints */
        border: 1px solid #505050;
        border-radius: 0;
        position: relative; /* For potential future absolute elements if needed */
    }
    /* Don't add extra bottom margin to the last endpoint in a section */
    .api-section .api-endpoint:last-child {
        margin-bottom: 0;
    }

    /* --- Headings --- */
    h1.api-title { /* Specific style for the main H1 of this page */
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #666;
        font-size: 1.8em; /* Slightly smaller than main site title */
    }

    .api-section > h2 { /* Major section titles (Auth, Server Actions...) */
        margin-top: 0;
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 1px dashed #555;
        font-size: 1.6em;
        color: #eee;
    }

    .api-endpoint h3 { /* Endpoint title (includes method tag & path) */
        margin-top: 0;
        margin-bottom: 15px;
        display: flex; /* Align method tag and text */
        align-items: center;
        flex-wrap: wrap; /* Allow wrapping on small screens */
        gap: 10px; /* Space between tag and text */
        font-size: 1.4em;
        color: #f0f0f0;
        line-height: 1.3;
    }

    .api-endpoint h4 { /* Sub-headings within an endpoint (Auth, Body, Response...) */
        margin-top: 20px;
        margin-bottom: 8px;
        font-size: 1.1em;
        color: #ddd;
        border-bottom: 1px dotted #5f5f5f;
        padding-bottom: 5px;
        font-weight: 600;
    }

        .api-endpoint h4:first-of-type {
            margin-top: 15px; /* Reduce top margin for the very first h4 */
        }

    /* --- Method Tags --- */
    .method-tag {
        display: inline-block;
        padding: 3px 8px;
        font-size: 0.75em; /* Smaller font */
        font-weight: bold;
        line-height: 1.2;
        border-radius: 0; /* Keep sharp */
        color: #fff;
        text-transform: uppercase;
        vertical-align: middle; /* Align nicely with text */
        flex-shrink: 0; /* Prevent shrinking */
        border-width: 1px;
        border-style: solid;
    }

    .method-get { background-color: #4CAF50; border-color: #66BB6A; } /* Green */
    .method-post { background-color: #1E88E5; border-color: #42A5F5; } /* Blue */
    .method-put { background-color: #FB8C00; border-color: #FFB74D; } /* Orange */
    .method-delete { background-color: #D32F2F; border-color: #E57373; } /* Red */

    /* --- Endpoint Path --- */
    .endpoint-path {
        font-family: "Consolas", "Monaco", "Courier New", monospace;
        background-color: #4a4a4a;
        padding: 2px 6px;
        border-radius: 0;
        font-size: 0.95em;
        color: #eee;
        word-break: break-all; /* Allow long paths to wrap */
    }

    /* --- Code Blocks --- */
    .api-code-block {
        background-color: #282828; /* Darker background for contrast */
        color: #f0f0f0;
        border: 1px solid #444;
        padding: 12px 15px;
        font-family: "Consolas", "Monaco", "Courier New", monospace;
        font-size: 0.9em;
        line-height: 1.4;
        overflow-x: auto; /* Enable horizontal scroll */
        white-space: pre; /* Preserve whitespace */
        border-radius: 0;
        margin-top: 8px;
        margin-bottom: 15px;
        box-sizing: border-box;
        display: block; /* Ensure block display */
        max-width: 100%; /* Prevent overflow issues */
    }
    /* Apply to both pre and code for robustness */
    .api-endpoint pre,
    .api-endpoint .api-code-block {
        background-color: #282828;
        color: #f0f0f0;
        border: 1px solid #444;
        padding: 12px 15px;
        font-family: "Consolas", "Monaco", "Courier New", monospace;
        font-size: 0.9em;
        line-height: 1.4;
        overflow-x: auto;
        white-space: pre;
        border-radius: 0;
        margin-top: 8px;
        margin-bottom: 15px;
        box-sizing: border-box;
        display: block;
        max-width: 100%;
    }

        .api-endpoint pre > code { /* Reset padding/border if code inside pre */
            padding: 0;
            border: none;
            background: none;
            white-space: inherit; /* Inherit from pre */
            display: inline; /* Code is inline within pre */
        }
    /* Style for the back link */
    .back-to-docs-link {
        display: inline-block; /* Or block if you want it on its own line */
        margin-bottom: 1.5em;
        font-size: 0.95em;
    }

        .back-to-docs-link a {
            color: #90CAF9;
            text-decoration: none;
        }

            .back-to-docs-link a:hover {
                color: #BBDEFB;
                text-decoration: underline;
            }

    /* --- Lists & Parameters --- */
    .api-endpoint ul {
        list-style: disc;
        margin-left: 25px; /* Indent list */
        padding: 0;
        margin-top: 8px;
        margin-bottom: 15px;
    }
    .api-endpoint ol { /* Style for ordered lists */
        list-style: decimal;
        margin-left: 25px;
        padding: 0;
        margin-top: 8px;
        margin-bottom: 15px;
    }

    .api-endpoint li {
        margin-bottom: 6px;
        line-height: 1.5;
    }

        .api-endpoint li code { /* Inline code within list items */
            font-family: "Consolas", "Monaco", "Courier New", monospace;
            background-color: #4f4f4f; /* Slightly different inline code bg */
            padding: 1px 5px;
            font-size: 0.9em;
            border-radius: 0;
            color: #eee;
        }

    .param-name { /* Style for parameter names */
        font-family: "Consolas", "Monaco", "Courier New", monospace;
        font-weight: bold;
        color: #ddd;
    }

    .param-type { /* Style for parameter types (string, boolean...) */
        font-style: italic;
        color: #bbb;
        margin-left: 5px;
        font-size: 0.95em;
    }

    .param-required { /* Style for "(Required)" text */
        font-weight: normal;
        font-style: normal;
        color: #ffb74d; /* Amber color */
        font-size: 0.85em;
        margin-left: 8px;
    }

    .param-optional { /* Style for "(Optional)" text */
        font-weight: normal;
        font-style: normal;
        color: #90caf9; /* Light blue color */
        font-size: 0.85em;
        margin-left: 8px;
    }

    /* --- Responsive Adjustments (Complementary to base CSS) --- */
    @media (max-width: 768px) {
        .api-endpoint h3 {
            font-size: 1.3em;
        }

        .api-endpoint h4 {
            font-size: 1.05em;
        }

        .api-endpoint {
            padding: 12px 15px;
        }
    }

    @media (max-width: 480px) {
        .api-endpoint h3 {
            font-size: 1.2em;
            gap: 8px;
        }

        .method-tag {
            font-size: 0.7em;
            padding: 2px 6px;
        }

        .endpoint-path {
            font-size: 0.9em;
        }

        .api-endpoint h4 {
            font-size: 1em;
        }

        .api-endpoint {
            padding: 10px 12px;
        }

            .api-endpoint ul {
                margin-left: 20px;
            }

            .api-code-block, .api-endpoint pre {
                font-size: 0.85em;
                padding: 10px;
            }
    }
</style>
{% endblock %}

{# --- Main Content Area --- #}
{% block content %}
<h1 class="api-title">Bedrock Server Manager - HTTP API Documentation</h1>

    {# --- Link back to the Documentation Index --- #}
<p class="back-to-docs-link">
    <a href="{{ url_for('doc_routes.doc_index') }}">← Back to Documentation Index</a>
</p>

<p>This document outlines the available HTTP API endpoints for interacting with the Bedrock Server Manager.</p>

{# --- Introduction Section (copied from MD) --- #}
<h4>Base URL:</h4>
<p>All endpoint paths are relative to the base URL where the manager's web server is running. Replace <code class="endpoint-path">http://&lt;your-manager-host&gt;:&lt;port&gt;</code> with the actual address. The default port is <code class="endpoint-path">11325</code> (configurable via the <code class="param-name">WEB_PORT</code> setting).</p>

<h4>Authentication:</h4>
<p>Most API endpoints require authentication. This is done by providing a JSON Web Token (JWT) obtained from the <code class="endpoint-path">/api/login</code> endpoint. Include the token in the <code class="param-name">Authorization</code> header as a Bearer token:</p>
<pre><code class="api-code-block">Authorization: Bearer YOUR_JWT_TOKEN</code></pre>
<p>The token expiration duration is configurable via the <code class="param-name">TOKEN_EXPIRES_WEEKS</code> setting, defaulting to 4 weeks.</p>

<h4>Content-Type:</h4>
<p>For requests that include data in the body (POST, PUT), the <code class="param-name">Content-Type</code> header should be set to <code class="endpoint-path">application/json</code>. Responses from the API will typically have a <code class="param-name">Content-Type</code> of <code class="endpoint-path">application/json</code>.</p>

<h4>Standard Responses:</h4>
<ul>
    <li>
        <strong>Success:</strong> Typically returns HTTP status <code>200 OK</code>, <code>201 Created</code> with a JSON body like:
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Operation completed successfully.",
    "data_key": "optional_data"
}</code></pre>
        <em>(Specific <code class="param-name">data_key</code> names vary by endpoint)</em>
    </li>
    <li>
        <strong>Error:</strong> Typically returns HTTP status <code>4xx</code> (Client Error) or <code>5xx</code> (Server Error) with a JSON body like:
        <pre><code class="api-code-block">{
    "status": "error",
    "message": "A description of the error.",
    "errors": { // Optional: Field-specific validation errors
        "field_name": "Specific error for this field."
    }
}</code></pre>
        Common error codes:
        <ul>
            <li><code>400 Bad Request</code>: Invalid input, missing parameters, validation failed, invalid format (e.g., not JSON).</li>
            <li><code>401 Unauthorized</code>: Authentication token missing or invalid (for JWT protected routes).</li>
            <li><code>403 Forbidden</code>: Authenticated user lacks permission (or OS mismatch for platform-specific endpoints like scheduling).</li>
            <li><code>404 Not Found</code>: Server, task, file, or endpoint not found.</li>
            <li><code>500 Internal Server Error</code>: An unexpected error occurred on the server during processing (e.g., file operation failure, configuration issue).</li>
            <li><code>501 Not Implemented</code>: Feature not supported on the current OS (e.g., sending commands on Windows).</li>
        </ul>
    </li>
</ul>

{# --- Global Server Validation Section --- #}
<div class="api-section">
    <h2>Global Server Validation (Request Pre-Processing)</h2>
    <p>To enhance robustness and provide immediate feedback, the application implements a global pre-request validation check. This check runs <strong>before</strong> the actual route handler for most requests involving a specific server instance.</p>

    <h4>Mechanism:</h4>
    <ul>
        <li>Uses Flask's <code class="param-name">@app.before_request</code> decorator.</li>
        <li>Runs on <strong>every</strong> request received by the application.</li>
    </ul>

    <h4>Targeted URLs:</h4>
    <ul>
        <li>The validation logic specifically targets URL paths that contain the pattern <code class="endpoint-path">/server/&lt;server_name&gt;/</code>, where <code class="param-name">&lt;server_name&gt;</code> is a segment in the path.</li>
        <li>Examples: <code class="endpoint-path">/server/MyServer/status_info</code>, <code class="endpoint-path">/api/server/AnotherServer/stop</code>, <code class="endpoint-path">/server/MyServer/backups/prune</code>.</li>
    </ul>

    <h4>Bypassed URLs:</h4>
    <ul>
        <li>Certain paths are explicitly excluded from this validation check, primarily those related to server creation where the server doesn't exist yet. Currently bypassed paths start with:</li>
        <li><code class="endpoint-path">/server/install</code></li>
        <li><code class="endpoint-path">/api/server/install</code></li>
    </ul>

    <h4>Validation Process:</h4>
    <ol>
        <li>If the request path matches the target pattern (and is not bypassed), the <code class="param-name">&lt;server_name&gt;</code> segment is extracted.</li>
        <li>The internal function <code class="param-name">validate_server_exist</code> (which checks for the existence of the server's directory and executable) is called with the extracted <code class="param-name">server_name</code>.</li>
        <li>The result of <code class="param-name">validate_server_exist</code> determines the outcome.</li>
    </ol>

    <h4>Outcomes:</h4>
    <ul>
        <li><strong>Validation Success:</strong> If <code class="param-name">validate_server_exist</code> confirms the server exists (<code class="api-code-block">{"status": "success", ...}</code>), the <code class="param-name">before_request</code> handler does nothing, and the request proceeds normally to its intended route handler.</li>
        <li><strong>Validation Failure (Server Not Found):</strong> If <code class="param-name">validate_server_exist</code> indicates the server does not exist (<code class="api-code-block">{"status": "error", "message": "..."}</code>):
            <ul>
                <li><strong>For API Requests (Paths starting with <code class="endpoint-path">/api/</code>):</strong> The request is <strong>aborted</strong>, and a <strong><code>404 Not Found</code></strong> response is immediately returned with a JSON body:
                    <pre><code class="api-code-block">{
    "status": "error",
    "message": "Server '&lt;server_name&gt;' not found." // Or more specific message from validator
}</code></pre>
                </li>
                <li><strong>For Web UI Requests (Other paths):</strong> The user is <strong>redirected (<code>302 Found</code>)</strong> to the main dashboard page (<code class="endpoint-path">/</code>). A flash message containing the error (e.g., "Server '&lt;server_name&gt;' not found.") is typically displayed on the dashboard.</li>
            </ul>
        </li>
        <li><strong>Internal Validation Error:</strong> If an unexpected error occurs <em>during</em> the validation check itself (e.g., configuration error preventing validation, unexpected exception):
            <ul>
                <li>The request is <strong>aborted</strong>, and a <strong><code>500 Internal Server Error</code></strong> response is returned with a JSON body:
                    <pre><code class="api-code-block">{
    "status": "error",
    "message": "Internal server error during server validation." // Or similar generic message
}</code></pre>
                </li>
            </ul>
        </li>
        <li><strong>No Match / Bypassed:</strong> If the request path does not match the target pattern or is explicitly bypassed, the validation is skipped, and the request proceeds normally.</li>
    </ul>

    <h4>Implications for API Users:</h4>
    <ul>
        <li>Requests to API endpoints under <code class="endpoint-path">/api/server/&lt;server_name&gt;/...</code> for a server name that does not actually exist will result in an immediate <code>404 Not Found</code> response from this pre-validation step, rather than potentially reaching the endpoint handler and returning a different error.</li>
        <li>Ensure the <code class="param-name">server_name</code> used in API calls corresponds to a valid, existing server instance.</li>
    </ul>
</div>


{# --- Authentication Section --- #}
<div class="api-section">
    <h2>Authentication</h2>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/login</code> - API Login</h3>
        <p>Authenticates using username and password provided in the JSON body and returns a JWT access token upon success. Credentials must match the <code class="param-name">BEDROCK_SERVER_MANAGER_USERNAME</code> and <code class="param-name">BEDROCK_SERVER_MANAGER_PASSWORD</code> environment variables (password must be the hashed value).</p>
        <p>This endpoint is exempt from CSRF protection.</p>

        <h4>Authentication:</h4>
        <p>None required for this endpoint.</p>

        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "username": "your_web_ui_username",
    "password": "your_web_ui_password"
}</code></pre>
        <ul>
            <li><code class="param-name">username</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The username configured via the <code class="param-name">BEDROCK_SERVER_MANAGER_USERNAME</code> environment variable.</li>
            <li><code class="param-name">password</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The plain-text password corresponding to the hashed password configured via the <code class="param-name">BEDROCK_SERVER_MANAGER_PASSWORD</code> environment variable.</li>
        </ul>

        <h4>Success Response (`200 OK`):</h4>
        <p>Returns a JSON object containing the JWT access token.</p>
        <pre><code class="api-code-block">{
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</code></pre>

        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>If the request body is not valid JSON: <pre><code class="api-code-block">{"message": "Request must be JSON"}</code></pre></li>
                    <li>If the <code class="param-name">username</code> or <code class="param-name">password</code> field is missing: <pre><code class="api-code-block">{"message": "Missing username or password parameter"}</code></pre></li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul>
                    <li>If the provided username or password does not match: <pre><code class="api-code-block">{"message": "Bad username or password"}</code></pre></li>
                </ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>If the server is missing necessary configuration (env vars not set): <pre><code class="api-code-block">{"message": "Server configuration error prevents login."}</code></pre></li>
                </ul>
            </li>
        </ul>

        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block">curl -X POST -H "Content-Type: application/json" \
     -d '{"username": "your_username", "password": "your_password"}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/login</code></pre>

        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block">$body = @{ username = 'your_username'; password = 'your_password' } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/login" -Body $body -ContentType 'application/json'</code></pre>
    </div>
</div>


{# --- Server Information Section --- #}
<div class="api-section">
    <h2>Server Information</h2>

    <div class="api-endpoint">
        <h3><span class="method-tag method-get">GET</span> <code class="endpoint-path">/api/server/{server_name}/world_name</code> - Get World Name</h3>
        <p>Gets the configured world name (<code class="param-name">level-name</code> property) from the <code class="endpoint-path">server.properties</code> file for the specified server.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT via <code class="param-name">Authorization: Bearer &lt;token&gt;</code> header, or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returns the world name if found successfully.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "world_name": "Bedrock level"
}</code></pre>
        <ul>
            <li><code class="param-name">status</code>: Always "success".</li>
            <li><code class="param-name">world_name</code>: The value of the <code class="param-name">level-name</code> property from the server's <code class="endpoint-path">server.properties</code> file.</li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>If the <code class="param-name">server_name</code> is invalid (e.g., empty). Message comes from the exception (e.g., <pre><code class="api-code-block">{"status": "error", "message": "Server name cannot be empty."}</code></pre>).</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid (e.g., <pre><code class="api-code-block">{"error": "Unauthorized", "message": "Authentication required."}</code></pre>).</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>If <code class="endpoint-path">server.properties</code> not found/readable or <code class="param-name">level-name</code> missing: <pre><code class="api-code-block">{
    "status": "error",
    "message": "Failed to get world name: File not found: /path/to/servers/MyServer/server.properties"
}</code></pre> or <pre><code class="api-code-block">{
    "status": "error",
    "message": "Failed to get world name: Property 'level-name' not found in /path/to/servers/MyServer/server.properties"
}</code></pre></li>
                    <li>If base directory configuration is invalid/inaccessible: <pre><code class="api-code-block">{
    "status": "error",
    "message": "Failed to get world name: Base directory '/invalid/path' not found or accessible."
}</code></pre></li>
                    <li>If an unexpected error occurs: <pre><code class="api-code-block">{"status": "error", "message": "Unexpected error getting world name."}</code></pre></li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X GET -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/world_name</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Get -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/world_name" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-get">GET</span> <code class="endpoint-path">/api/server/{server_name}/running_status</code> - Get Running Status</h3>
        <p>Checks if the Bedrock server process for the specified server instance is currently running.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT via <code class="param-name">Authorization: Bearer &lt;token&gt;</code> header, or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returns the running status of the server.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "is_running": true
}</code></pre>
        <em>or</em>
        <pre><code class="api-code-block">{
    "status": "success",
    "is_running": false
}</code></pre>
        <ul>
            <li><code class="param-name">status</code>: Always "success".</li>
            <li><code class="param-name">is_running</code>: Boolean indicating whether the server process was found.</li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>If the <code class="param-name">server_name</code> is invalid (e.g., empty): <pre><code class="api-code-block">{"status": "error", "message": "Server name cannot be empty."}</code></pre>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>If configuration issue prevents check (e.g., invalid <code class="param-name">BASE_DIR</code>): <pre><code class="api-code-block">{"status": "error", "message": "Configuration error: Base directory '/invalid/path' not found or accessible."}</code></pre>.</li>
                    <li>If an unexpected error occurs during the process check (e.g., permissions, psutil errors): <pre><code class="api-code-block">{"status": "error", "message": "Unexpected error checking running status."}</code></pre>.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X GET -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/running_status</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Get -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/running_status" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-get">GET</span> <code class="endpoint-path">/api/server/{server_name}/config_status</code> - Get Config Status</h3>
        <p>Gets the status string stored within the server's specific configuration file (<code class="endpoint-path">config/{server_name}.json</code>). Reflects the server's intended or last known state (e.g., "Installed", "Stopped").</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returns the status string from the configuration file.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "config_status": "Installed"
}</code></pre>
        <ul>
            <li><code class="param-name">status</code>: Always "success".</li>
            <li><code class="param-name">config_status</code>: The string value from the server's JSON configuration file (might be "UNKNOWN" if missing).</li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>If <code class="param-name">server_name</code> is invalid: <pre><code class="api-code-block">{"status": "error", "message": "Server name cannot be empty."}</code></pre>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>If error accessing/reading config file (permissions, not found, invalid JSON): <pre><code class="api-code-block">{"status": "error", "message": "Error retrieving config status: File not found: /path/to/config/MyServer.json"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Error retrieving config status: Permission denied accessing /path/to/config/MyServer.json"}</code></pre>.</li>
                    <li>If unexpected error occurs: <pre><code class="api-code-block">{"status": "error", "message": "Unexpected error getting config status."}</code></pre>.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X GET -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/config_status</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Get -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/config_status" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-get">GET</span> <code class="endpoint-path">/api/server/{server_name}/version</code> - Get Installed Version</h3>
        <p>Gets the installed Bedrock server version string stored within the server's specific configuration file (<code class="endpoint-path">config/{server_name}.json</code>).</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returns the installed version string from the configuration file.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "installed_version": "1.20.81.01"
}</code></pre>
        <ul>
            <li><code class="param-name">status</code>: Always "success".</li>
            <li><code class="param-name">installed_version</code>: The string value from the server's JSON configuration file (might be "UNKNOWN").</li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>If <code class="param-name">server_name</code> is invalid: <pre><code class="api-code-block">{"status": "error", "message": "Server name cannot be empty."}</code></pre>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>If error accessing/reading config file: <pre><code class="api-code-block">{"status": "error", "message": "Error retrieving installed version: File not found: /path/to/config/MyServer.json"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Error retrieving installed version: Permission denied accessing /path/to/config/MyServer.json"}</code></pre>.</li>
                    <li>If unexpected error occurs: <pre><code class="api-code-block">{"status": "error", "message": "Unexpected error getting installed version."}</code></pre>.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X GET -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/version</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Get -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/version" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-get">GET</span> <code class="endpoint-path">/api/server/{server_name}/validate</code> - Validate Server Existence</h3>
        <p>Validates if the server directory and the main executable (<code class="endpoint-path">bedrock_server</code>) exist for the specified server name within the configured <code class="param-name">BASE_DIR</code>.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance to validate.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when both the server directory and the executable are found.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Server '&lt;server_name&gt;' exists and is valid."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>If <code class="param-name">server_name</code> is invalid: <pre><code class="api-code-block">{"status": "error", "message": "Server name cannot be empty."}</code></pre>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>404 Not Found</code>:
                <ul><li>Returned specifically when validation *fails* (directory or executable not found): <pre><code class="api-code-block">{"status": "error", "message": "Server directory '/path/to/servers/MyServer' not found."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Server executable '/path/to/servers/MyServer/bedrock_server' not found."}</code></pre>.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>If configuration issue prevents validation (e.g., invalid <code class="param-name">BASE_DIR</code>): <pre><code class="api-code-block">{"status": "error", "message": "Configuration error: Base directory '/invalid/path' not found or accessible."}</code></pre>.</li>
                    <li>If unexpected error occurs: <pre><code class="api-code-block">{"status": "error", "message": "Unexpected error validating server."}</code></pre>.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X GET -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/validate</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Get -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/validate" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-get">GET</span> <code class="endpoint-path">/api/server/{server_name}/status_info</code> - Get Server Status Info</h3>
        <p>Retrieves runtime status information for a specific server process, including running state and basic resource usage (PID, CPU, Memory, Uptime) if the process is active and accessible.</p>
        <p><em>Note on CPU Usage:</em> CPU percentage is calculated based on the change in CPU time since the last request to this endpoint for <em>any</em> server. The first request after the manager starts or after a period of inactivity will report 0.0% CPU. Subsequent calls provide a more accurate reading. Accuracy might be limited on Linux when using <code>screen</code>.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned regardless of whether the server is running or not.</p>
        <ul>
            <li>
                <strong>If Server Process is Found:</strong>
                <pre><code class="api-code-block">{
    "status": "success",
    "process_info": {
        "pid": 12345,
        "cpu_percent": 10.5,
        "memory_mb": 512.5,
        "uptime": "1:00:00"
    }
}</code></pre>
                <ul>
                    <li><code class="param-name">status</code>: "success"</li>
                    <li><code class="param-name">process_info</code> (*object*): Details of the running process (PID, CPU%, Memory MB, Uptime string).</li>
                </ul>
            </li>
            <li>
                <strong>If Server Process is Not Found / Not Running:</strong>
                <pre><code class="api-code-block">{
    "status": "success",
    "process_info": null,
    "message": "Server '&lt;server_name&gt;' is not running."
}</code></pre>
                <ul>
                    <li><code class="param-name">status</code>: "success"</li>
                    <li><code class="param-name">process_info</code>: `null`</li>
                    <li><code class="param-name">message</code>: Indicates server not running.</li>
                </ul>
            </li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>If <code class="param-name">server_name</code> is invalid: <pre><code class="api-code-block">{"status": "error", "message": "Invalid input: Server name cannot be empty."}</code></pre>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>If configuration error (e.g., invalid <code class="param-name">BASE_DIR</code>): <pre><code class="api-code-block">{"status": "error", "message": "Server configuration error: BASE_DIR setting is missing or empty in configuration."}</code></pre>.</li>
                    <li>If `psutil` is required but not installed: <pre><code class="api-code-block">{"status": "error", "message": "Error getting process info: 'psutil' is required for process monitoring."}</code></pre>.</li>
                    <li>If error retrieving process details via `psutil` (permissions, OS error): <pre><code class="api-code-block">{"status": "error", "message": "Error getting process info: Error getting process details for '&lt;server_name&gt;': ..."}</code></pre>.</li>
                    <li>If unexpected error occurs: <pre><code class="api-code-block">{"status": "error", "message": "An unexpected error occurred: &lt;original error message&gt;"}</code></pre>.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X GET -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/status_info</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Get -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/status_info" -Headers $headers</code></pre>
    </div>
</div>

{# --- Server Actions Section --- #}
<div class="api-section">
    <h2>Server Actions</h2>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/start</code> - Start Server</h3>
        <p>Starts the specified Bedrock server instance process. Uses systemd (with screen fallback) on Linux or direct process creation on Windows. Waits for confirmation that the server process is running.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance to start.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when the server process is successfully initiated and confirmed running.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Server '&lt;server_name&gt;' started successfully."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>Invalid <code class="param-name">server_name</code>: <pre><code class="api-code-block">{"status": "error", "message": "Invalid input: Server name cannot be empty."}</code></pre>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>404 Not Found</code>:
                <ul><li>Server executable not found: <pre><code class="api-code-block">{"status": "error", "message": "Server not found: Server executable 'bedrock_server.exe' not found in C:\\path\\to\\servers\\MyServer"}</code></pre>.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (e.g., invalid <code class="param-name">BASE_DIR</code>): <pre><code class="api-code-block">{"status": "error", "message": "Server configuration error: BASE_DIR setting is missing or empty in configuration."}</code></pre>.</li>
                    <li>Server already running: <pre><code class="api-code-block">{"status": "error", "message": "Failed to start server '&lt;server_name&gt;': Server '&lt;server_name&gt;' is already running."}</code></pre>.</li>
                    <li>OS-specific start failure (unsupported OS, systemd/screen error, Windows error): <pre><code class="api-code-block">{"status": "error", "message": "Failed to start server '&lt;server_name&gt;': Unsupported operating system: Darwin"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Failed to start server '&lt;server_name&gt;': Failed to start server executable 'C:\\path\\to\\bedrock_server.exe': [WinError 5] Access is denied"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Failed to start server '&lt;server_name&gt;': Failed to start server '&lt;server_name&gt;' using screen. Error: Must be connected to a terminal."}</code></pre>.</li>
                    <li>Required command not found (Linux: <code class="param-name">systemctl</code>, <code class="param-name">screen</code>): <pre><code class="api-code-block">{"status": "error", "message": "Failed to start server '&lt;server_name&gt;': Command 'screen' not found in system PATH."}</code></pre>.</li>
                    <li>Start timed out: <pre><code class="api-code-block">{"status": "error", "message": "Failed to start server '&lt;server_name&gt;': Server '&lt;server_name&gt;' failed to start within the timeout."}</code></pre>.</li>
                    <li>Unexpected error: <pre><code class="api-code-block">{"status": "error", "message": "An unexpected error occurred: &lt;original error message&gt;"}</code></pre>.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/start</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/start" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/stop</code> - Stop Server</h3>
        <p>Stops the specified running Bedrock server instance. Attempts graceful shutdown (Linux) or terminates (Windows). Waits for termination.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance to stop.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned if server stops successfully or was already stopped.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Server '&lt;server_name&gt;' stopped successfully."
}</code></pre>
        <em>or</em>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Server '&lt;server_name&gt;' was already stopped."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>Invalid <code class="param-name">server_name</code>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (e.g., invalid <code class="param-name">BASE_DIR</code>).</li>
                    <li>Sending 'stop' command failed (Linux): <pre><code class="api-code-block">{"status": "error", "message": "Failed to stop server '&lt;server_name&gt;': Error sending command: Failed to find screen session 'bedrock-&lt;server_name&gt;' to send command to."}</code></pre>.</li>
                    <li>Executable missing but process found: <pre><code class="api-code-block">{"status": "error", "message": "Server '&lt;server_name&gt;' process found but executable missing. Stop failed."}</code></pre>.</li>
                    <li>Stop timed out: <pre><code class="api-code-block">{"status": "error", "message": "Failed to stop server '&lt;server_name&gt;': Server '&lt;server_name&gt;' failed to stop within the timeout. Manual intervention may be required."}</code></pre>.</li>
                    <li>Underlying stop mechanism failed (systemd, Windows terminate): <pre><code class="api-code-block">{"status": "error", "message": "Failed to stop server '&lt;server_name&gt;': Stopping via systemctl failed (maybe service wasn't running under systemd?): ..."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Failed to stop server '&lt;server_name&gt;': Unexpected error stopping server '&lt;server_name&gt;': ..."}</code></pre>.</li>
                    <li>Required command not found (Linux: <code class="param-name">systemctl</code>, <code class="param-name">screen</code>): <pre><code class="api-code-block">{"status": "error", "message": "Failed to stop server '&lt;server_name&gt;': Command 'screen' not found in system PATH."}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
            <li><code>501 Not Implemented</code>:
                <ul><li>Attempting graceful stop on unsupported OS: <pre><code class="api-code-block">{"status": "error", "message": "Failed to stop server '&lt;server_name&gt;': Unsupported operating system: Darwin"}</code></pre>.</li></ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/stop</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/stop" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/restart</code> - Restart Server</h3>
        <p>Restarts the specified Bedrock server instance. If running, sends warning (Linux), stops, then starts. If stopped, just starts.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance to restart.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when the restart sequence completes successfully.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Server '&lt;server_name&gt;' restarted successfully."
}</code></pre>
        <em>or if initially stopped:</em>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Server '&lt;server_name&gt;' was not running and was started."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>Invalid <code class="param-name">server_name</code>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (e.g., invalid <code class="param-name">BASE_DIR</code>).</li>
                    <li><strong>Stop phase failed:</strong> (command error, timeout, OS error): <pre><code class="api-code-block">{"status": "error", "message": "Restart failed during stop phase: Failed to stop server '&lt;server_name&gt;': Server '&lt;server_name&gt;' failed to stop within the timeout. Manual intervention may be required."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Restart failed during stop phase: Failed to stop server '&lt;server_name&gt;': Error sending command: Failed to find screen session 'bedrock-&lt;server_name&gt;' to send command to."}</code></pre>.</li>
                    <li><strong>Start phase failed:</strong> (executable missing, config error, OS error, timeout): <pre><code class="api-code-block">{"status": "error", "message": "Restart failed during start phase: Failed to start server '&lt;server_name&gt;': Server executable 'bedrock_server' not found in /path/to/servers/&lt;server_name&gt;"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Restart failed during start phase: Failed to start server '&lt;server_name&gt;': Server '&lt;server_name&gt;' failed to start within the timeout."}</code></pre>.</li>
                    <li>Unexpected error during orchestration.</li>
                </ul>
            </li>
            <li><code>501 Not Implemented</code>:
                <ul><li>Underlying stop or start mechanisms not supported on OS: <pre><code class="api-code-block">{"status": "error", "message": "Restart failed during stop phase: Failed to stop server '&lt;server_name&gt;': Unsupported operating system: Darwin"}</code></pre> or start phase equivalent.</li></ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/restart</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/restart" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/send_command</code> - Send Command</h3>
        <p>Sends a command string to the specified running Bedrock server instance's console input (uses <code class="param-name">screen</code> on Linux, Named Pipes on Windows).</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the target server instance.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "command": "your server command here"
}</code></pre>
        <ul>
            <li><code class="param-name">command</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Command string to send. Must not be empty/whitespace.</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when command sent successfully (doesn't confirm server processed it).</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Command '&lt;command&gt;' sent successfully."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing, invalid, or empty <code class="param-name">command</code> field: <pre><code class="api-code-block">{"status": "error", "message": "Request body must contain a non-empty string 'command' field."}</code></pre>.</li>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>404 Not Found</code>:
                <ul><li>Server executable missing: <pre><code class="api-code-block">{"status": "error", "message": "Server not found: Server executable 'bedrock_server' not found in /path/to/servers/MyServer"}</code></pre>.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (e.g., invalid <code class="param-name">BASE_DIR</code>).</li>
                    <li>Server not running or cannot communicate: <pre><code class="api-code-block">{"status": "error", "message": "Failed to send command: Server 'MyServer' is not running."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Failed to send command: Screen session 'bedrock-MyServer' not found."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Failed to send command: Pipe '\\\\.\\pipe\\BedrockServerMyServer' does not exist. Server likely not running."}</code></pre>.</li>
                    <li>Error during command sending (screen error, pipe error): <pre><code class="api-code-block">{"status": "error", "message": "Failed to send command: Failed to send command via screen: Command '['/usr/bin/screen', '-S', 'bedrock-MyServer', '-X', 'stuff', 'list\\n']' returned non-zero exit status 1."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Failed to send command: Windows error sending command: (109, 'CreateFile', 'The pipe has been ended.')"}</code></pre>.</li>
                    <li>Required command not found (Linux: <code class="param-name">screen</code>): <pre><code class="api-code-block">{"status": "error", "message": "Failed to send command: Command 'screen' not found. Is it installed?"}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
            <li><code>501 Not Implemented</code>:
                <ul>
                    <li>Sending commands not supported on OS: <pre><code class="api-code-block">{"status": "error", "message": "Failed to send command: Sending commands not supported on Darwin"}</code></pre>.</li>
                    <li>Missing required Windows components (<code class="param-name">pywin32</code>): <pre><code class="api-code-block">{"status": "error", "message": "Failed to send command: Cannot send command on Windows: 'pywin32' module not found."}</code></pre>.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"command": "say Hello from API!"}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/send_command</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ command = 'say Hello from API!' } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/send_command" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/update</code> - Update Server</h3>
        <p>Checks for the latest Bedrock Dedicated Server version and updates the server instance if a newer version is available or if the installed version is unknown. Handles download, backup, extraction, and optionally in-game notification.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance to update.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when the update check/process completes.</p>
        <ul>
            <li>If update performed:
                <pre><code class="api-code-block">{
    "status": "success",
    "updated": true,
    "new_version": "1.20.81.01",
    "message": "Server '&lt;server_name&gt;' update process completed. New version: 1.20.81.01."
}</code></pre>
            </li>
            <li>If already up-to-date:
                <pre><code class="api-code-block">{
    "status": "success",
    "updated": false,
    "new_version": "1.20.73.02",
    "message": "Server is already up-to-date."
}</code></pre>
            </li>
        </ul>
        <ul>
            <li><code class="param-name">status</code>: Always "success".</li>
            <li><code class="param-name">updated</code> (*boolean*): `true` if a new version was installed.</li>
            <li><code class="param-name">new_version</code> (*string | null*): Version string now installed (or current if no update).</li>
            <li><code class="param-name">message</code> (*string*): Descriptive outcome message.</li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>Invalid <code class="param-name">server_name</code>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">DOWNLOAD_DIR</code>, <code class="param-name">BACKUP_DIR</code>).</li>
                    <li>Reading server config failed.</li>
                    <li>Internet connectivity check failed: <pre><code class="api-code-block">{"status": "error", "message": "Server Update failed: Failed to verify internet connectivity: No internet connection detected."}</code></pre>.</li>
                    <li>Download URL lookup failed: <pre><code class="api-code-block">{"status": "error", "message": "Server Update failed: Failed to fetch download page 'https://www.minecraft.net/en-us/download/server/bedrock': ..."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Server Update failed: Could not find a download URL matching OS 'Linux' and version type 'LATEST' on page ..."}</code></pre>.</li>
                    <li>File download failed: <pre><code class="api-code-block">{"status": "error", "message": "Server Update failed: Download failed for '&lt;download_url&gt;': 404 Client Error: Not Found for url: &lt;download_url&gt;"}</code></pre>.</li>
                    <li>Stopping server before update failed.</li>
                    <li>Backing up server before update failed.</li>
                    <li>Extracting downloaded ZIP failed (corrupt, permissions, disk full): <pre><code class="api-code-block">{"status": "error", "message": "Server Update failed: Invalid ZIP file: '/path/to/downloads/stable/bedrock-server-1.20.xx.xx.zip'. Bad magic number for file header"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Server Update failed: Error during file extraction: [Errno 13] Permission denied: '/path/to/servers/&lt;server_name&gt;/bedrock_server'"}</code></pre>.</li>
                    <li>Writing new version/status to config failed.</li>
                    <li>Restarting server after update failed (logged, doesn't usually cause API 500).</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/update</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/update" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-delete">DELETE</span> <code class="endpoint-path">/api/server/{server_name}/delete</code> - Delete Server</h3>
        <p>Permanently deletes all data associated with the specified server instance (installation, config, backups). <strong>Irreversible action.</strong> Stops the server if running.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance to delete.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when all associated data has been removed.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "All data for server '&lt;server_name&gt;' deleted successfully."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>Invalid <code class="param-name">server_name</code>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">BACKUP_DIR</code>, config path).</li>
                    <li>Stopping server before deletion failed (timeout, command error): <pre><code class="api-code-block">{"status": "error", "message": "Failed to stop server '&lt;server_name&gt;' before deletion: Failed to stop server '&lt;server_name&gt;': Server '&lt;server_name&gt;' failed to stop within the timeout. Manual intervention may be required.. Deletion aborted."}</code></pre>.</li>
                    <li>Deleting server directories failed (permissions, files in use): <pre><code class="api-code-block">{"status": "error", "message": "Error deleting server directories: Failed to completely delete server '&lt;server_name&gt;'. Failed items: installation directory '/path/to/servers/&lt;server_name&gt;' ([Errno 13] Permission denied)"}</code></pre>.</li>
                    <li>Unexpected error during stop or deletion.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X DELETE -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/delete</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Delete -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/delete" -Headers $headers</code></pre>
    </div>
</div>

{# --- Backup & Restore Section --- #}
<div class="api-section">
    <h2>Backup &amp; Restore</h2>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/export_world</code> - Export World</h3>
        <p>Triggers an export of the server's currently configured world into a <code class="endpoint-path">.mcworld</code> archive file saved in the configured <code class="param-name">BACKUP_DIR</code>.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when the world is successfully archived.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "export_file": "/path/to/configured/backups/MyServer/Bedrock_level_export_20240115_103000.mcworld",
    "message": "World exported successfully."
}</code></pre>
        <ul>
            <li><code class="param-name">status</code>: Always "success".</li>
            <li><code class="param-name">export_file</code>: Full path to the created <code class="endpoint-path">.mcworld</code> file.</li>
            <li><code class="param-name">message</code>: Confirmation message.</li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>Invalid <code class="param-name">server_name</code>.</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">BACKUP_DIR</code>).</li>
                    <li>Cannot read <code class="endpoint-path">server.properties</code> or find <code class="param-name">level-name</code>.</li>
                    <li>World directory not found: <pre><code class="api-code-block">{"status": "error", "message": "Failed to export world: World directory 'Bedrock level' not found at expected location: /path/to/servers/MyServer/worlds/Bedrock level"}</code></pre>.</li>
                    <li>Archive creation failed (disk space, permissions, zip error): <pre><code class="api-code-block">{"status": "error", "message": "Failed to export world: Failed to create world backup archive: [Errno 28] No space left on device"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Failed to export world: Cannot create target directory '/path/to/backups/MyServer': [Errno 13] Permission denied"}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/export_world</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/export_world" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/backups/prune</code> - Prune Server Backups</h3>
        <p>Deletes older backups (world, properties, json) for a specific server, keeping a specified number of newest files for each type.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server.</li></ul>
        <h4>Query Parameters:</h4> <p>None.</p>
        <h4>Request Body (<code class="endpoint-path">application/json</code>, optional):</h4>
        <pre><code class="api-code-block">{
    "keep": 10
}</code></pre>
        <ul>
            <li><code class="param-name">keep</code><span class="param-type">(integer)</span><span class="param-optional">(Optional)</span>: Number of backups of *each type* to keep. Defaults to <code class="param-name">BACKUP_KEEP</code> setting (or 3).</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when pruning completes or if no backups found.</p>
        <ul>
            <li>If pruning occurred/not needed: <pre><code class="api-code-block">{"status": "success", "message": "Backup pruning completed for server '&lt;server_name&gt;'."}</code></pre></li>
            <li>If backup directory not found: <pre><code class="api-code-block">{"status": "success", "message": "No backup directory found, nothing to prune."}</code></pre></li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                    <li>Invalid <code class="param-name">keep</code> value (not integer).</li>
                    <li>Resolved `keep` value is negative/invalid.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">BACKUP_DIR</code>).</li>
                    <li>Backup directory path exists but is not a directory.</li>
                    <li>Error determining world name (for world backup prefix).</li>
                    <li>File system errors during pruning (listing, sorting, deleting) for any type: <pre><code class="api-code-block">{"status": "error", "message": "Pruning failed for some backup types: World backups (Failed to delete all required old backups (1 deletion(s) failed). Check logs.); JSON backups (Error pruning backups in '/path/to/backups/MyServer': [Errno 13] Permission denied)"}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block"># Using default keep count
curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/backups/prune

# Specifying keep count
curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"keep": 5}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/backups/prune</code></pre>
        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block"># Using default keep count
$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/backups/prune" -Headers $headers

# Specifying keep count
$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ keep = 5 } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/backups/prune" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/backup/action</code> - Trigger Backup</h3>
        <p>Triggers a backup operation (world, specific config, or all) for the specified server. Optionally stops/starts the server if running.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <ul>
            <li>For World Backup: <pre><code class="api-code-block">{"backup_type": "world"}</code></pre></li>
            <li>For Config Backup: <pre><code class="api-code-block">{"backup_type": "config", "file_to_backup": "server.properties"}</code></pre> (Use relative path within server dir).</li>
            <li>For Full Backup: <pre><code class="api-code-block">{"backup_type": "all"}</code></pre></li>
        </ul>
        <ul>
            <li><code class="param-name">backup_type</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: `"world"`, `"config"`, or `"all"`.</li>
            <li><code class="param-name">file_to_backup</code><span class="param-type">(string)</span><span class="param-required">(Required if `backup_type` is `"config"`): Relative path of config file.</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when the specified backup completes.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "World backup completed successfully for server '&lt;server_name&gt;'."
}</code></pre>
        <em>(Message varies by type. May indicate restart error if applicable.)</em>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing/invalid <code class="param-name">backup_type</code>.</li>
                    <li>Missing/invalid <code class="param-name">file_to_backup</code> for config type.</li>
                    <li>Specified <code class="param-name">file_to_backup</code> does not exist.</li>
                    <li>Other invalid input (e.g., empty <code class="param-name">server_name</code>).</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">BACKUP_DIR</code>).</li>
                    <li>Error stopping/starting server (if applicable).</li>
                    <li>World backup failed (world name error, zip error, dir error): <pre><code class="api-code-block">{"status": "error", "message": "World backup failed: World backup failed for 'MyServer': Could not determine world name for server 'MyServer'. Cannot perform world backup."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "World backup failed: World backup failed for 'MyServer': Failed to create world backup archive: [Errno 13] Permission denied: '/path/to/backups/MyServer/world_backup_...mcworld.zip'"}</code></pre>.</li>
                    <li>Config backup failed (copy error, permissions): <pre><code class="api-code-block">{"status": "error", "message": "Config file backup for 'server.properties' failed: Failed to copy config file 'server.properties': [Errno 13] Permission denied"}</code></pre>.</li>
                    <li>"All" backup failed on any component: <pre><code class="api-code-block">{"status": "error", "message": "Full backup failed: World backup failed during full backup of 'MyServer'."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Full backup failed: Full backup completed with errors. Failed to back up config file(s): permissions.json."}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash - World Backup):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"backup_type": "world"}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/backup/action</code></pre>
        <h4>PowerShell Example (Config Backup):</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ backup_type = 'config'; file_to_backup = 'server.properties' } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/backup/action" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/restore/action</code> - Trigger Restore</h3>
        <p>Restores a server's world or a specific config file from a backup. <strong>Warning: Overwrites current files.</strong> Recommended to stop server first (API handles by default).</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "restore_type": "world", // or "config"
    "backup_file": "/full/path/to/backups/MyServer/backup_file.mcworld" // or ...properties, etc.
}</code></pre>
        <ul>
            <li><code class="param-name">restore_type</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: `"world"` or `"config"`.</li>
            <li><code class="param-name">backup_file</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Full, absolute path to backup file (must be within configured <code class="param-name">BACKUP_DIR</code>).</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when restore completes.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Restoration from 'world_backup_xyz.mcworld' (type: world) completed successfully."
}</code></pre>
        <em>(May indicate restart error if applicable.)</em>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing/invalid <code class="param-name">restore_type</code> or <code class="param-name">backup_file</code>.</li>
                    <li><code class="param-name">backup_file</code> path outside <code class="param-name">BACKUP_DIR</code>.</li>
                    <li>Other invalid input (e.g., empty <code class="param-name">server_name</code>).</li>
                    <li>Invalid config backup filename format (cannot determine original name): <pre><code class="api-code-block">{"status": "error", "message": "Config restore failed: Could not determine original filename from backup file format: 'bad_backup_name.properties'"}</code></pre>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>404 Not Found</code>:
                <ul><li>Specified <code class="param-name">backup_file</code> does not exist: <pre><code class="api-code-block">{"status": "error", "message": "Backup file not found."}</code></pre>.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">BACKUP_DIR</code>).</li>
                    <li>Error stopping/starting server (if applicable).</li>
                    <li>World restore failed (unzip error, file/dir error): <pre><code class="api-code-block">{"status": "error", "message": "World restore failed: World import failed for server 'MyServer': Failed to extract archive: Error extracting zip file /path/to/backups/MyServer/world_backup_xyz.mcworld: Bad magic number for file header"}</code></pre>.</li>
                    <li>Config restore failed (copy error, permissions): <pre><code class="api-code-block">{"status": "error", "message": "Config file restore failed: Failed to restore config file 'server.properties': [Errno 13] Permission denied"}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash - World Restore):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"restore_type": "world", "backup_file": "/full/path/to/backups/MyServer/world_backup_xyz.mcworld"}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/restore/action</code></pre>
        <h4>PowerShell Example (Config Restore):</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ restore_type = 'config'; backup_file = 'C:\full\path\to\backups\MyServer\server_backup_abc.properties' } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/restore/action" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/restore/all</code> - Trigger Restore All</h3>
        <p>Restores server world AND standard config files from their *latest* available backups. <strong>Warning: Overwrites current files.</strong> Recommended to stop server first (API handles by default).</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The unique name of the server instance.</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when restore for all components completes.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Restore all completed successfully for server '&lt;server_name&gt;'."
}</code></pre>
        <em>(May indicate restart error if applicable.)</em>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">BACKUP_DIR</code>).</li>
                    <li>Error stopping/starting server (if applicable).</li>
                    <li>Any part of the restore failed (world or config). Error message indicates failed components: <pre><code class="api-code-block">{"status": "error", "message": "Restore all failed: Restore failed for server 'MyServer'. Failed components: World (World import failed for server 'MyServer': Failed to extract archive: ...), server.properties (Failed to restore config file 'server.properties': [Errno 13] Permission denied)"}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/restore/all</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/restore/all" -Headers $headers</code></pre>
    </div>
</div>


{# --- Content Management Section --- #}
<div class="api-section">
    <h2>World &amp; Addon Management</h2>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/world/install</code> - Install World</h3>
        <p>Installs a world from a <code class="endpoint-path">.mcworld</code> file into the specified server, replacing the existing world files. File must exist in configured <code class="endpoint-path">content/worlds</code> directory. <strong>Warning: Overwrites current world.</strong> Stops/starts server if needed.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The name of the server instance.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "filename": "MyCoolWorld.mcworld"
}</code></pre>
        <em>or (with subdirectories):</em>
        <pre><code class="api-code-block">{
    "filename": "user_uploads/MyCoolWorld.mcworld"
}</code></pre>
        <ul>
            <li><code class="param-name">filename</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Path to <code class="endpoint-path">.mcworld</code> file *relative* to configured <code class="endpoint-path">content/worlds</code> directory. Path traversal blocked.</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when world file found, validated, and extracted.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "World 'MyCoolWorld.mcworld' installed successfully for server '&lt;server_name&gt;'."
}</code></pre>
        <em>(May indicate restart error if applicable.)</em>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing/invalid <code class="param-name">filename</code>.</li>
                    <li><code class="param-name">filename</code> path traversal attempt: <pre><code class="api-code-block">{"status": "error", "message": "Invalid filename: Filename must be within the allowed content directory."}</code></pre>.</li>
                    <li>Other input validation fails (e.g., empty <code class="param-name">server_name</code>).</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>404 Not Found</code>:
                <ul><li>Specified <code class="endpoint-path">.mcworld</code> file not found in <code class="endpoint-path">content/worlds</code>: <pre><code class="api-code-block">{"status": "error", "message": "Selected world file not found: /path/to/content/worlds/nonexistent.mcworld"}</code></pre>.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">CONTENT_DIR</code>).</li>
                    <li>Error stopping/starting server (if applicable).</li>
                    <li>Cannot determine target world name from <code class="endpoint-path">server.properties</code>: <pre><code class="api-code-block">{"status": "error", "message": "World installation error: World import failed: Cannot import world: Failed to get world name for server '&lt;server_name&gt;'."}</code></pre>.</li>
                    <li>World extraction failed (invalid format, disk full, permissions): <pre><code class="api-code-block">{"status": "error", "message": "World installation error: World import failed: Error extracting archive '/path/to/content/worlds/MyCoolWorld.mcworld': File is not a zip file"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "World installation error: World import failed: Failed to remove existing world directory '/path/to/servers/MyServer/worlds/Bedrock level': [Errno 13] Permission denied"}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"filename": "MyDownloadedWorld.mcworld"}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/world/install</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ filename = 'MyDownloadedWorld.mcworld' } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/world/install" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/addon/install</code> - Install Addon</h3>
        <p>Installs addon pack (<code class="endpoint-path">.mcaddon</code>/<code class="endpoint-path">.mcpack</code>) into the server. File must exist in configured <code class="endpoint-path">content/addons</code> directory. Extracts packs and updates world manifests. Stops/starts server if needed.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The name of the server instance.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "filename": "CoolBehaviorPack.mcpack"
}</code></pre>
        <em>or</em>
        <pre><code class="api-code-block">{
    "filename": "collections/AwesomeAddonCollection.mcaddon"
}</code></pre>
        <ul>
            <li><code class="param-name">filename</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Path to addon file *relative* to configured <code class="endpoint-path">content/addons</code> directory. Path traversal blocked.</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when addon found, validated, processed, and installed.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Addon 'AwesomeAddonCollection.mcaddon' installed successfully for server '&lt;server_name&gt;'."
}</code></pre>
        <em>(May indicate restart error if applicable.)</em>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing/invalid <code class="param-name">filename</code>.</li>
                    <li><code class="param-name">filename</code> path traversal attempt.</li>
                    <li>Unsupported addon extension (not <code class="endpoint-path">.mcaddon</code> or <code class="endpoint-path">.mcpack</code>): <pre><code class="api-code-block">{"status": "error", "message": "Addon installation error: Unsupported addon file type: 'MyAddon.zip'. Only .mcaddon and .mcpack are supported."}</code></pre>.</li>
                    <li>Invalid/missing <code class="endpoint-path">manifest.json</code> in addon: <pre><code class="api-code-block">{"status": "error", "message": "Addon installation error: Invalid manifest structure in /path/to/temp/..../manifest.json. Missing fields: ['uuid']"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Addon installation error: Manifest not found in pack: /path/to/temp/..."}</code></pre>.</li>
                    <li>Other input validation fails (e.g., empty <code class="param-name">server_name</code>).</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>404 Not Found</code>:
                <ul><li>Specified addon file not found in <code class="endpoint-path">content/addons</code>: <pre><code class="api-code-block">{"status": "error", "message": "Selected addon file not found: /path/to/content/addons/nonexistent.mcpack"}</code></pre>.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">CONTENT_DIR</code>).</li>
                    <li>Error stopping/starting server (if applicable).</li>
                    <li>Cannot determine target world name from <code class="endpoint-path">server.properties</code>: <pre><code class="api-code-block">{"status": "error", "message": "Addon installation error: Failed to determine world name or paths for server '&lt;server_name&gt;': Could not determine world name for server '&lt;server_name&gt;'."}</code></pre>.</li>
                    <li>Corrupted addon file (not valid zip): <pre><code class="api-code-block">{"status": "error", "message": "Addon installation error: Invalid .mcpack file (not a zip): CoolBehaviorPack.mcpack"}</code></pre>.</li>
                    <li>File system errors during extraction/installation (copying, creating dirs, updating JSONs, permissions, disk full): <pre><code class="api-code-block">{"status": "error", "message": "Addon installation error: Failed to copy behavior pack files: [Errno 13] Permission denied: '/path/to/servers/MyServer/worlds/Bedrock level/behavior_packs/CoolPack_1.0.0/script.js'"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Addon installation error: Failed to update world activation JSON 'world_resource_packs.json': Failed to write world pack JSON: world_resource_packs.json"}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"filename": "AwesomeAddonCollection.mcaddon"}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/addon/install</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ filename = 'AwesomeAddonCollection.mcaddon' } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/addon/install" -Headers $headers -Body $body</code></pre>
    </div>
</div>


{# --- Player Management Section --- #}
<div class="api-section">
    <h2>Player Management</h2>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/players/scan</code> - Scan Player Logs</h3>
        <p>Triggers a scan of all server log files (<code class="endpoint-path">server_output.txt</code>) to find player connection entries (Name, XUID) and update the central <code class="endpoint-path">players.json</code> file.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4> <p>None.</p>
        <h4>Query Parameters:</h4> <p>None.</p>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Indicates scan completion.</p>
        <ul>
            <li>If players found/updated: <pre><code class="api-code-block">{
    "status": "success", "players_found": true, "message": "Player scan completed and data saved."
}</code></pre></li>
            <li>If no new players found: <pre><code class="api-code-block">{
    "status": "success", "players_found": false, "message": "Player scan completed, no new player data found."
}</code></pre></li>
            <li>If no server directories found: <pre><code class="api-code-block">{
    "status": "success", "players_found": false, "message": "No server directories found."
}</code></pre></li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, config dir).</li>
                    <li>Errors scanning some log files (permissions): <pre><code class="api-code-block">{"status": "error", "message": "Scan completed with errors for server(s): ServerA, ServerC. Player data found in other logs was saved."}</code></pre>.</li>
                    <li>Error saving data to <code class="endpoint-path">players.json</code> (write permissions, disk full): <pre><code class="api-code-block">{"status": "error", "message": "Error saving player data to JSON: Failed to write players data to '/path/to/config/players.json': [Errno 13] Permission denied"}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/players/scan</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/players/scan" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-get">GET</span> <code class="endpoint-path">/api/server/{server_name}/allowlist</code> - Get Allowlist</h3>
        <p>Retrieves the current list of players from the server's <code class="endpoint-path">allowlist.json</code> file.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The name of the server instance.</li></ul>
        <h4>Query Parameters:</h4> <p>None.</p>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returns the list of players currently in <code class="endpoint-path">allowlist.json</code>.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "existing_players": [
        {
            "ignoresPlayerLimit": false,
            "name": "PlayerOne"
        },
        {
            "ignoresPlayerLimit": false,
            "name": "PlayerTwoXUID"
        }
    ],
    "message": "Successfully retrieved 2 players from allowlist."
}</code></pre>
        <em>or if empty/not found:</em>
        <pre><code class="api-code-block">{
    "status": "success",
    "existing_players": [],
    "message": "Successfully retrieved 0 players from allowlist."
}</code></pre>
        <ul>
            <li><code class="param-name">status</code>: Always "success".</li>
            <li><code class="param-name">existing_players</code> (*list[object]*): List of player objects (containing <code class="param-name">ignoresPlayerLimit</code> and <code class="param-name">name</code>).</li>
            <li><code class="param-name">message</code> (*string*): Indicates number retrieved.</li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, server dir not found).</li>
                    <li>Failed to read <code class="endpoint-path">allowlist.json</code> (permissions, OS error).</li>
                    <li>Invalid JSON in <code class="endpoint-path">allowlist.json</code>: <pre><code class="api-code-block">{ "status": "error", "message": "Error retrieving allowlist: Invalid JSON in allowlist file: /path/to/servers/&lt;server_name&gt;/allowlist.json" }</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X GET -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/allowlist</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
Invoke-RestMethod -Method Get -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/allowlist" -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/allowlist/add</code> - Add Players to Allowlist</h3>
        <p>Adds players to the server's <code class="endpoint-path">allowlist.json</code> file. Appends players from request if not already present (case-insensitive name check).</p>
        <p><em>Note: This is an ADD operation, not replace.</em></p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The name of the server instance.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "players": ["NewPlayer1", "AnotherPlayer"],
    "ignoresPlayerLimit": false
}</code></pre>
        <ul>
            <li><code class="param-name">players</code><span class="param-type">(list[string])</span><span class="param-required">(Required)</span>: List of player names (Gamertags) to add. Empty/invalid names ignored.</li>
            <li><code class="param-name">ignoresPlayerLimit</code><span class="param-type">(boolean)</span><span class="param-optional">(Optional, default: false)</span>: Sets this flag for all players added in this request.</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned on completion, even if no new players added.</p>
        <ul>
            <li>If new players added: <pre><code class="api-code-block">{"status": "success", "message": "Allowlist saved successfully with X player(s)."}</code></pre></li>
            <li>If no new players added: <pre><code class="api-code-block">{"status": "success", "message": "No new players provided or all provided players were duplicates/invalid."}</code></pre></li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing or non-list <code class="param-name">players</code> key.</li>
                    <li>Non-boolean <code class="param-name">ignoresPlayerLimit</code> key.</li>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, server dir not found).</li>
                    <li>Failed reading existing <code class="endpoint-path">allowlist.json</code> (permissions, invalid JSON).</li>
                    <li>Failed writing updated <code class="endpoint-path">allowlist.json</code> (permissions, disk full).</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"players": ["AdminUser", "VIP_Player"], "ignoresPlayerLimit": false}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/allowlist/add</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ players = @('AdminUser', 'VIP_Player'); ignoresPlayerLimit = $false } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/allowlist/add" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-put">PUT</span> <code class="endpoint-path">/api/server/{server_name}/permissions</code> - Update Player Permissions</h3>
        <p>Updates permission levels for players in <code class="endpoint-path">permissions.json</code>. Takes map of XUIDs to permission levels.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The name of the server instance.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "permissions": {
        "2535416409681153": "operator",
        "2535457894355891": "member",
        "2535400000000000": "visitor"
    }
}</code></pre>
        <ul>
            <li><code class="param-name">permissions</code><span class="param-type">(object)</span><span class="param-required">(Required)</span>: Object mapping player XUIDs (strings) to level strings.
                <ul><li>Valid Levels: `"visitor"`, `"member"`, `"operator"` (case-insensitive).</li></ul>
            </li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned if all valid changes applied or no valid changes submitted.</p>
        <ul>
            <li>If changes applied: <pre><code class="api-code-block">{"status": "success", "message": "Permissions updated successfully for 2 player(s) on server '&lt;server_name&gt;'."}</code></pre></li>
            <li>If no valid changes submitted: <pre><code class="api-code-block">{"status": "success", "message": "No valid permission changes submitted."}</code></pre></li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body or missing <code class="param-name">permissions</code> key.</li>
                    <li><code class="param-name">permissions</code> value is not an object.</li>
                    <li>Invalid permission level provided for one or more XUIDs: <pre><code class="api-code-block">{
    "status": "error",
    "message": "Validation failed for one or more permission levels.",
    "errors": {
        "2535411111111111": "Invalid level 'guest'. Must be one of ('visitor', 'member', 'operator')."
    }
}</code></pre></li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, server dir not found).</li>
                    <li>Failed reading/writing <code class="endpoint-path">permissions.json</code> for any player (permissions, invalid JSON, disk full). Response includes details: <pre><code class="api-code-block">{
    "status": "error",
    "message": "One or more errors occurred while setting permissions for '&lt;server_name&gt;'.",
    "errors": {
        "2535457894355891": "Failed to configure permission: Failed to write permissions file: /path/to/servers/&lt;server_name&gt;/permissions.json"
    }
}</code></pre></li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X PUT -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"permissions": {"2535416409681153": "operator", "2535457894355891": "member"}}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/permissions</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$permBody = @{
    permissions = @{
        '2535416409681153' = 'operator'
        '2535457894355891' = 'member'
    }
}
$bodyJson = $permBody | ConvertTo-Json -Depth 3
Invoke-RestMethod -Method Put -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/permissions" -Headers $headers -Body $bodyJson</code></pre>
    </div>
</div>


{# --- Configuration Section --- #}
<div class="api-section">
    <h2>Configuration</h2>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/properties</code> - Update Server Properties</h3>
        <p>Updates specified key-value pairs in the <code class="endpoint-path">server.properties</code> file. Only allowed keys are modified. Values undergo basic validation. <code class="param-name">level-name</code> is automatically cleaned.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The name of the server instance.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <p>JSON object mapping property keys to new values.</p>
        <pre><code class="api-code-block">{
    "level-name": "Updated World Name",
    "max-players": "20",
    "difficulty": "hard",
    "server-port": 19133
    // Only include keys you want to change
}</code></pre>
        <p><strong>Allowed Keys:</strong> <code class="param-name">server-name</code>, <code class="param-name">level-name</code>, <code class="param-name">gamemode</code>, <code class="param-name">difficulty</code>, <code class="param-name">allow-cheats</code>, <code class="param-name">max-players</code>, <code class="param-name">server-port</code>, <code class="param-name">server-portv6</code>, <code class="param-name">enable-lan-visibility</code>, <code class="param-name">allow-list</code>, <code class="param-name">default-player-permission-level</code>, <code class="param-name">view-distance</code>, <code class="param-name">tick-distance</code>, <code class="param-name">level-seed</code>, <code class="param-name">online-mode</code>, <code class="param-name">texturepack-required</code>. (Other keys ignored).</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when properties successfully validated/written or if no valid/allowed changes provided.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Server properties for '&lt;server_name&gt;' updated successfully."
}</code></pre>
        <em>or if no valid changes:</em>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "No valid properties provided or no changes needed."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Validation failed for one or more values. Response includes <code class="param-name">errors</code> object: <pre><code class="api-code-block">{
    "status": "error",
    "message": "Validation failed for one or more properties.",
    "errors": {
        "server-port": "Invalid value for 'server-port'. Must be a number between 1024 and 65535.",
        "difficulty": "Invalid value for 'difficulty'. Must be one of peaceful, easy, normal, hard."
    }
}</code></pre></li>
                    <li><code class="endpoint-path">server.properties</code> file not found.</li>
                    <li>Input value contains invalid control characters.</li>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Reading/writing <code class="endpoint-path">server.properties</code> failed (permissions, disk full): <pre><code class="api-code-block">{"status": "error", "message": "Error updating properties: Failed to modify server.properties: [Errno 13] Permission denied: '/path/to/servers/&lt;server_name&gt;/server.properties'"}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"max-players": "12", "allow-list": "true"}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/properties</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
# Note: Quotes may be needed around keys with hyphens depending on PowerShell version/parsing
$body = @{ 'max-players' = '12'; 'allow-list' = 'true' } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/properties" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/service</code> - Configure OS Service Settings</h3>
        <p>Configures OS-specific service settings (Linux: systemd service/timer; Windows: <code class="param-name">autoupdate</code> flag in config). Behavior depends on host OS.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: The name of the server instance.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <ul>
            <li>
                <strong>On Linux:</strong>
                <pre><code class="api-code-block">{
    "autoupdate": true,
    "autostart": true
}</code></pre>
                <ul>
                    <li><code class="param-name">autoupdate</code><span class="param-type">(boolean)</span><span class="param-required">(Required)</span>: Configure systemd service <code class="param-name">ExecStartPre</code> for update check.</li>
                    <li><code class="param-name">autostart</code><span class="param-type">(boolean)</span><span class="param-required">(Required)</span>: Enable/disable the systemd service (<code class="param-name">systemctl --user enable/disable</code>).</li>
                </ul>
            </li>
            <li>
                <strong>On Windows:</strong>
                <pre><code class="api-code-block">{
    "autoupdate": true
}</code></pre>
                <ul>
                    <li><code class="param-name">autoupdate</code><span class="param-type">(boolean)</span><span class="param-required">(Required)</span>: Value for <code class="param-name">autoupdate</code> setting in server's JSON config file.</li>
                </ul>
            </li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when OS-specific configuration applied.</p>
        <ul>
            <li>Linux: <pre><code class="api-code-block">{"status": "success", "message": "Systemd service created and enabled successfully."}</code></pre> <em>(Message varies)</em></li>
            <li>Windows: <pre><code class="api-code-block">{"status": "success", "message": "Autoupdate setting for '&lt;server_name&gt;' updated to true."}</code></pre> <em>(Message varies)</em></li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Incorrect boolean values for expected keys (OS-specific).</li>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>403 Forbidden</code> / <code>500 Internal Server Error</code> (OS Mismatch):
                <ul><li>Endpoint called on unsupported OS: <pre><code class="api-code-block">{ "status": "error", "message": "Service configuration is not supported on this operating system (Darwin)." }</code></pre>.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>).</li>
                    <li><strong>Linux:</strong> Creating systemd dir/writing service file failed (permissions, disk full).</li>
                    <li><strong>Linux:</strong> <code class="param-name">systemctl</code> command not found.</li>
                    <li><strong>Linux:</strong> Reloading systemd daemon failed.</li>
                    <li><strong>Linux:</strong> Enabling/disabling service via <code class="param-name">systemctl</code> failed.</li>
                    <li><strong>Windows:</strong> Writing <code class="param-name">autoupdate</code> flag to config JSON failed.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash - Linux):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"autoupdate": true, "autostart": true}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/service</code></pre>
        <h4>PowerShell Example (Windows):</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ autoupdate = $true } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/&lt;server_name&gt;/service" -Headers $headers -Body $body</code></pre>
    </div>
</div>


{# --- Downloads Section --- #}
<div class="api-section">
    <h2>Downloads</h2>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/downloads/prune</code> - Prune Download Cache</h3>
        <p>Deletes older downloaded server archives (e.g., <code class="endpoint-path">bedrock-server-*.zip</code>) from a specified directory, keeping a defined number of newest files.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4> <p>None.</p>
        <h4>Query Parameters:</h4> <p>None.</p>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "directory": "/path/to/your/download/cache",
    "keep": 5
}</code></pre>
        <ul>
            <li><code class="param-name">directory</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Absolute path to directory containing downloads to prune.</li>
            <li><code class="param-name">keep</code><span class="param-type">(integer)</span><span class="param-optional">(Optional)</span>: Number of newest files to retain. Defaults to <code class="param-name">DOWNLOAD_KEEP</code> setting (or 3).</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Indicates pruning completed successfully.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Download cache pruned successfully for '/path/to/your/download/cache'."
}</code></pre>
        <em>(Message doesn't detail counts currently.)</em>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing <code class="param-name">directory</code> field.</li>
                    <li><code class="param-name">keep</code> value is not an integer.</li>
                    <li><code class="param-name">directory</code> value is empty string.</li>
                    <li>Resolved `keep` value is negative/invalid.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Specified `directory` does not exist or is not a directory.</li>
                    <li>Error accessing/deleting files (permissions, disk errors): <pre><code class="api-code-block">{"status": "error", "message": "Failed to prune downloads: Failed to delete old server download '/path/to/cache/bedrock-server-old.zip': [Errno 13] Permission denied"}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Failed to prune downloads: Failed to delete all required old downloads (1 failed). Check logs."}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4> <pre><code class="api-code-block">curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"directory": "/opt/bedrock-server-manager/.downloads/stable", "keep": 3}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/downloads/prune</code></pre>
        <h4>PowerShell Example:</h4> <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ directory = 'C:\bedrock-server-manager\.downloads\stable'; keep = 3 } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/downloads/prune" -Headers $headers -Body $body</code></pre>
    </div>
</div>


{# --- Server Installation Section --- #}
<div class="api-section">
    <h2>Server Installation</h2>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/install</code> - Install New Server</h3>
        <p>Creates and installs a new Bedrock server instance. Validates name/version, handles optional overwrite, downloads, extracts, and sets up initial config.</p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Path Parameters:</h4> <p>None.</p>
        <h4>Query Parameters:</h4> <p>None.</p>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "server_name": "UniqueServerName",
    "server_version": "LATEST",
    "overwrite": false
}</code></pre>
        <ul>
            <li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Desired unique name (valid directory name, no spaces/special chars except <code class="param-name">-</code> <code class="param-name">_</code>).</li>
            <li><code class="param-name">server_version</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Version to install (<code class="param-name">"LATEST"</code>, <code class="param-name">"PREVIEW"</code>, or specific version <code class="param-name">"1.20.81.01"</code>).</li>
            <li><code class="param-name">overwrite</code><span class="param-type">(boolean)</span><span class="param-optional">(Optional, default: false)</span>: If `true`, deletes existing server data first.</li>
        </ul>
        <h4>Success Responses:</h4>
        <ul>
            <li><strong>`201 Created`</strong> (New server installed or overwritten):
                <pre><code class="api-code-block">{
    "status": "success",
    "server_name": "UniqueServerName",
    "version": "1.20.81.01", // Actual version installed
    "message": "Server 'UniqueServerName' installed successfully (Version: 1.20.81.01).",
    "next_step_url": "/server/UniqueServerName/configure_properties?new_install=true" // For UI flow
}</code></pre>
                <em>(Message might indicate final status config write failure even on success.)</em>
            </li>
            <li><strong>`200 OK` (Confirmation Needed)</strong> (Server exists, `overwrite` is false):
                <pre><code class="api-code-block">{
    "status": "confirm_needed",
    "message": "Server 'UniqueServerName' already exists. Overwrite existing data and reinstall?",
    "server_name": "UniqueServerName",
    "server_version": "LATEST" // Original requested version
}</code></pre>
            </li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing/invalid <code class="param-name">server_name</code> or <code class="param-name">server_version</code>.</li>
                    <li><code class="param-name">overwrite</code> field not boolean.</li>
                    <li>Invalid <code class="param-name">server_name</code> format: <pre><code class="api-code-block">{"status": "error", "message": "Server name format is invalid: Cannot contain spaces."}</code></pre>.</li>
                    <li>Other input validation failures.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing <code class="param-name">BASE_DIR</code>, <code class="param-name">DOWNLOAD_DIR</code>, <code class="param-name">BACKUP_DIR</code>, config path).</li>
                    <li>`overwrite` true but deleting existing data failed.</li>
                    <li>Writing initial server config failed.</li>
                    <li>Any step of download/install failed (connectivity, URL lookup, download, extraction, final config write): <pre><code class="api-code-block">{"status": "error", "message": "Server Installation failed: Failed to fetch download page ..."}</code></pre> or <pre><code class="api-code-block">{"status": "error", "message": "Server Installation failed: Failed to extract server files ..."}</code></pre>.</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block"># Install new server (will fail if exists unless overwrite: true)
curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"server_name": "MySurvivalServer", "server_version": "LATEST", "overwrite": false}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/install

# Force overwrite existing server
curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"server_name": "MySurvivalServer", "server_version": "LATEST", "overwrite": true}' \
     http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/install</code></pre>
        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block"># Install new server
$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ server_name = 'MySurvivalServer'; server_version = 'LATEST'; overwrite = $false } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/install" -Headers $headers -Body $body

# Force overwrite existing server
$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$body = @{ server_name = 'MySurvivalServer'; server_version = 'LATEST'; overwrite = $true } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/install" -Headers $headers -Body $body</code></pre>
    </div>
</div>


{# --- Scheduled Tasks Section --- #}
<div class="api-section">
    <h2>Task Scheduler (OS Specific)</h2>
    <p><em>Note: These endpoints interact with Linux <code>cron</code> or Windows Task Scheduler based on the host OS.</em></p>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/cron_scheduler/add</code> - Add Cron Job (Linux Only)</h3>
        <p>Adds a new cron job entry to the crontab of the user running the manager. <strong>Linux only.</strong></p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Platform:</h4> <p>Linux Only.</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Server context (logging/auth), not usually part of the cron command itself.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "new_cron_job": "0 3 * * * /path/to/bedrock-server-manager backup-all --server MyServer"
}</code></pre>
        <ul>
            <li><code class="param-name">new_cron_job</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Complete, raw cron job line string. Must not be empty/whitespace.</li>
        </ul>
        <h4>Success Response (`201 Created`):</h4>
        <p>Returned when cron job line successfully added.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Cron job added successfully."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing/invalid/empty <code class="param-name">new_cron_job</code> field.</li>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>403 Forbidden</code>:
                <ul><li>Request made on non-Linux OS.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li><code class="param-name">crontab</code> command not found.</li>
                    <li>Reading/writing crontab failed (permissions, OS errors).</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block"># Note: Ensure command path/server name in cron string are correct
CRON_LINE="0 4 * * * /usr/local/bin/bedrock-server-manager restart-server --server MyProdServer"
curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d "{\"new_cron_job\": \"$CRON_LINE\"}" \
     "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyProdServer/cron_scheduler/add"</code></pre>
        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block"># Note: Linux-only endpoint. Sends request assuming target is Linux.
$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$cronLine = "0 4 * * * /usr/local/bin/bedrock-server-manager restart-server --server MyProdServer"
$body = @{ new_cron_job = $cronLine } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyProdServer/cron_scheduler/add" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/cron_scheduler/modify</code> - Modify Cron Job (Linux Only)</h3>
        <p>Modifies an existing cron job by replacing the exact line matching <code class="param-name">old_cron_job</code> with <code class="param-name">new_cron_job</code>. <strong>Linux only.</strong></p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Platform:</h4> <p>Linux Only.</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Server context.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "old_cron_job": "0 3 * * * /path/to/old_command --args",
    "new_cron_job": "0 4 * * * /path/to/new_command --newargs"
}</code></pre>
        <ul>
            <li><code class="param-name">old_cron_job</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Exact, complete, existing cron line to find/replace.</li>
            <li><code class="param-name">new_cron_job</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: New, complete cron line to replace with.</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when replacement successful or if old/new identical.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Cron job modified successfully."
}</code></pre>
        <em>or if no change:</em>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "No modification needed, jobs are identical."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing/invalid/empty <code class="param-name">old_cron_job</code> or <code class="param-name">new_cron_job</code>.</li>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>403 Forbidden</code>:
                <ul><li>Request made on non-Linux OS.</li></ul>
            </li>
            <li><code>404 Not Found</code>:
                <ul><li>Exact <code class="param-name">old_cron_job</code> string not found in crontab.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li><code class="param-name">crontab</code> command not found.</li>
                    <li>Reading/writing crontab failed (permissions, OS errors).</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block">OLD_CRON="0 3 * * * /path/to/cmd --old"
NEW_CRON="0 4 * * * /path/to/cmd --new"
curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d "{\"old_cron_job\": \"$OLD_CRON\", \"new_cron_job\": \"$NEW_CRON\"}" \
     "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyServer/cron_scheduler/modify"</code></pre>
        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block"># Note: Linux-only endpoint.
$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$oldCron = "0 3 * * * /path/to/cmd --old"
$newCron = "0 4 * * * /path/to/cmd --new"
$body = @{ old_cron_job = $oldCron; new_cron_job = $newCron } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyServer/cron_scheduler/modify" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-delete">DELETE</span> <code class="endpoint-path">/api/server/{server_name}/cron_scheduler/delete</code> - Delete Cron Job (Linux Only)</h3>
        <p>Deletes a specific cron job line from the user's crontab by exact string match. <strong>Linux only.</strong></p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Platform:</h4> <p>Linux Only.</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Server context.</li></ul>
        <h4>Query Parameters:</h4>
        <ul><li><code class="param-name">cron_string</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Exact, complete cron line to delete (URL-encoded).</li></ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned on completion, even if string wasn't found (idempotent).</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Cron job deleted successfully (if it existed)."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Missing/empty <code class="param-name">cron_string</code> query parameter.</li>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>403 Forbidden</code>:
                <ul><li>Request made on non-Linux OS.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li><code class="param-name">crontab</code> command not found.</li>
                    <li>Reading/writing crontab failed (permissions, OS errors).</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block"># URL Encode the cron string (example using Python)
CRON_STRING_URLENCODED=$(python3 -c 'import urllib.parse; print(urllib.parse.quote_plus("0 4 * * * /path/to/bedrock-server-manager backup-all --server MyProdServer"))')

curl -X DELETE -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyServer/cron_scheduler/delete?cron_string=${CRON_STRING_URLENCODED}"</code></pre>
        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block"># Note: Linux-only endpoint.
$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
$cronString = "0 4 * * * /path/to/bedrock-server-manager backup-all --server MyProdServer"
# Use appropriate URL encoding method
$encodedCronString = [System.Web.HttpUtility]::UrlEncode($cronString) # .NET Framework example
# $encodedCronString = [uri]::EscapeDataString($cronString) # PowerShell Core example
$uri = "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyServer/cron_scheduler/delete?cron_string=$encodedCronString"
Invoke-RestMethod -Method Delete -Uri $uri -Headers $headers</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/task_scheduler/add</code> - Add Windows Task (Windows Only)</h3>
        <p>Creates a new scheduled task in Windows Task Scheduler to run a manager command. Generates/imports task XML. <strong>Windows only.</strong></p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Platform:</h4> <p>Windows Only.</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Server context for the task (used in command args and XML path).</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "command": "backup-all",
    "triggers": [
        {
            "type": "Daily",
            "start": "2024-01-16T03:00:00",
            "interval": 1
        },
        {
            "type": "Weekly",
            "start": "2024-01-20T05:00:00",
            "interval": 2,
            "days": ["Saturday", "Sunday"]
        }
    ]
}</code></pre>
        <ul>
            <li><code class="param-name">command</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Manager command (<code class="param-name">"update-server"</code>, <code class="param-name">"backup-all"</code>, <code class="param-name">"start-server"</code>, <code class="param-name">"stop-server"</code>, <code class="param-name">"restart-server"</code>, <code class="param-name">"scan-players"</code>).</li>
            <li><code class="param-name">triggers</code><span class="param-type">(list[object])</span><span class="param-required">(Required)</span>: Non-empty list of trigger definitions. Each needs:
                <ul>
                    <li><code class="param-name">type</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Supported types (e.g., <code class="param-name">"Daily"</code>, <code class="param-name">"Weekly"</code>, <code class="param-name">"Monthly"</code>, <code class="param-name">"TimeTrigger"</code>, <code class="param-name">"LogonTrigger"</code>).</li>
                    <li><code class="param-name">start</code><span class="param-type">(string)</span><span class="param-required">(Required for time-based)</span>: ISO 8601 format (e.g., <code class="param-name">YYYY-MM-DDTHH:MM:SS</code>).</li>
                    <li><code class="param-name">interval</code><span class="param-type">(integer)</span><span class="param-optional">(Optional, default: 1)</span>: For <code class="param-name">Daily</code>/<code class="param-name">Weekly</code>.</li>
                    <li><code class="param-name">days</code><span class="param-type">(list[string|integer])</span><span class="param-required">(Required for `Weekly`)</span>: Days (<code class="param-name">"Monday"</code>, <code class="param-name">"Mon"</code>, `1`).</li>
                    <li><code class="param-name">months</code><span class="param-type">(list[string|integer])</span><span class="param-required">(Required for `Monthly`)</span>: Months (<code class="param-name">"January"</code>, <code class="param-name">"Jan"</code>, `1`).</li>
                    <li><code class="param-name">days_of_month</code><span class="param-type">(list[string|integer])</span><span class="param-required">(Required for `Monthly`)</span>: Day numbers (1-31).</li>
                </ul>
            </li>
        </ul>
        <h4>Success Response (`201 Created`):</h4>
        <p>Returned when task XML generated and imported successfully. Includes task name.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Windows task '&lt;generated_task_name&gt;' created successfully.",
    "created_task_name": "bedrock_MyWinServer_backup-all_20240115_103000"
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Invalid/missing <code class="param-name">command</code>.</li>
                    <li>Missing/empty/invalid <code class="param-name">triggers</code> list or objects (type, start, days, etc.).</li>
                    <li>Invalid <code class="param-name">server_name</code>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>403 Forbidden</code>:
                <ul><li>Request made on non-Windows OS.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing config dir, manager script path <code class="param-name">EXPATH</code>).</li>
                    <li>Creating task XML file failed (permissions, disk full).</li>
                    <li><code class="param-name">schtasks</code> command not found.</li>
                    <li>Importing XML via <code class="param-name">schtasks /Create</code> failed (access denied, invalid XML).</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block"># Note: Windows-only endpoint.
curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"command": "backup-all", "triggers": [{"type": "Daily", "start": "2024-01-16T02:30:00", "interval": 1}]}' \
     "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyWinServer/task_scheduler/add"</code></pre>
        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$taskBody = @{
    command = 'backup-all'
    triggers = @(
        @{ type = 'Daily'; start = '2024-01-16T02:30:00'; interval = 1 }
    )
}
$bodyJson = $taskBody | ConvertTo-Json -Depth 3
# Expect error if manager host is not Windows
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyWinServer/task_scheduler/add" -Headers $headers -Body $bodyJson</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-post">POST</span> <code class="endpoint-path">/api/server/{server_name}/task_scheduler/details</code> - Get Windows Task Details (Windows Only)</h3>
        <p>Retrieves details (command, triggers) by parsing the task's associated XML config file. <strong>Windows only.</strong></p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Platform:</h4> <p>Windows Only.</p>
        <h4>Path Parameters:</h4>
        <ul><li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Server context to locate task XML.</li></ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <pre><code class="api-code-block">{
    "task_name": "bedrock_MyWinServer_backup-all_..."
}</code></pre>
        <ul>
            <li><code class="param-name">task_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Full name of the task whose details to retrieve.</li>
        </ul>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when task XML found and parsed successfully.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "task_details": {
        "command_path": "C:\\path\\to\\manager.exe",
        "command_args": "backup-all --server MyWinServer",
        "base_command": "backup-all",
        "triggers": [
            {
                "type": "Daily",
                "start": "2024-01-16T02:30:00",
                "interval": 1
            }
        ]
    }
}</code></pre>
        <ul>
            <li><code class="param-name">status</code>: "success"</li>
            <li><code class="param-name">task_details</code> (*object*): Parsed details (command path, args, base command, triggers list).</li>
        </ul>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Invalid/missing JSON body.</li>
                    <li>Missing/invalid <code class="param-name">task_name</code>.</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>403 Forbidden</code>:
                <ul><li>Request made on non-Windows OS.</li></ul>
            </li>
            <li><code>404 Not Found</code>:
                <ul><li>Task XML config file not found for the given name/server context.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing config dir).</li>
                    <li>Error parsing XML file (invalid XML, missing elements).</li>
                    <li>Unexpected error.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block"># Note: Windows-only endpoint.
TASK_NAME="bedrock_MyWinServer_backup-all_20240115103000"
curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d "{\"task_name\": \"$TASK_NAME\"}" \
     "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyWinServer/task_scheduler/details"</code></pre>
        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$taskName = "bedrock_MyWinServer_backup-all_20240115103000"
$body = @{ task_name = $taskName } | ConvertTo-Json
Invoke-RestMethod -Method Post -Uri "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyWinServer/task_scheduler/details" -Headers $headers -Body $body</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-put">PUT</span> <code class="endpoint-path">/api/server/{server_name}/task_scheduler/task/{task_name}</code> - Modify Windows Task (Windows Only)</h3>
        <p>Modifies an existing Windows task by <strong>deleting</strong> the old task (<code class="param-name">task_name</code>) and <strong>creating a new one</strong> with details from the request body. The new task gets a new timestamped name. <strong>Windows only.</strong></p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Platform:</h4> <p>Windows Only.</p>
        <h4>Path Parameters:</h4>
        <ul>
            <li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Server context.</li>
            <li><code class="param-name">task_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Current full name of the task to replace (URL encode if needed).</li>
        </ul>
        <h4>Request Body (<code class="endpoint-path">application/json</code>):</h4>
        <p>Same structure as "Add Windows Task", defining the <em>new</em> command and triggers.</p>
        <pre><code class="api-code-block">{
    "command": "restart-server",
    "triggers": [ { "type": "Weekly", "start": "...", "days": ["Saturday"] } ]
}</code></pre>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when old task deleted (or not found) and new task created successfully. Includes the new task name.</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Windows task modified successfully.", // Simple message from API
    "new_task_name": "bedrock_MyWinServer_restart-server_20240116_090000" // Added by route handler
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul>
                    <li>Missing <code class="param-name">task_name</code> in URL path (Flask 404).</li>
                    <li>Invalid/missing JSON body.</li>
                    <li>Validation of *new* command/triggers failed (see Add Task errors).</li>
                </ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>403 Forbidden</code>:
                <ul><li>Request made on non-Windows OS.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Deleting *old* task failed (access denied).</li>
                    <li>Creating or importing *new* task failed (config errors, XML errors, <code class="param-name">schtasks</code> errors - see Add Task errors).</li>
                    <li>Unexpected error during delete or create.</li>
                </ul>
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block"># Note: Windows-only endpoint.
OLD_TASK_NAME="bedrock_MyWinServer_backup-all_..."
# URL Encode if needed
ENCODED_OLD_TASK_NAME=$(python3 -c 'import urllib.parse; print(urllib.parse.quote("'$OLD_TASK_NAME'"))')

curl -X PUT -H "Authorization: Bearer YOUR_JWT_TOKEN" -H "Content-Type: application/json" \
     -d '{"command": "restart-server", "triggers": [{"type": "Weekly", "start": "2024-01-20T05:00:00", "days": ["Saturday"]}]}' \
     "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyWinServer/task_scheduler/task/${ENCODED_OLD_TASK_NAME}"</code></pre>
        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN'; 'Content-Type' = 'application/json' }
$oldTaskName = "bedrock_MyWinServer_backup-all_..."
# URL encode the task name for the URI
$encodedOldTaskName = [uri]::EscapeDataString($oldTaskName) # PS Core encoding

$newTaskBody = @{
    command = 'restart-server'
    triggers = @(
        @{ type = 'Weekly'; start = '2024-01-20T05:00:00'; days = @('Saturday') }
    )
}
$bodyJson = $newTaskBody | ConvertTo-Json -Depth 3
$uri = "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyWinServer/task_scheduler/task/$encodedOldTaskName"
Invoke-RestMethod -Method Put -Uri $uri -Headers $headers -Body $bodyJson</code></pre>
    </div>

    <div class="api-endpoint">
        <h3><span class="method-tag method-delete">DELETE</span> <code class="endpoint-path">/api/server/{server_name}/task_scheduler/task/{task_name}</code> - Delete Windows Task (Windows Only)</h3>
        <p>Deletes an existing Windows task using <code class="param-name">schtasks.exe /Delete</code> and attempts to delete its XML config file. <strong>Windows only.</strong></p>
        <p>This endpoint is exempt from CSRF protection but requires authentication.</p>
        <h4>Authentication:</h4> <p>Required (JWT or active Web UI session).</p>
        <h4>Platform:</h4> <p>Windows Only.</p>
        <h4>Path Parameters:</h4>
        <ul>
            <li><code class="param-name">server_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Server context for locating XML file.</li>
            <li><code class="param-name">task_name</code><span class="param-type">(string)</span><span class="param-required">(Required)</span>: Full name of task to delete (URL encode if needed).</li>
        </ul>
        <h4>Request Body:</h4> <p>None.</p>
        <h4>Success Response (`200 OK`):</h4>
        <p>Returned when task deleted from scheduler (or already gone) and XML file deleted (or not found).</p>
        <pre><code class="api-code-block">{
    "status": "success",
    "message": "Task '&lt;task_name&gt;' and its definition file deleted successfully."
}</code></pre>
        <h4>Error Responses:</h4>
        <ul>
            <li><code>400 Bad Request</code>:
                <ul><li>Missing <code class="param-name">task_name</code> in URL path (Flask 404).</li></ul>
            </li>
            <li><code>401 Unauthorized</code>:
                <ul><li>Authentication missing or invalid.</li></ul>
            </li>
            <li><code>403 Forbidden</code>:
                <ul><li>Request made on non-Windows OS.</li></ul>
            </li>
            <li><code>500 Internal Server Error</code>:
                <ul>
                    <li>Configuration error (missing config dir).</li>
                    <li>Deleting task via <code class="param-name">schtasks /Delete</code> failed (access denied).</li>
                    <li>Deleting task XML config file failed (permissions).</li>
                    <li><code class="param-name">schtasks</code> command not found.</li>
                    <li>Unexpected error.</li>
                </ul>
                 *(Note: Response aggregates errors if both deletions have issues.)*
            </li>
        </ul>
        <h4><code>curl</code> Example (Bash):</h4>
        <pre><code class="api-code-block"># Note: Windows-only endpoint.
TASK_NAME="bedrock_MyWinServer_backup-all_..."
# URL Encode if needed
ENCODED_TASK_NAME=$(python3 -c 'import urllib.parse; print(urllib.parse.quote("'$TASK_NAME'"))')
curl -X DELETE -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyWinServer/task_scheduler/task/${ENCODED_TASK_NAME}"</code></pre>
        <h4>PowerShell Example:</h4>
        <pre><code class="api-code-block">$headers = @{ Authorization = 'Bearer YOUR_JWT_TOKEN' }
$taskName = "bedrock_MyWinServer_backup-all_..."
# URL encode the task name for the URI
$encodedTaskName = [uri]::EscapeDataString($taskName) # PS Core encoding
$uri = "http://&lt;your-manager-host&gt;:&lt;port&gt;/api/server/MyWinServer/task_scheduler/task/$encodedTaskName"
Invoke-RestMethod -Method Delete -Uri $uri -Headers $headers</code></pre>
    </div>

</div> {# --- End Scheduled Tasks Section --- #}


{# --- Optional: Back link at the bottom --- #}
{# <hr style="margin: 30px 0; border-color: #666;"> #} {# Using border-bottom on section instead #}
<p class="back-to-docs-link">
    <a href="{{ url_for('doc_routes.doc_index') }}">← Back to Documentation Index</a>
</p>

{% endblock %}

{# --- Page Specific Scripts --- #}
{% block body_scripts %}
    {# Add any JS needed specifically for this page, if any #}
{% endblock %}