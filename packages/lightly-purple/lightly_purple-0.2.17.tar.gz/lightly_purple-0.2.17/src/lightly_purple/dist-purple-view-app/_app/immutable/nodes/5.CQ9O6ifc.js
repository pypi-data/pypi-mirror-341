import{t as A,r as de,a as p,n as ce,c as me}from"../chunks/BIBpUM06.js";import{p as J,r as ge,a as U,b as ue,s as D,c as h,i as _e}from"../chunks/CCXSUNwX.js";import{P as fe,c as ve}from"../chunks/BzArsHZA.js";import{j as he,a as pe,e as be,k as Se,c as F,u as xe,g as we,I as ye,b as Fe}from"../chunks/BYGGi5BS.js";import{p as O,t as R,a as T,j as t,r as I,w as Ie,o as k,e as Ae,c as z,f as je,q as y,l as E,s as Y}from"../chunks/CXxiYbHI.js";import{u as Le}from"../chunks/B3bLZxSy.js";import{S as ke}from"../chunks/Cpgl9aC0.js";import{r as ze}from"../chunks/Cbydd1_z.js";import{G as Ee}from"../chunks/Cj-IzF3s.js";import{a as He}from"../chunks/BMn8bbDJ.js";import"../chunks/DsN2YVC9.js";var We=A("<img>");function Me(d,e){O(e,!0);const i=J(e,"objectFit",3,"contain"),s=ge(e,["$$slots","$$events","$$legacy","sample","objectFit"]),{class:n,...o}=s;var r=We();let c;R(_=>c=pe(r,c,{src:fe+e.sample.file_path_abs,alt:e.sample.file_path_abs,class:_,decoding:"async",style:`--object-fit: ${i()??""}`,loading:"lazy",...o},"svelte-1c6bz0a"),[()=>he("sample-image rounded-lg bg-black",n)]),de(r),p(d,r),T()}var Ge=ce('<svg style="position: absolute; top: 0; left: 0;"></svg>');function Pe(d,e){O(e,!0);const i=J(e,"sampleImageObjectFit",3,"contain");var s=Ge();be(s,21,()=>e.sample.annotations,Se,(n,o)=>{ke(n,{get annotation(){return t(o)},get showLabel(){return e.showLabel},get imageWidth(){return e.sample.width}})}),I(s),R(()=>{F(s,"viewBox",`0 0 ${e.sample.width} ${e.sample.height}`),F(s,"preserveAspectRatio",i()==="contain"?"xMidYMid meet":"xMidYMid slice"),F(s,"width",e.containerWidth),F(s,"height",e.containerHeight)}),p(d,s),T()}const Oe=async({dataset_id:d,offset:e=0,limit:i=10,annotationLabels:s,tagIds:n,min_width:o,max_width:r,min_height:c,max_height:_,textEmbedding:b=[]})=>{const f={data:[],error:void 0};try{const S=o!==void 0?{min_width:o,max_width:r,min_height:c,max_height:_}:{},m=await ve.GET("/api/samples",{params:{query:{dataset_id:d,offset:e,limit:i,annotation_labels:s,tag_ids:n,text_embedding:b,...S}}});if(m.error)throw new Error(JSON.stringify(m.error,null,2));if(!m.data)throw new Error("No data");f.data=m.data}catch(S){f.error="Error loading samples: "+String(S)}return f};var Re=A('<div class="relative"><div class="absolute right-7 top-1 z-10"><!></div> <a class="block"><!> <!></a></div>'),Te=A('<div slot="noMore"></div>'),qe=A('<div slot="noResults"></div>'),Be=A('<div class="viewport flex-1 svelte-gzepom"><!></div>');function Ne(d,e){O(e,!0);const[i,s]=D(),n=()=>h(S,"$infiniteLoaderIdentifier",i),o=()=>h(e.dimensions,"$dimensions",i),r=()=>h(e.selectedAnnotationFilter,"$selectedAnnotationFilter",i),c=()=>h(f,"$tagsSelected",i),_=()=>h(e.textEmbedding,"$textEmbedding",i),b=()=>h(Q,"$selectedSampleIds",i),{tagsSelected:f}=Le({dataset_id:e.dataset_id,kind:["sample"]});let S=Ie([e.selectedAnnotationFilter,f,e.dimensions,e.textEmbedding],([u,x,l,a])=>u.join(",")+Array.from(x).join(",")+l.min_width+l.max_width+l.min_height+l.max_height+(a?a.queryText:"")),m=k(0);const H=100;let g=k(U([])),W=k(null),q=k(!0);Ae(()=>{n(),y(g,U([])),y(m,0)});async function K({detail:{loaded:u,complete:x}}){const l=t(q)?void 0:o(),a=await Oe({dataset_id:e.dataset_id,limit:H,offset:t(m),annotationLabels:r().length>0?r():void 0,tagIds:c().size>0?Array.from(c()):void 0,textEmbedding:_()?_().embedding:void 0,...l});a.data.length?(y(m,t(m)+H),t(g).push(...a.data),y(q,!1),a.data.length<H?x():u()):x()}const{selectedSampleIds:Q,toggleSampleSelection:V}=xe(),B=16,X=we(),[Z,Ce]=X;var j=Be(),$=z(j);const ee=E(()=>e.sampleHeight+B),te=E(()=>e.sampleWidth+B),ae=E(()=>{var u;return((u=t(W))==null?void 0:u.clientHeight)||0});Ee($,{get itemCount(){return t(g).length},get itemHeight(){return t(ee)},get itemWidth(){return t(te)},get height(){return t(ae)},class:"overflow-none overflow-y-auto dark:[color-scheme:dark]",get style(){return`--sample-width: ${e.sampleWidth??""}px; --sample-height: ${e.sampleHeight??""}px;`},overScan:100,item:(l,a)=>{let v=()=>a==null?void 0:a().index,w=()=>a==null?void 0:a().style;var N=me(),se=je(N);{var ie=M=>{var L=Re(),G=z(L),ne=z(G);const oe=E(()=>b().has(t(g)[v()].sample_id));He(ne,{onSelect:()=>V(t(g)[v()].sample_id),get isSelected(){return t(oe)}}),I(G);var P=Y(G,2),C=z(P);Me(C,{get sample(){return t(g)[v()]},objectFit:"cover"});var re=Y(C,2);Pe(re,{get sample(){return t(g)[v()]},get containerWidth(){return e.sampleWidth},sampleImageObjectFit:"cover",get containerHeight(){return e.sampleHeight}}),I(P),I(L),R(le=>{Fe(L,w()),F(P,"href",le)},[()=>Z(ze.toSample(t(g)[v()].sample_id),void 0)]),p(M,L)};_e(se,M=>{t(g)[v()]&&M(ie)})}p(l,N)},footer:l=>{ye(l,{get identifier(){return n()},$$events:{infinite:K},$$slots:{noMore:(a,v)=>{var w=Te();p(a,w)},noResults:(a,v)=>{var w=qe();p(a,w)}}})},$$slots:{item:!0,footer:!0}}),I(j),ue(j,u=>y(W,u),()=>t(W)),p(d,j),T(),s()}function tt(d,e){const[i,s]=D(),n=()=>h(f,"$boundedSampleSize",i),{datasetId:o,sampleSize:r,dimensions:c,selectedAnnotationFilter:_,globalStorage:{textEmbedding:b}}=e.data,f=r.sampleSize;Ne(d,{get sampleHeight(){return n().height},get sampleWidth(){return n().width},textEmbedding:b,dataset_id:o,selectedAnnotationFilter:_,dimensions:c}),s()}export{tt as component};
