{"title":"Marginal Effects and Hypothesis Tests via `marginaleffects`","markdown":{"yaml":{"title":"Marginal Effects and Hypothesis Tests via `marginaleffects`","format":{"html":{"html-table-processing":"none"}},"toc":true,"toc-title":"On this page","toc-location":"left"},"headingText":"Non-Linear Hypothesis Tests: Ratio Estimates","containsRefs":false,"markdown":"\n\nWe can compute marginal effects and linear and non-linear hypothesis tests via the excellent [marginaleffects](https://github.com/vincentarelbundock/pymarginaleffects) package.\n\n\n```{python}\nfrom marginaleffects import hypotheses\n\nimport pyfixest as pf\n\ndata = pf.get_data()\nfit = pf.feols(\"Y ~ X1 + X2\", data=data)\n\nfit.tidy()\n```\n\n\nSuppose we were interested in testing the hypothesis that $X_{1} = X_{2}$. Given the relatively large differences in coefficients and\nsmall standard errors, we will likely reject the null that the two parameters are equal.\n\nWe can run the formal test via the `hypotheses` function from the `marginaleffects` package.\n\n\n```{python}\nhypotheses(fit, \"X1 - X2 = 0\")\n```\n\n\nAnd indeed, we reject the null of equality of coefficients: we get a p-value of zero and a confidence interval that does not contain 0.\n\n\nWe can also test run-linear hypotheses, in which case `marginaleffects` will automatically compute correct standard errors\nbased on the estimated covariance matrix and the Delta method. This is for example useful for computing inferential\nstatistics for the \"relative uplift\" in an AB test.\n\nFor the moment, let's assume that $X1$ is a randomly assigned treatment variable. As before, $Y$ is our variable / KPI of interest.\n\nUnder randomization, the model intercept measures the \"baseline\", i.e. the population average of $Y$ in the absence of treatment. To compute a relative uplift, we might compute\n\n\n```{python}\n(fit.coef().xs(\"X1\") / fit.coef().xs(\"Intercept\") - 1) * 100\n```\n\n\nSo we have a really big negative treatment effect of around minus 212%! To conduct correct inference on this\nratio statistic, we need to use the delta method.\n\n\n### The Multivariate Delta Method\n\nIn a nutshell, the delta method provides a way to approximate the asympotic distribution of any non-linear transformation $g()$ or one or more random variables.\n\nIn the case of the ratio statistics, this non-linear transformation can be denoted as $g(\\theta_{1}, \\theta_{2}) = \\theta_{1} / \\theta_{2}$.\n\nHere's the **Delta Method theorem**:\n\nFirst, we define $\\theta = (\\theta_{1}, \\theta_{2})'$ and $\\mu = (\\mu_{1}, \\mu_{2})'$.\n\nBy the law of large numbers, we know that\n\n$$\n\\sqrt{N} (\\theta - \\mu) \\rightarrow_{d} N(0_{2}, \\Sigma_{2,2}) \\text{ if } N \\rightarrow \\infty.\n$$\n\nBy the **Delta Method**, we can then approximate the limit distribution of $g(\\theta)$ as\n\n\n$$\n\\sqrt{N}  (g(\\theta) - g(\\mu)) \\rightarrow_{d} N(0_{1}, g'(\\theta) \\times \\Sigma \\times g(\\theta)) \\text{ if } N \\rightarrow \\infty.\n$$.\n\n[Here's a long derivation of how to use the the delta method for inference of ratio statistics.](https://stats.stackexchange.com/questions/291594/estimation-of-population-ratio-using-delta-method). The key steps from the formula above is to derive the expression for the asymptotic variance $ g'(\\theta) \\times \\Sigma \\times g(\\theta)$.\n\nBut hey - we're lucky, because marginaleffects will do all this work for us: we don't have to derive analytic gradients ourselves =)\n\n### Using the Delta Method via `marginaleffects`:\n\nWe can employ the Delta Method via `marginaleffects` via the `hypotheses` function:\n\n\n```{python}\nhypotheses(fit, \"(X1 / Intercept - 1) * 100 = 0\")\n```\n\nAs before, we get an estimate of around -212%. Additionally, we obtain a 95% CI via the Delta Method of [-228%, -195%].\n\nBesides hypopotheses testing, you can do a range of other cool things with the `marginaleffects` package.\nFor example (and likely unsurprisingly), you can easily compute all sorts of marginal effects for your regression models.\nFor all the details, we highly recommend to take a look\nat the [marginaleffects zoo book!](https://marginaleffects.com/index.html).\n","srcMarkdownNoYaml":"\n\nWe can compute marginal effects and linear and non-linear hypothesis tests via the excellent [marginaleffects](https://github.com/vincentarelbundock/pymarginaleffects) package.\n\n\n```{python}\nfrom marginaleffects import hypotheses\n\nimport pyfixest as pf\n\ndata = pf.get_data()\nfit = pf.feols(\"Y ~ X1 + X2\", data=data)\n\nfit.tidy()\n```\n\n\nSuppose we were interested in testing the hypothesis that $X_{1} = X_{2}$. Given the relatively large differences in coefficients and\nsmall standard errors, we will likely reject the null that the two parameters are equal.\n\nWe can run the formal test via the `hypotheses` function from the `marginaleffects` package.\n\n\n```{python}\nhypotheses(fit, \"X1 - X2 = 0\")\n```\n\n\nAnd indeed, we reject the null of equality of coefficients: we get a p-value of zero and a confidence interval that does not contain 0.\n\n## Non-Linear Hypothesis Tests: Ratio Estimates\n\nWe can also test run-linear hypotheses, in which case `marginaleffects` will automatically compute correct standard errors\nbased on the estimated covariance matrix and the Delta method. This is for example useful for computing inferential\nstatistics for the \"relative uplift\" in an AB test.\n\nFor the moment, let's assume that $X1$ is a randomly assigned treatment variable. As before, $Y$ is our variable / KPI of interest.\n\nUnder randomization, the model intercept measures the \"baseline\", i.e. the population average of $Y$ in the absence of treatment. To compute a relative uplift, we might compute\n\n\n```{python}\n(fit.coef().xs(\"X1\") / fit.coef().xs(\"Intercept\") - 1) * 100\n```\n\n\nSo we have a really big negative treatment effect of around minus 212%! To conduct correct inference on this\nratio statistic, we need to use the delta method.\n\n\n### The Multivariate Delta Method\n\nIn a nutshell, the delta method provides a way to approximate the asympotic distribution of any non-linear transformation $g()$ or one or more random variables.\n\nIn the case of the ratio statistics, this non-linear transformation can be denoted as $g(\\theta_{1}, \\theta_{2}) = \\theta_{1} / \\theta_{2}$.\n\nHere's the **Delta Method theorem**:\n\nFirst, we define $\\theta = (\\theta_{1}, \\theta_{2})'$ and $\\mu = (\\mu_{1}, \\mu_{2})'$.\n\nBy the law of large numbers, we know that\n\n$$\n\\sqrt{N} (\\theta - \\mu) \\rightarrow_{d} N(0_{2}, \\Sigma_{2,2}) \\text{ if } N \\rightarrow \\infty.\n$$\n\nBy the **Delta Method**, we can then approximate the limit distribution of $g(\\theta)$ as\n\n\n$$\n\\sqrt{N}  (g(\\theta) - g(\\mu)) \\rightarrow_{d} N(0_{1}, g'(\\theta) \\times \\Sigma \\times g(\\theta)) \\text{ if } N \\rightarrow \\infty.\n$$.\n\n[Here's a long derivation of how to use the the delta method for inference of ratio statistics.](https://stats.stackexchange.com/questions/291594/estimation-of-population-ratio-using-delta-method). The key steps from the formula above is to derive the expression for the asymptotic variance $ g'(\\theta) \\times \\Sigma \\times g(\\theta)$.\n\nBut hey - we're lucky, because marginaleffects will do all this work for us: we don't have to derive analytic gradients ourselves =)\n\n### Using the Delta Method via `marginaleffects`:\n\nWe can employ the Delta Method via `marginaleffects` via the `hypotheses` function:\n\n\n```{python}\nhypotheses(fit, \"(X1 / Intercept - 1) * 100 = 0\")\n```\n\nAs before, we get an estimate of around -212%. Additionally, we obtain a 95% CI via the Delta Method of [-228%, -195%].\n\nBesides hypopotheses testing, you can do a range of other cool things with the `marginaleffects` package.\nFor example (and likely unsurprisingly), you can easily compute all sorts of marginal effects for your regression models.\nFor all the details, we highly recommend to take a look\nat the [marginaleffects zoo book!](https://marginaleffects.com/index.html).\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"python":"/pyfixest/.pixi/envs/docs/Scripts/python.exe","engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"html-table-processing":"none"},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"marginaleffects.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.32","quartodoc":{"package":"pyfixest","title":"PyFixest Function Reference","parser":"numpy","rewrite_all_pages":false,"sidebar":"_sidebar.yml","sections":[{"title":"Estimation Functions","desc":"User facing estimation functions\n","contents":["estimation.estimation.feols","estimation.estimation.fepois","estimation.estimation.feglm","did.estimation.did2s","did.estimation.lpdid","did.estimation.event_study","estimation.bonferroni","estimation.rwolf"]},{"title":"Estimation Classes","desc":"Details on Methods and Attributes\n","contents":["estimation.feols_.Feols","estimation.fepois_.Fepois","estimation.feiv_.Feiv","estimation.feglm_.Feglm","estimation.felogit_.Felogit","estimation.feprobit_.Feprobit","estimation.fegaussian_.Fegaussian","estimation.feols_compressed_.FeolsCompressed"]},{"title":"Summarize and Visualize","desc":"Post-Processing of Estimation Results\n","contents":["did.visualize.panelview","report.summary","report.etable","report.dtable","report.coefplot","report.iplot","did.visualize.panelview"]},{"title":"Misc / Utilities","desc":"PyFixest internals and utilities\n","contents":["estimation.demean","estimation.detect_singletons","estimation.model_matrix_fixest"]}]},"title":"Marginal Effects and Hypothesis Tests via `marginaleffects`","toc-title":"On this page","toc-location":"left"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}