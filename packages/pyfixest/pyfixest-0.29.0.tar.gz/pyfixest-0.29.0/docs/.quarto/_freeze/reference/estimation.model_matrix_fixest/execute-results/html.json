{
  "hash": "018bcb4ea1553ff5339f0054ce71a97c",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: estimation.model_matrix_fixest\n---\n\n\n\n```python\nestimation.model_matrix_fixest(\n    FixestFormula,\n    data,\n    drop_singletons=False,\n    weights=None,\n    drop_intercept=False,\n    context=0,\n)\n```\n\nCreate model matrices for fixed effects estimation.\n\nThis function processes the data and then calls\n`formulaic.Formula.get_model_matrix()` to create the model matrices.\n\n## Parameters {.doc-section .doc-section-parameters}\n\n| Name            | Type                                                     | Description                                                                                                                                                                                                                                                          | Default    |\n|-----------------|----------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|\n| FixestFormula   | A pyfixest.estimation.FormulaParser.FixestFormula object | that contains information on the model formula, the formula of the first and second stage, dependent variable, covariates, fixed effects, endogenous variables (if any), and instruments (if any).                                                                   | _required_ |\n| data            | pd.DataFrame                                             | The input DataFrame containing the data.                                                                                                                                                                                                                             | _required_ |\n| drop_singletons | bool                                                     | Whether to drop singleton fixed effects. Default is False.                                                                                                                                                                                                           | `False`    |\n| weights         | str or None                                              | A string specifying the name of the weights column in `data`. Default is None.                                                                                                                                                                                       | `None`     |\n| data            | pd.DataFrame                                             | The input DataFrame containing the data.                                                                                                                                                                                                                             | _required_ |\n| drop_intercept  | bool                                                     | Whether to drop the intercept from the model matrix. Default is False. If True, the intercept is dropped ex post from the model matrix created by formulaic.                                                                                                         | `False`    |\n| context         | int or Mapping\\[str, Any\\]                               | A dictionary containing additional context variables to be used by formulaic during the creation of the model matrix. This can include custom factorization functions, transformations, or any other variables that need to be available in the formula environment. | `0`        |\n\n## Returns {.doc-section .doc-section-returns}\n\n| Name   | Type   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|--------|--------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|        | dict   | A dictionary with the following keys and value types: - 'Y' : pd.DataFrame     The dependent variable. - 'X' : pd.DataFrame     The Design Matrix. - 'fe' : Optional[pd.DataFrame]     The model's fixed effects. None if not applicable. - 'endogvar' : Optional[pd.DataFrame]     The model's endogenous variable(s), None if not applicable. - 'Z' : np.ndarray     The model's set of instruments (exogenous covariates plus instruments).     None if not applicable. - 'weights_df' : Optional[pd.DataFrame]     DataFrame containing weights, None if weights are not used. - 'na_index' : np.ndarray     Array indicating rows droppled beause of NA values or singleton     fixed effects. - 'na_index_str' : str     String representation of 'na_index'. - '_icovars' : Optional[list[str]]     List of variables interacted with i() syntax, None if not applicable. - 'X_is_empty' : bool     Flag indicating whether X is empty. - 'model_spec' : formulaic ModelSpec     The model specification used to create the model matrices. |\n\n## Examples {.doc-section .doc-section-examples}\n\n\n::: {#09b10483 .cell execution_count=1}\n``` {.python .cell-code}\nimport pyfixest as pf\nfrom pyfixest.estimation.model_matrix_fixest_ import model_matrix_fixest\n\ndata = pf.get_data()\nfit = pf.feols(\"Y ~ X1 + f1 + f2\", data=data)\nFixestFormula = fit.FixestFormula\n\nmm = model_matrix_fixest(FixestFormula, data)\nmm\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n\n            <div id=\"0KOwte\"></div>\n            <script type=\"text/javascript\" data-lets-plot-script=\"library\">\n                if(!window.letsPlotCallQueue) {\n                    window.letsPlotCallQueue = [];\n                }; \n                window.letsPlotCall = function(f) {\n                    window.letsPlotCallQueue.push(f);\n                };\n                (function() {\n                    var script = document.createElement(\"script\");\n                    script.type = \"text/javascript\";\n                    script.src = \"https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.5.2/js-package/distr/lets-plot.min.js\";\n                    script.onload = function() {\n                        window.letsPlotCall = function(f) {f();};\n                        window.letsPlotCallQueue.forEach(function(f) {f();});\n                        window.letsPlotCallQueue = [];\n                        \n                    };\n                    script.onerror = function(event) {\n                        window.letsPlotCall = function(f) {};    // noop\n                        window.letsPlotCallQueue = [];\n                        var div = document.createElement(\"div\");\n                        div.style.color = 'darkred';\n                        div.textContent = 'Error loading Lets-Plot JS';\n                        document.getElementById(\"0KOwte\").appendChild(div);\n                    };\n                    var e = document.getElementById(\"0KOwte\");\n                    e.appendChild(script);\n                })()\n            </script>\n            \n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n\n            <div id=\"wV9DQm\"></div>\n            <script type=\"text/javascript\" data-lets-plot-script=\"library\">\n                if(!window.letsPlotCallQueue) {\n                    window.letsPlotCallQueue = [];\n                }; \n                window.letsPlotCall = function(f) {\n                    window.letsPlotCallQueue.push(f);\n                };\n                (function() {\n                    var script = document.createElement(\"script\");\n                    script.type = \"text/javascript\";\n                    script.src = \"https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.5.2/js-package/distr/lets-plot.min.js\";\n                    script.onload = function() {\n                        window.letsPlotCall = function(f) {f();};\n                        window.letsPlotCallQueue.forEach(function(f) {f();});\n                        window.letsPlotCallQueue = [];\n                        \n                    };\n                    script.onerror = function(event) {\n                        window.letsPlotCall = function(f) {};    // noop\n                        window.letsPlotCallQueue = [];\n                        var div = document.createElement(\"div\");\n                        div.style.color = 'darkred';\n                        div.textContent = 'Error loading Lets-Plot JS';\n                        document.getElementById(\"wV9DQm\").appendChild(div);\n                    };\n                    var e = document.getElementById(\"wV9DQm\");\n                    e.appendChild(script);\n                })()\n            </script>\n            \n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\n{'Y':             Y\n 3    3.319513\n 4    0.134420\n 5   -0.278350\n 6   -1.519790\n 7   -2.072451\n ..        ...\n 995 -2.876714\n 996  1.430674\n 997 -0.494217\n 998 -1.047594\n 999  0.105551\n \n [997 rows x 1 columns],\n 'X':      Intercept   X1    f1    f2\n 3          1.0  1.0   1.0  10.0\n 4          1.0  2.0  19.0  20.0\n 5          1.0  2.0  13.0   3.0\n 6          1.0  1.0   2.0  16.0\n 7          1.0  0.0   2.0  23.0\n ..         ...  ...   ...   ...\n 995        1.0  2.0  14.0  23.0\n 996        1.0  0.0  19.0  17.0\n 997        1.0  1.0   3.0   5.0\n 998        1.0  0.0  18.0  20.0\n 999        1.0  2.0   4.0  19.0\n \n [997 rows x 4 columns],\n 'fe': None,\n 'endogvar': None,\n 'Z': None,\n 'weights_df': None,\n 'na_index': array([0, 1, 2]),\n 'na_index_str': '0,1,2',\n 'icovars': None,\n 'X_is_empty': False,\n 'model_spec': .fml_second_stage:\n     .lhs:\n         ModelSpec(formula=Y, materializer='pandas', materializer_params={}, ensure_full_rank=True, na_action=<NAAction.DROP: 'drop'>, output='pandas', cluster_by=<ClusterBy.NONE: 'none'>, structure=[EncodedTermStructure(term=Y, scoped_terms=[Y], columns=['Y'])], transform_state={}, encoder_state={'Y': (<Kind.NUMERICAL: 'numerical'>, {})})\n     .rhs:\n         ModelSpec(formula=1 + X1 + f1 + f2, materializer='pandas', materializer_params={}, ensure_full_rank=True, na_action=<NAAction.DROP: 'drop'>, output='pandas', cluster_by=<ClusterBy.NONE: 'none'>, structure=[EncodedTermStructure(term=1, scoped_terms=[1], columns=['Intercept']), EncodedTermStructure(term=X1, scoped_terms=[X1], columns=['X1']), EncodedTermStructure(term=f1, scoped_terms=[f1], columns=['f1']), EncodedTermStructure(term=f2, scoped_terms=[f2], columns=['f2'])], transform_state={}, encoder_state={'X1': (<Kind.NUMERICAL: 'numerical'>, {}), 'f1': (<Kind.NUMERICAL: 'numerical'>, {}), 'f2': (<Kind.NUMERICAL: 'numerical'>, {})})}\n```\n:::\n:::\n\n\n",
    "supporting": [
      "estimation.model_matrix_fixest_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}