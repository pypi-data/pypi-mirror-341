import{j as z,k as D,l as G,m as j,d as A,n as F,p as S,o as q,q as W,s as I,v as E,t as f,i as a,x as _,g as p,w as y,y as V,z as $,F as U,A as K,f as w,B as c,C as n,D as Q,Q as N,E as X,G as x,H as O,I as J,J as Y,e as Z,K as ee,u as te,a as ne,L as ie,M as ae,c as oe,_ as H,r as R}from"./index-DN2bGT0N.js";import{Q as T}from"./QPageSticky-Da2xE4AB.js";import{Q as re}from"./QPage-DXSFkEWD.js";import{Q as se}from"./QCircularProgress-Bz8O37u8.js";import{_ as le}from"./RouteAfterTimeout.vue_vue_type_script_setup_true_lang-6i4m_yac.js";import"./format-CJebrXOQ.js";const ce='<circle cx="12.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="0s" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="52.5" r="12.5" fill-opacity=".5"><animate attributeName="fill-opacity" begin="100ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="300ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="600ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="12.5" r="12.5"><animate attributeName="fill-opacity" begin="800ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="52.5" r="12.5"><animate attributeName="fill-opacity" begin="400ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="12.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="700ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="52.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="500ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="92.5" cy="92.5" r="12.5"><animate attributeName="fill-opacity" begin="200ms" dur="1s" values="1;.2;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',ue=z({name:"QSpinnerGrid",props:D,setup(h){const{cSize:i,classes:e}=G(h);return()=>j("svg",{class:e.value,fill:"currentColor",width:i.value,height:i.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg",innerHTML:ce})}}),me='<g fill="none" fill-rule="evenodd" stroke-width="2"><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="0s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="0s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle><circle cx="22" cy="22" r="1"><animate attributeName="r" begin="-0.9s" dur="1.8s" values="1; 20" calcMode="spline" keyTimes="0; 1" keySplines="0.165, 0.84, 0.44, 1" repeatCount="indefinite"></animate><animate attributeName="stroke-opacity" begin="-0.9s" dur="1.8s" values="1; 0" calcMode="spline" keyTimes="0; 1" keySplines="0.3, 0.61, 0.355, 1" repeatCount="indefinite"></animate></circle></g>',de=z({name:"QSpinnerPuff",props:D,setup(h){const{cSize:i,classes:e}=G(h);return()=>j("svg",{class:e.value,stroke:"currentColor",width:i.value,height:i.value,viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",innerHTML:me})}}),ge={id:"countdown-timer-container",class:"flex flex-center",style:{width:"70vw",height:"70vh"}},fe=["innerHTML"],_e={style:{height:"100%"}},pe=A({__name:"CountdownTimer",props:{duration:{},messageDuration:{default:.5},messageText:{default:"ðŸ˜ƒ"}},setup(h){let i;const e=F(0),t=F(0),s=h,l=S(()=>e.value>0),r=S(()=>e.value>0),v=S(()=>e.value<=s.messageDuration);q(()=>{M()}),W(()=>{C()});const C=()=>{clearInterval(i),e.value=0},M=()=>{t.value=s.duration,e.value=t.value,console.log(`starting timer, duration=${t.value}`),i=window.setInterval(()=>{e.value-=.05,e.value<=0&&clearInterval(i)},50)};return(b,o)=>I((a(),f("div",ge,[I(_("div",{id:"countdown-timer-message",style:{position:"absolute","font-size":"150px"},innerHTML:b.messageText},null,8,fe),[[E,v.value]]),_("div",_e,[I(p(se,{"show-value":!v.value,style:{width:"100%",height:"100%"},value:e.value,min:0,max:t.value,reverse:"","animation-speed":"100","font-size":"0.5em",size:"70vh",color:"primary",class:"text-secondary"},{default:y(()=>[V($(parseFloat(e.value.toFixed(0))),1)]),_:1},8,["show-value","value","max"]),[[E,r.value]])])],512)),[[E,l.value]])}}),ve={class:"row q-gutter-md action-buttons"},he={style:{"white-space":"nowrap"},class:"gt-sm"},ye=A({__name:"FrontpageTriggerButtons",props:{triggers:{}},emits:["triggerAction"],setup(h,{emit:i}){const e=i;function t(s,l){e("triggerAction",s,l)}return(s,l)=>(a(),f("div",ve,[(a(!0),f(U,null,K(s.triggers,(r,v)=>(a(),f("div",{key:v},[r.show_button&&!(n(Q.isEmpty)(r.title)&&n(Q.isEmpty)(r.icon))?(a(),w(N,{key:0,stack:"",color:r.use_custom_color?"custom":"primary","no-caps":"",rounded:"",class:x(["action-button col-auto glass-effect",["action-button-"+v]]),style:X({"--bg-custom":r.use_custom_color?r.custom_color:null}),onClick:C=>t(r.action,r.config_index)},{default:y(()=>[n(Q.isEmpty)(r.icon)?c("",!0):(a(),w(O,{key:0,name:`sym_o_${r.icon}`},null,8,["name"])),_("div",he,$(r.title),1)]),_:2},1032,["color","class","style","onClick"])):c("",!0)]))),128))]))}}),be={id:"preview-container",class:""},we={id:"preview-outer-container",class:"preview-center-element"},Se=["src"],ke=A({__name:"PreviewStream",props:{enableMirrorEffectStream:{type:Boolean},enableMirrorEffectFrame:{type:Boolean},enableBlurredBackgroundStream:{type:Boolean},frameOverlayImage:{}},setup(h){const i=h;let e=null,t=null,s=null,l=null;const r=(o,u,m)=>{(o.width!=m.width||o.height!=m.height)&&(o.width=m.width,o.height=m.height),u.drawImage(m,0,0)},v=J((o,u,m)=>{r(o,u,m)},300),{open:C,close:M}=Y("/api/aquisition/stream",{immediate:!1,autoReconnect:{retries:-1,delay:1e3},onConnected(){console.log("stream connected via websockets")},onDisconnected(o,u){console.log("stream disconnected",u)},async onMessage(o,u){if(e&&t||s&&l){const m=await createImageBitmap(new Blob([u.data],{type:"image/jpeg"}));e&&t&&r(e,t,m),s&&l&&v(s,l,m)}else console.error("jpeg bytes received but no canvas to draw to.")}}),b=S(()=>i.frameOverlayImage??!0);return q(()=>{console.log("preview stream mounted!");const o=document.getElementById("preview-inner-overlay");o&&(o.onload=function(){console.log(o.naturalWidth/o.naturalHeight);const u=document.getElementById("preview-inner-container");u.style.aspectRatio=Number(o.naturalWidth/o.naturalHeight).toFixed(4)}),e=document.getElementById("preview-inner-stream"),s=document.getElementById("preview-outer-blurred"),e&&(t=e.getContext("2d")),s&&(l=s.getContext("2d")),(e||s)&&C()}),Z(()=>{M()}),(o,u)=>(a(),f("div",be,[i.enableBlurredBackgroundStream?(a(),f("canvas",{key:0,id:"preview-outer-blurred",class:x(["preview-center-element",{mirroreffect:i.enableMirrorEffectStream}])},null,2)):c("",!0),_("div",we,[_("div",{id:"preview-inner-container",class:x(["preview-center-element",{"stream-no-preview":!b.value}])},[_("canvas",{id:"preview-inner-stream",class:x(["preview-center-element",{mirroreffect:i.enableMirrorEffectStream,cover:b.value,contain:!b.value}])},null,2),I(_("img",{id:"preview-inner-overlay",class:x(["preview-center-element contain",{mirroreffect:i.enableMirrorEffectFrame}]),src:i.frameOverlayImage},null,10,Se),[[E,b.value]])],2)])]))}}),Ce={key:1,class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},xe={key:2,id:"frontpage-countdown",class:"full-height full-width column justify-center content-center",style:{position:"absolute"}},Me=["innerHTML"],Be={key:0},Te={key:0},Ie={class:"q-gutter-md"},Ee={class:"gt-sm"},Ne={key:0},$e={class:"q-gutter-md"},Ae={class:"gt-sm"},Re=A({__name:"IndexPage",setup(h){const i=ee(),e=te(),t=ne(),s=oe(),l=F(0);ie(l,()=>{l.value>=5&&s.push("/admin"),l.value=0},{debounce:500});const r=S(()=>{const d=[];return Object.entries(t.configuration.actions).forEach(([g,B])=>{B.forEach((k,P)=>{const L={action:`actions/${g}`,config_index:P,show_button:k.trigger.ui_trigger.show_button,title:k.trigger.ui_trigger.title,icon:k.trigger.ui_trigger.icon,use_custom_color:k.trigger.ui_trigger.use_custom_color,custom_color:k.trigger.ui_trigger.custom_color};d.push(L)})}),d}),v=S(()=>t.configuration.uisettings.admin_button_invisible),C=S(()=>{const d=t.configuration.uisettings.enable_livestream_when_idle,g=t.configuration.uisettings.enable_livestream_when_active,B=e.isStateIdle,k=e.isStateRecording,P=e.isStateCountdown,L=e.isStateCapture;return B&&d||(P||L)&&g||k}),M=ae(C,500),b=S(()=>{const d=H.get(e.jobmodel.configuration_set,"processing.img_frame_enable",!1),g=H.get(e.jobmodel.configuration_set,"processing.img_frame_file","");return e.isStateCountdown&&d?g:e.isStateIdle&&t.configuration.uisettings.enable_livestream_frameoverlay?t.configuration.uisettings.livestream_frameoverlay_image:""}),o=()=>{v.value?l.value++:s.push("/admin")},u=(d,g)=>{R(`/api/${d}/${g}`)},m=()=>{R("/api/processing/next")};return(d,g)=>(a(),w(re,{id:"index-page",class:"q-pa-none full-height"},{default:y(()=>[n(M)?(a(),w(ke,{key:0,"frame-overlay-image":b.value,"enable-blurred-background-stream":n(t).configuration.uisettings.livestream_blurredbackground,"enable-mirror-effect-stream":n(t).configuration.uisettings.livestream_mirror_effect,"enable-mirror-effect-frame":n(t).configuration.uisettings.livestream_frameoverlay_mirror_effect},null,8,["frame-overlay-image","enable-blurred-background-stream","enable-mirror-effect-stream","enable-mirror-effect-frame"])):c("",!0),n(e).isStateProcessing?(a(),f("div",Ce,[p(ue,{size:"20em"})])):c("",!0),n(e).isStateCountdown?(a(),f("div",xe,[p(pe,{ref:"countdowntimer",duration:n(e).jobmodel.duration,"message-duration":n(t).configuration.uisettings.TAKEPIC_MSG_TIME,"message-text":n(t).configuration.uisettings.TAKEPIC_MSG_TEXT},null,8,["duration","message-duration","message-text"])])):c("",!0),n(e).isStateIdle?(a(),f("div",{key:3,id:"frontpage_text",innerHTML:n(t).configuration.uisettings.FRONTPAGE_TEXT},null,8,Me)):c("",!0),p(T,{position:"bottom",class:"q-mb-lg"},{default:y(()=>[n(e).isStateIdle?(a(),f("div",Be,[p(ye,{triggers:r.value,onTriggerAction:u},null,8,["triggers"])])):c("",!0)]),_:1}),p(T,{position:"top-left",class:"q-ma-lg"},{default:y(()=>[n(e).isStateIdle?(a(),f("div",Te,[_("div",Ie,[n(t).configuration.uisettings.show_gallery_on_frontpage?(a(),w(N,{key:0,id:"frontpage-button-to-gallery",color:"primary","no-caps":"",rounded:"",to:"/gallery",class:"action-button glass-effect"},{default:y(()=>[p(O,{left:"",name:"sym_o_photo_library"}),_("div",Ee,$(d.$t("BTN_LABEL_MAINPAGE_TO_GALLERY")),1)]),_:1})):c("",!0)])])):c("",!0)]),_:1}),p(T,{position:"top-right",class:"q-ma-lg"},{default:y(()=>[n(e).isStateIdle?(a(),f("div",Ne,[_("div",$e,[n(t).configuration.uisettings.show_admin_on_frontpage?(a(),w(N,{key:0,id:"frontpage-button-to-admin",rounded:"",color:"transparent","no-caps":"",class:x(["action-button action-button-admin glass-effect",{"action-button-admin-invisible":v.value}]),onClick:o},{default:y(()=>[p(O,{left:"",name:"sym_o_admin_panel_settings"}),_("div",Ae,$(d.$t("BTN_LABEL_MAINPAGE_TO_ADMIN")),1)]),_:1},8,["class"])):c("",!0)])])):c("",!0)]),_:1}),n(e).isStateRecording?(a(),w(T,{key:4,id:"frontpage-indicator-recording",position:"top",offset:[0,25],align:"center"},{default:y(()=>[p(de,{color:"red",size:"10em"}),g[1]||(g[1]=_("br",null,null,-1)),p(N,{flat:"",color:"red",label:"Stop recording",onClick:g[0]||(g[0]=B=>m())})]),_:1})):c("",!0),n(t).configuration.uisettings.enable_automatic_slideshow&&n(i).collection_number_of_items>0?(a(),w(le,{key:5,route:"/slideshow/random","timeout-ms":n(t).configuration.uisettings.show_automatic_slideshow_timeout*1e3,"warning-message":d.$t("MSG_WARN_BEFORE_AUTO_SLIDESHOW")},null,8,["timeout-ms","warning-message"])):c("",!0)]),_:1}))}});export{Re as default};
