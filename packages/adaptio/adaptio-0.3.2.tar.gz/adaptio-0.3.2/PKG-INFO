Metadata-Version: 2.4
Name: adaptio
Version: 0.3.2
Summary: Adaptio æ˜¯ä¸€ä¸ªåŸºäº Python asyncio çš„æ™ºèƒ½å¹¶å‘æ§åˆ¶å·¥å…·ã€‚å®ƒå€Ÿé‰´äº† TCP æ‹¥å¡æ§åˆ¶ç®—æ³•çš„æ€æƒ³ï¼Œå¯ä»¥æ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´å¹¶å‘ä»»åŠ¡çš„æ•°é‡ï¼Œä»è€Œä¼˜åŒ–ä»»åŠ¡ååé‡å¹¶é˜²æ­¢è¿‡è½½ã€‚æ­¤å¤–ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªè£…é¥°å™¨ï¼Œå½“ä»»åŠ¡å› ç³»ç»Ÿè¿‡è½½å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ã€‚
Project-URL: Homepage, https://github.com/Haskely/adaptio
Project-URL: Bug Reports, https://github.com/Haskely/adaptio/issues
Project-URL: Source, https://github.com/Haskely/adaptio
Author-email: Haskely <Haskely@live.com>
Requires-Python: >=3.10
Requires-Dist: aiohttp
Requires-Dist: colorlog
Requires-Dist: loguru
Description-Content-Type: text/markdown

# Adaptio

> æ™ºèƒ½è‡ªé€‚åº”çš„å¼‚æ­¥å¹¶å‘æ§åˆ¶åº“ï¼Œè®©ä½ çš„Pythonå¼‚æ­¥ä»»åŠ¡è¿è¡Œæ›´ç¨³å®šã€æ›´é«˜æ•ˆ

[![PyPI version](https://badge.fury.io/py/adaptio.svg)](https://badge.fury.io/py/adaptio)
[![Python Version](https://img.shields.io/pypi/pyversions/adaptio.svg)](https://pypi.org/project/adaptio/)
[![License](https://img.shields.io/github/license/Haskely/adaptio.svg)](https://github.com/Haskely/adaptio/blob/main/LICENSE)
[![Tests](https://github.com/Haskely/adaptio/workflows/Tests/badge.svg)](https://github.com/Haskely/adaptio/actions)

Adaptio æ˜¯ä¸€ä¸ªåŸºäº Python asyncio çš„æ™ºèƒ½å¹¶å‘æ§åˆ¶å·¥å…·ã€‚å®ƒå€Ÿé‰´äº† TCP æ‹¥å¡æ§åˆ¶ç®—æ³•çš„æ€æƒ³ï¼Œå¯ä»¥æ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´å¹¶å‘ä»»åŠ¡çš„æ•°é‡ï¼Œä»è€Œä¼˜åŒ–ä»»åŠ¡ååé‡å¹¶é˜²æ­¢è¿‡è½½ã€‚æ­¤å¤–ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªè£…é¥°å™¨ï¼Œå½“ä»»åŠ¡å› ç³»ç»Ÿè¿‡è½½å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ã€‚

## ç‰¹æ€§

- ğŸš€ åŠ¨æ€å¹¶å‘æ§åˆ¶ - è‡ªåŠ¨è°ƒæ•´å·¥ä½œåç¨‹æ•°é‡
- ğŸ›¡ï¸ è¿‡è½½ä¿æŠ¤ - å†…ç½®è¿‡è½½æ£€æµ‹å’Œå¤„ç†æœºåˆ¶
- ğŸ“ˆ è‡ªé€‚åº”è°ƒèŠ‚ - å€Ÿé‰´ TCP æ‹¥å¡æ§åˆ¶ç®—æ³•å®ç°å¹³æ»‘è°ƒèŠ‚
- ğŸ”„ è‡ªåŠ¨é‡è¯• - æä¾›è£…é¥°å™¨æ”¯æŒä»»åŠ¡é‡è¯•
- ğŸ¯ ç®€å•æ˜“ç”¨ - æä¾›ç›´è§‚çš„ API æ¥å£

## å®‰è£…

ä» PyPI å®‰è£…æœ€æ–°ç¨³å®šç‰ˆï¼š

```bash
pip install adaptio
```

## å¿«é€Ÿå¼€å§‹

æœ¬åº“æä¾›è‡ªé€‚åº”é‡è¯•è£…é¥°å™¨ï¼šwith_adaptive_retry

è¯¥è£…é¥°å™¨å¯ç”¨äºè‡ªåŠ¨é‡è¯•å› ç³»ç»Ÿè¿‡è½½ (ServiceOverloadError) è€Œå¤±è´¥çš„ä»»åŠ¡ã€‚

è£…é¥°å™¨å‚æ•°

- schedulerï¼ˆå¯é€‰ï¼‰ï¼šAdaptiveAsyncConcurrencyLimiter å®ä¾‹ï¼Œé»˜è®¤ä¸º Noneã€‚å¦‚æœä¸º Noneï¼Œåˆ™ä¸ºæ¯ä¸ªè£…é¥°çš„å‡½æ•°åˆ›å»ºç‹¬ç«‹çš„è°ƒåº¦å™¨ã€‚
- max_retriesï¼ˆå¯é€‰ï¼‰ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 1024 æ¬¡ã€‚
- retry_interval_secondsï¼ˆå¯é€‰ï¼‰ï¼šé‡è¯•ä¹‹é—´çš„é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ä¸º 1 ç§’ã€‚
- max_concurrencyï¼ˆå¯é€‰ï¼‰ï¼šå½“ scheduler ä¸º None æ—¶ä½¿ç”¨çš„æœ€å¤§å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º 256ã€‚
- min_concurrencyï¼ˆå¯é€‰ï¼‰ï¼šå½“ scheduler ä¸º None æ—¶ä½¿ç”¨çš„æœ€å°å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º 1ã€‚
- initial_concurrencyï¼ˆå¯é€‰ï¼‰ï¼šå½“ scheduler ä¸º None æ—¶ä½¿ç”¨çš„åˆå§‹å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º 1ã€‚
- adjust_overload_rateï¼ˆå¯é€‰ï¼‰ï¼šå½“ scheduler ä¸º None æ—¶ä½¿ç”¨çš„è¿‡è½½è°ƒæ•´ç‡ï¼Œé»˜è®¤ä¸º 0.1ã€‚
- overload_exceptionï¼ˆå¯é€‰ï¼‰ï¼šå½“ scheduler ä¸º None æ—¶æ£€æµ‹çš„è¿‡è½½å¼‚å¸¸ï¼Œé»˜è®¤ä¸º ServiceOverloadErrorã€‚
- log_levelï¼ˆå¯é€‰ï¼‰ï¼šå½“ scheduler ä¸º None æ—¶ä½¿ç”¨çš„æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ä¸º "INFO"ã€‚
- log_prefixï¼ˆå¯é€‰ï¼‰ï¼šå½“ scheduler ä¸º None æ—¶ä½¿ç”¨çš„æ—¥å¿—å‰ç¼€ï¼Œé»˜è®¤ä¸º ""ã€‚

ä½¿ç”¨æ–¹æ³•

ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ with_adaptive_retry è£…é¥°å™¨çš„ç¤ºä¾‹ï¼š

```python
from adaptio import with_adaptive_retry, ServiceOverloadError
import asyncio
import random

# è®¾è®¡ä¸€ä¸ªè¾¾åˆ° 16 å¹¶å‘å°±ä¼šè§¦å‘ ServiceOverloadError çš„æµ‹è¯•ä»»åŠ¡
sample_task_overload_threshold = 16
sample_task_running_count = 0

async def sample_task(task_id):
    """A sample task that simulates workload and triggers overload at a certain concurrency."""
    global sample_task_running_count
    sample_task_running_count += 1
    # æ¨¡æ‹Ÿéšæœºä»»åŠ¡è€—æ—¶
    await asyncio.sleep(random.uniform(1, 3))
    # æ¨¡æ‹Ÿè¿‡è½½é”™è¯¯
    if sample_task_running_count > sample_task_overload_threshold:
        sample_task_running_count -= 1
        raise ServiceOverloadError(
            f"Service overloaded with {sample_task_running_count} tasks > {sample_task_overload_threshold}"
        )
    else:
        sample_task_running_count -= 1
    return f"Task {task_id} done"

# æ–¹æ³•1ï¼šä½¿ç”¨é»˜è®¤é…ç½®
@with_adaptive_retry()
async def sample_task_with_retry(task_id):
    return await sample_task(task_id)

# æ–¹æ³•2ï¼šè‡ªå®šä¹‰é…ç½®å‚æ•°
@with_adaptive_retry(
    max_retries=512,
    retry_interval_seconds=3,
    max_concurrency=128,
    min_concurrency=4,
    initial_concurrency=4,
    adjust_overload_rate=0.2
)
async def sample_task_with_custom_retry(task_id):
    return await sample_task(task_id)

# æ–¹æ³•3ï¼šä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ï¼ˆå¤šä¸ªå‡½æ•°å…±äº«ï¼‰
# åˆ›å»ºä¸€ä¸ªå…±äº«çš„è°ƒåº¦å™¨å®ä¾‹
from adaptio import AdaptiveAsyncConcurrencyLimiter

shared_scheduler = AdaptiveAsyncConcurrencyLimiter(
    max_concurrency=64,
    min_concurrency=2,
    initial_concurrency=4,
    adjust_overload_rate=0.15
)

# å¤šä¸ªå‡½æ•°å…±äº«åŒä¸€ä¸ªè°ƒåº¦å™¨
@with_adaptive_retry(scheduler=shared_scheduler)
async def task_type_a(task_id):
    return await sample_task(task_id)

@with_adaptive_retry(scheduler=shared_scheduler)
async def task_type_b(task_id):
    return await sample_task(task_id)

# è¿è¡Œç¤ºä¾‹ä»»åŠ¡
async def main():
    print("=== æµ‹è¯•æ–¹æ³•1ï¼šä½¿ç”¨é»˜è®¤é…ç½® ===")
    tasks1 = [sample_task_with_retry(i) for i in range(100)]
    for result in asyncio.as_completed(tasks1):
        try:
            print(await result)
        except Exception as e:
            print(f"ä»»åŠ¡å¤±è´¥: {e}")

    print("\n=== æµ‹è¯•æ–¹æ³•2ï¼šä½¿ç”¨è‡ªå®šä¹‰é…ç½® ===")
    tasks2 = [sample_task_with_custom_retry(i) for i in range(100)]
    for result in asyncio.as_completed(tasks2):
        try:
            print(await result)
        except Exception as e:
            print(f"ä»»åŠ¡å¤±è´¥: {e}")

    print("\n=== æµ‹è¯•æ–¹æ³•3ï¼šä½¿ç”¨å…±äº«è°ƒåº¦å™¨ ===")
    # æ··åˆè¿è¡Œä¸åŒç±»å‹çš„ä»»åŠ¡ï¼Œå®ƒä»¬ä¼šå…±äº«å¹¶å‘é™åˆ¶
    tasks3 = []
    for i in range(100):
        if i % 2 == 0:
            tasks3.append(task_type_a(i))
        else:
            tasks3.append(task_type_b(i))

    for result in asyncio.as_completed(tasks3):
        try:
            print(await result)
        except Exception as e:
            print(f"ä»»åŠ¡å¤±è´¥: {e}")

if __name__ == "__main__":
    asyncio.run(main())
```

è§£é‡Š

- è‡ªåŠ¨é‡è¯•ï¼šå½“ä»»åŠ¡å›  ServiceOverloadError å¤±è´¥æ—¶ä¼šè‡ªåŠ¨é‡è¯•
- é…ç½®æ–¹å¼ï¼šç¤ºä¾‹å±•ç¤ºäº†ä¸‰ç§ä¸åŒçš„é…ç½®æ–¹å¼
  1. ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆæ¯ä¸ªå‡½æ•°ç‹¬ç«‹çš„è°ƒåº¦å™¨ï¼‰
  2. é€šè¿‡è£…é¥°å™¨å‚æ•°è‡ªå®šä¹‰é…ç½®ï¼ˆæ¯ä¸ªå‡½æ•°ç‹¬ç«‹çš„è°ƒåº¦å™¨ï¼‰
  3. ä½¿ç”¨è‡ªå®šä¹‰çš„è°ƒåº¦å™¨å®ä¾‹
     - å¯ä»¥è®©å¤šä¸ªä¸åŒçš„å‡½æ•°å…±äº«åŒä¸€ä¸ªè°ƒåº¦å™¨
     - å…±äº«è°ƒåº¦å™¨çš„å‡½æ•°ä¼šå…±åŒå—åˆ°å¹¶å‘é™åˆ¶
     - é€‚ç”¨äºéœ€è¦ç»Ÿä¸€ç®¡ç†å¤šä¸ªç›¸å…³å‡½æ•°èµ„æºä½¿ç”¨çš„åœºæ™¯
- ä»»åŠ¡ç®¡ç†ï¼šè°ƒåº¦å™¨ä¼šæ ¹æ®ç³»ç»Ÿè´Ÿè½½è‡ªåŠ¨è°ƒæ•´å¹¶å‘æ•°ï¼Œé¿å…æŒç»­è¿‡è½½

ä½¿ç”¨å»ºè®®

- å¦‚æœå¤šä¸ªå‡½æ•°è®¿é—®ç›¸åŒçš„èµ„æºï¼ˆå¦‚åŒä¸€ä¸ªAPIæˆ–æ•°æ®åº“ï¼‰ï¼Œå»ºè®®ä½¿ç”¨å…±äº«è°ƒåº¦å™¨æ¥ç»Ÿä¸€ç®¡ç†å¹¶å‘
- å¦‚æœå‡½æ•°ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤é…ç½®æˆ–ç‹¬ç«‹çš„è‡ªå®šä¹‰é…ç½®
- å…±äº«è°ƒåº¦å™¨å¯ä»¥æ›´ç²¾ç¡®åœ°æ§åˆ¶æ•´ä½“ç³»ç»Ÿè´Ÿè½½ï¼Œé¿å…èµ„æºè¿‡åº¦ä½¿ç”¨

## è£…é¥° aiohttp è¯·æ±‚å‡½æ•°

raise_on_aiohttp_overload è£…é¥°å™¨ç”¨äºå°† aiohttp çš„ç‰¹å®šHTTPçŠ¶æ€ç è½¬æ¢ä¸º ServiceOverloadError å¼‚å¸¸,ä¾¿äºä¸åŠ¨æ€ä»»åŠ¡è°ƒåº¦å™¨é›†æˆã€‚

è£…é¥°å™¨å‚æ•°:
- overload_status_codes (å¯é€‰): è¦è½¬æ¢ä¸ºè¿‡è½½å¼‚å¸¸çš„HTTPçŠ¶æ€ç åˆ—è¡¨,é»˜è®¤ä¸º (503, 429)

ä½¿ç”¨ç¤ºä¾‹:

```python
from adaptio import with_adaptive_retry, raise_on_aiohttp_overload
import aiohttp

@with_adaptive_retry()
@raise_on_aiohttp_overload()
async def fetch_data(session: aiohttp.ClientSession, url: str):
    async with session.get(url) as response:
        response.raise_for_status()
        return await response.json()

# ç»„åˆä½¿ç”¨ç¤ºä¾‹
async def main(data_id: str):
    async with aiohttp.ClientSession() as session:
        try:
            data = await fetch_data(session, f"http://api.example.com/data/{data_id}")
            print(f"è·å–æ•°æ®æˆåŠŸ: {data}")
        except Exception as e:
            print(f"è·å–æ•°æ®å¤±è´¥: {data_id=} {e}")

if __name__ == "__main__":
    asyncio.run(asyncio.gather(*(main(data_id) for data_id in range(100))))
```

è¯´æ˜:
- å½“è¯·æ±‚è¿”å› 503(Service Unavailable) æˆ– 429(Too Many Requests) çŠ¶æ€ç æ—¶,è£…é¥°å™¨ä¼šå°†å…¶è½¬æ¢ä¸º ServiceOverloadError
- å¯ä»¥ä¸ with_adaptive_retry è£…é¥°å™¨ç»„åˆä½¿ç”¨,å®ç°è‡ªåŠ¨é‡è¯•åŠŸèƒ½
- æ”¯æŒè‡ªå®šä¹‰éœ€è¦è½¬æ¢çš„çŠ¶æ€ç åˆ—è¡¨

ä½¿ç”¨å»ºè®®:
- å»ºè®®å°†æ­¤è£…é¥°å™¨ä¸ with_adaptive_retry ç»„åˆä½¿ç”¨,ä»¥å®ç°å®Œæ•´çš„è¿‡è½½å¤„ç†
- å¯ä»¥æ ¹æ®ç›®æ ‡ API çš„ç‰¹ç‚¹è‡ªå®šä¹‰è¿‡è½½çŠ¶æ€ç 
- è£…é¥°å™¨çš„é¡ºåºå¾ˆé‡è¦,raise_on_aiohttp_overload åº”è¯¥åœ¨å†…å±‚

## å¼‚æ­¥æ§åˆ¶è£…é¥°å™¨ï¼šwith_async_control

è¯¥è£…é¥°å™¨æä¾›äº†å…¨é¢çš„å¼‚æ­¥æ“ä½œæ§åˆ¶æ–¹æ¡ˆï¼Œæ”¯æŒå¹¶å‘æ•°é™åˆ¶ã€QPSæ§åˆ¶å’Œé‡è¯•æœºåˆ¶ã€‚

è£…é¥°å™¨å‚æ•°ï¼š

- exception_typeï¼šè¦æ•è·çš„å¼‚å¸¸ç±»å‹ï¼Œé»˜è®¤ä¸º Exception
- max_concurrencyï¼šæœ€å¤§å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º 0ï¼ˆä¸é™åˆ¶ï¼‰
- max_qpsï¼šæ¯ç§’æœ€å¤§è¯·æ±‚æ•°ï¼Œé»˜è®¤ä¸º 0ï¼ˆä¸é™åˆ¶ï¼‰
- retry_nï¼šé‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 3 æ¬¡
- retry_delayï¼šé‡è¯•é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ä¸º 1.0 ç§’

ä½¿ç”¨ç¤ºä¾‹ï¼š

```python
from adaptio import with_async_control
import asyncio

@with_async_control(
    exception_type=ValueError,  # åªæ•è· ValueError
    max_concurrency=5,    # æœ€å¤š5ä¸ªå¹¶å‘
    max_qps=10,       # æ¯ç§’æœ€å¤š10ä¸ªè¯·æ±‚
    retry_n=2,        # å¤±è´¥åé‡è¯•2æ¬¡
    retry_delay=0.5   # é‡è¯•é—´éš”0.5ç§’
)
async def api_call(i: int) -> str:
    # æ¨¡æ‹ŸAPIè°ƒç”¨
    await asyncio.sleep(1.0)
    return f"è¯·æ±‚ {i} æˆåŠŸ"

async def main():
    # åˆ›å»ºå¤šä¸ªå¹¶å‘ä»»åŠ¡
    tasks = [api_call(i) for i in range(10)]

    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    results = await asyncio.gather(*tasks)
    for i, result in enumerate(results):
        print(f"ä»»åŠ¡ {i}: {result}")

if __name__ == "__main__":
    asyncio.run(main())
```

ä½¿ç”¨åœºæ™¯ï¼š

- APIè°ƒç”¨é™æµï¼šæ§åˆ¶å¯¹å¤–éƒ¨æœåŠ¡çš„è¯·æ±‚é¢‘ç‡
- èµ„æºè®¿é—®æ§åˆ¶ï¼šé™åˆ¶å¯¹æ•°æ®åº“æˆ–å…¶ä»–å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®
- ç®€å•é‡è¯•éœ€æ±‚ï¼šå¤„ç†ä¸´æ—¶æ€§æ•…éšœçš„åœºæ™¯

ä¸ with_adaptive_retry çš„åŒºåˆ«ï¼š

- with_async_control æ›´é€‚åˆå›ºå®šçš„å¹¶å‘æ§åˆ¶åœºæ™¯
- with_adaptive_retry æä¾›åŠ¨æ€çš„è´Ÿè½½è‡ªé€‚åº”èƒ½åŠ›
- æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„è£…é¥°å™¨

## å¼€å‘æŒ‡å—

### ç¯å¢ƒè®¾ç½®

1. å…‹éš†ä»“åº“å¹¶åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š
```bash
git clone https://github.com/Haskely/adaptio.git
cd adaptio
python3.10 -m venv .venv --prompt adaptio
source .venv/bin/activate  # Linux/macOS
# æˆ–
.venv\Scripts\activate  # Windows
```

2. å®‰è£…å¼€å‘ä¾èµ–ï¼š
```bash
pip install -e ".[dev]"
pre-commit install
```

### ä»£ç è§„èŒƒ

æœ¬é¡¹ç›®ä½¿ç”¨å¤šä¸ªå·¥å…·ç¡®ä¿ä»£ç è´¨é‡ï¼š

1. Ruffï¼šç”¨äºä»£ç æ ¼å¼åŒ–å’Œ lint
   - è‡ªåŠ¨ä¿®å¤ï¼š`ruff check --fix .`
   - æ ¼å¼åŒ–ï¼š`ruff format .`

2. MyPyï¼šç”¨äºé™æ€ç±»å‹æ£€æŸ¥
   - æœ¬é¡¹ç›®å¯ç”¨äº†ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼ŒåŒ…æ‹¬ï¼š
     - ç¦æ­¢æœªç±»å‹åŒ–çš„å‡½æ•°å®šä¹‰
     - ç¦æ­¢æœªå®Œæˆçš„å‡½æ•°å®šä¹‰
     - ç¦æ­¢æœªç±»å‹åŒ–çš„è£…é¥°å™¨
     - å¼ºåˆ¶å¯é€‰ç±»å‹æ˜¾å¼å£°æ˜
   - è¿è¡Œæ£€æŸ¥ï¼š`mypy .`

3. Pre-commit hooksï¼š
   - æäº¤å‰è‡ªåŠ¨è¿è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š
     - Ruff æ£€æŸ¥å’Œæ ¼å¼åŒ–
     - MyPy ç±»å‹æ£€æŸ¥
     - å°¾éšç©ºæ ¼æ£€æŸ¥
     - æ–‡ä»¶ç»“å°¾ç©ºè¡Œæ£€æŸ¥
     - å•å…ƒæµ‹è¯•

### æµ‹è¯•

è¿è¡Œå•å…ƒæµ‹è¯•ï¼š
```bash
python -m unittest discover tests
```

### ç±»å‹æç¤º

æœ¬é¡¹ç›®å®Œå…¨æ”¯æŒç±»å‹æç¤ºï¼Œå¹¶åŒ…å« `py.typed` æ ‡è®°æ–‡ä»¶ã€‚ä½¿ç”¨è€…å¯ä»¥åœ¨ä»–ä»¬çš„é¡¹ç›®ä¸­è·å¾—å®Œæ•´çš„ç±»å‹æ£€æŸ¥æ”¯æŒã€‚

ç¤ºä¾‹ï¼š
```python
from adaptio import AdaptiveAsyncConcurrencyLimiter
from typing import AsyncIterator

async def process_items(items: AsyncIterator[str]) -> None:
    scheduler = AdaptiveAsyncConcurrencyLimiter(
        max_concurrency=10,
        min_concurrency=1
    )
    async for item in items:
        await scheduler.submit(process_item(item))
```

### å‘å¸ƒæ–°ç‰ˆæœ¬

1. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆä½¿ç”¨ git tagï¼‰ï¼š
```bash
cz bump
git push --follow-tags
```

2. CI/CD å°†è‡ªåŠ¨ï¼š
   - è¿è¡Œæµ‹è¯•
   - æ„å»ºåŒ…
   - å‘å¸ƒåˆ° PyPI

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆå§‹å¹¶å‘æ•°ï¼Ÿ
A: å»ºè®®ä»è¾ƒå°çš„å€¼å¼€å§‹ï¼ˆå¦‚4-8ï¼‰ï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨è°ƒèŠ‚åˆ°æœ€ä¼˜å€¼ã€‚è¿‡å¤§çš„åˆå§‹å€¼å¯èƒ½å¯¼è‡´ç³»ç»Ÿå¯åŠ¨æ—¶å‡ºç°è¿‡è½½ã€‚

### Q: ä¸åŒè£…é¥°å™¨çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ
A:
- `with_adaptive_retry`: é€‚åˆéœ€è¦åŠ¨æ€è°ƒèŠ‚å¹¶å‘çš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯è´Ÿè½½å˜åŒ–è¾ƒå¤§çš„æƒ…å†µ
- `with_async_control`: é€‚åˆéœ€è¦å›ºå®šå¹¶å‘é™åˆ¶å’ŒQPSæ§åˆ¶çš„åœºæ™¯
- `raise_on_aiohttp_overload`: ä¸“é—¨ç”¨äºå¤„ç†HTTPè¯·æ±‚çš„è¿‡è½½æƒ…å†µ

### Q: å¦‚ä½•ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ï¼Ÿ
A: å¯ä»¥é€šè¿‡è®¾ç½® `log_level="DEBUG"` æ¥æŸ¥çœ‹è¯¦ç»†çš„è°ƒèŠ‚è¿‡ç¨‹ï¼Œæˆ–è€…ç›´æ¥è®¿é—®è°ƒåº¦å™¨çš„å±æ€§å¦‚ `current_concurrency` è·å–è¿è¡Œæ—¶çŠ¶æ€ã€‚
