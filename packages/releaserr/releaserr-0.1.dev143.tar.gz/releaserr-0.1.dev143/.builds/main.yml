---
# Copyright (C) 2023 Maxwell G <maxwell@gtmx.me>
# SPDX-License-Identifier: MIT

image: fedora/rawhide
packages:
  - pipx
  - python3.9
  - python3.10-devel
  - python3.11-devel
  - python3.12-devel
  - python3.13-devel
  - python3-devel
sources:
  - "https://git.sr.ht/~gotmax23/releaserr"
secrets:
  - db5dd8c3-cae4-4f82-84e6-24f398ef9f33
tasks:
  - setup-pipx: |
      pipx install nox

  - nox-codeqa: |
      cd releaserr
      nox -e codeqa

  - nox-formatters: |
      cd releaserr
      nox -e formatters

  - nox-typing: |
      cd releaserr
      nox -e typing

  - nox-integration: |
      cd releaserr
      nox -e integration

  - publish: |
      cd releaserr
      if [ "${BUILD_SUBMITTER-}" != "git.sr.ht" ] || ! [ -f "${HOME}/.pypirc" ] || git show -q --format=%B | grep -qF -e '[skip publish]' -e '[no publish]'; then
          exit 0
        fi
      nox -e publish
