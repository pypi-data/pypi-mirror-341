(self.webpackChunkcad_viewer_widget=self.webpackChunkcad_viewer_widget||[]).push([[103,509,997],{1250:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CadViewerSidecarModel:()=>n,CadViewerSidecarView:()=>h});var s=i(5824),l=i(4518),a=i(1797);i(7103);class n extends s.output.OutputModel{constructor(...e){super(...e),this.rendered=!1}defaults(){return{...super.defaults(),_model_name:"CadViewerSidecarModel",_model_module:a.c,_model_module_version:a.y,_view_name:"CadViewerSidecarView",_view_module:a.c,_view_module_version:a.y,title:"CadViewer",anchor:"right",width:null}}initialize(e,t){super.initialize(e,t),this.widget_manager.create_view(this,{})}}class h extends s.output.OutputView{constructor(...e){super(...e),this.shell=l.A.getShell(),this.disposed=!1,this.widget=null,this.title=null}dispose(){this.disposed||(l.A.removeSidecar(this.title),this._outputView.title.owner.disposed.disconnect(this.dispose,this),null!=this.child&&this.child.dispose(),console.debug(`cad-viewer-widget: Sidecar viewer "${this.title}" removed`)),this.disposed=!0}disposeSidebar(e,t){this.title===t.title.label&&(this.shell._rightHandler.sideBar.tabCloseRequested.disconnect(this.disposeSidebar,this),t.title.owner.dispose())}resizeSidebar(){const e=this.model.get("width");if(null!=e&&"right"==this.model.get("anchor")){const l=this.shell._hsplitPanel,a=l.node.getBoundingClientRect().width;var t=a*l.relativeSizes()[0];isNaN(t)&&(t=0);var i=e,s=a-i-t;s<0&&(s=400,i-=400),l.setRelativeSizes([t/a,s/a,i/a])}}registerChild(e){this.child=e}render(){if(this.title=this.model.get("title"),null!=this.title&&null!=l.A.getSidecar(this.title)&&(l.A.getSidecar(this.title).widget.title.owner.dispose(),this.model.rendered=!1),!this.model.rendered){if(super.render(),this.widget=this._outputView,this.widget.addClass("jp-LinkedOutputView"),this.widget.addClass("cvw-sidecar"),this.widget.title.label=this.title,this.widget.title.closable=!0,this.widget.id=`cvw_sidecar_${Math.random().toString().slice(2)}`,Object.keys(this.model.views).length>1){this.widget.node.style.display="none";let e=Object.keys(this.model.views)[0];this.model.views[e].then((e=>{e instanceof s.output.OutputView&&e._outputView.activate()}))}else{let i=this.model.get("anchor")||"right";"right"===i?(this.shell.add(this.widget,"right"),this.shell._rightHandler.sideBar.tabCloseRequested.connect(this.disposeSidebar,this)):(this.shell.add(this.widget,"main",{mode:i}),this.widget.onCloseRequest=(e=this.widget.onCloseRequest,t=this,function(i){t.dispose(),e.apply(t.widget,i)})),this.widget.title.owner.disposed.connect(this.dispose,this),this.shell.activateById(this.widget.id)}l.A.addSidecar(this.title,this),this.model.on("change:width",this.resizeSidebar,this),this.model.rendered=!0,console.debug(`cad-viewer-widget: Sidecar viewer "${this.title}" registered`)}var e,t;window.currentSidecar=this}}},1797:(e,t,i)=>{"use strict";i.d(t,{c:()=>s,y:()=>l});const s="cad-viewer-widget",l="3.0.2"},3296:(e,t,i)=>{"use strict";i.d(t,{A:()=>p});var s=i(6551),l=i.n(s),a=i(1992),n=i.n(a),h=i(9029),r=i(5379),o=i.n(r),d=new URL(i(6726),i.b),c=n()(l());c.i(h.A);var g=o()(d);c.push([e.id,`.cvw-sidecar {\n  background: var(--jp-layout-color0);\n  display: flex;\n  flex-direction: row;\n}\n\n.cvw-sidecar>.jp-Toolbar {\n  display: none;\n}\n\n.cvw-sidecar>.lm-Widget {\n  top: 0px !important;\n}\n\n.cvw-sidecar>.lm-Widget>.jp-OutputPrompt {\n  width: 0px !important;\n  flex: 0 0 0;\n}\n\n.jupyterlab-sidecar .jp-OutputPrompt.jp-OutputArea-prompt {\n  display: none;\n}\n\n.jupyterlab-sidecar>.jp-OutputArea-child {\n  flex: 1;\n}\n\n.jp-SideBar.jp-mod-right .p-TabBar-tabCloseIcon,\n.jp-SideBar.jp-mod-right .lm-TabBar-tabCloseIcon {\n  padding: 4px 0px 4px 4px;\n  background-size: 16px;\n  height: 16px;\n  width: 16px;\n  /* background-image: var(--jp-icon-close); */\n  background-image: url(${g});\n  background-position: center;\n  background-repeat: no-repeat;\n  align-self: center;\n}\n\n.jp-SideBar .lm-TabBar-tab {\n  padding: 16px 0px 0px 0px;\n}`,""]);const p=c},4518:(e,t,i)=>{"use strict";i.d(t,{A:()=>h});var s=null,l={},a={},n=null;const h={getCadViewers:()=>({sidecar:l,cell:a}),getSidecar:e=>l[e],addSidecar(e,t){n=t,l[e]=t},removeSidecar(e){delete l[e]},getCurrentViewer:()=>n,setCurrentViewer(e){n=e},addCellViewer(e,t){n=t,a[e]=t,console.log(`cad-viewer-widget: Cell viewer ${e} created`)},cleanupCellViewers(){for(const[e,t]of Object.entries(a))null==document.getElementById(e)&&(t.dispose(),delete a[e],console.log(`cad-viewer-widget: Cell viewer "${e}" removed`))},removeCellViewer(e){delete a[e]},setShell(e){s=e},getShell:()=>s}},5569:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CadViewerModel:()=>c,CadViewerView:()=>g});var s=i(1513),l=i(7412);const a={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function n(e,t){return null!=e&&"object"==typeof e&&null!=e.constructor&&e.constructor.name===t}function h(e,t,i=1e-9){if(n(e,"Vector3")&&(e=e.toArray()),n(t,"Vector3")&&(t=t.toArray()),Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every(((e,i)=>h(e,t[i])));if(null!=e&&null!=t&&"object"==typeof e&&"object"==typeof t){var s=Object.keys(e),l=Object.keys(t);return!(s.length!=l.length||!s.every((e=>Object.prototype.hasOwnProperty.call(t,e))))&&s.every((i=>h(e[i],t[i])))}return Number(e)===e&&Number(t)===t?Math.abs(e-t)<i:e===t}function r(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}var o=i(1797),d=(i(7103),i(4518));class c extends s.DOMWidgetModel{defaults(){return{...super.defaults(),_model_name:"CadViewerModel",_model_module:o.c,_model_module_version:o.y,_view_name:"CadViewerView",_view_module:o.c,_view_module_version:o.y,id:null,title:null,anchor:null,cad_width:null,height:null,tree_width:null,aspect_ratio:null,theme:null,pinning:null,newTreeBehavior:null,shapes:null,states:null,tracks:null,timeit:null,tools:null,glass:null,ortho:null,control:null,up:null,axes:null,axes0:null,grid:null,center_grid:null,explode:null,ticks:null,transparent:null,black_edges:null,collapse:null,normal_len:null,default_edgecolor:null,default_opacity:null,ambient_intensity:null,direct_intensity:null,metalness:null,roughness:null,tab:null,clip_intersection:null,clip_planes:null,clip_normal_0:null,clip_normal_1:null,clip_normal_2:null,clip_slider_0:null,clip_slider_1:null,clip_slider_2:null,reset_camera:!0,position:null,quaternion:null,target:null,zoom:null,zoom_speed:null,pan_speed:null,rotate_speed:null,animation_speed:null,lastPick:null,initialize:null,image_id:null,result:"",debug:!1,disposed:!1,rendered:!1}}}class g extends s.DOMWidgetView{initialize(...e){super.initialize(...e),this.lastPosition=null,this.lastQuaternion=null,this.lastTarget=null,this.lastZoom=null,this.empty=!0,this.activeTab="",this.display=null,this.viewer=null}debug(...e){this._debug&&console.debug("cad-viewer-widget: ",...e)}render(){this.model.rendered||(super.render(),this.model.on("change:initialize",this.clearOrAddShapes,this),this.model.on("change:tracks",this.handle_change,this),this.model.on("change:position",this.handle_change,this),this.model.on("change:quaternion",this.handle_change,this),this.model.on("change:target",this.handle_change,this),this.model.on("change:zoom",this.handle_change,this),this.model.on("change:axes",this.handle_change,this),this.model.on("change:grid",this.handle_change,this),this.model.on("change:axes0",this.handle_change,this),this.model.on("change:ortho",this.handle_change,this),this.model.on("change:explode",this.handle_change,this),this.model.on("change:transparent",this.handle_change,this),this.model.on("change:black_edges",this.handle_change,this),this.model.on("change:collapse",this.handle_change,this),this.model.on("change:tools",this.handle_change,this),this.model.on("change:glass",this.handle_change,this),this.model.on("change:cad_width",this.handle_change,this),this.model.on("change:tree_width",this.handle_change,this),this.model.on("change:height",this.handle_change,this),this.model.on("change:pinning",this.handle_change,this),this.model.on("change:default_edgecolor",this.handle_change,this),this.model.on("change:default_opacity",this.handle_change,this),this.model.on("change:ambient_intensity",this.handle_change,this),this.model.on("change:direct_intensity",this.handle_change,this),this.model.on("change:metalness",this.handle_change,this),this.model.on("change:roughness",this.handle_change,this),this.model.on("change:zoom_speed",this.handle_change,this),this.model.on("change:pan_speed",this.handle_change,this),this.model.on("change:rotate_speed",this.handle_change,this),this.model.on("change:state_updates",this.handle_change,this),this.model.on("change:tab",this.handle_change,this),this.model.on("change:clip_intersection",this.handle_change,this),this.model.on("change:clip_planes",this.handle_change,this),this.model.on("change:clip_normal_0",this.handle_change,this),this.model.on("change:clip_normal_1",this.handle_change,this),this.model.on("change:clip_normal_2",this.handle_change,this),this.model.on("change:clip_slider_0",this.handle_change,this),this.model.on("change:clip_slider_1",this.handle_change,this),this.model.on("change:clip_slider_2",this.handle_change,this),this.model.on("change:debug",this.handle_change,this),this.model.on("change:disposed",this.handle_change,this),this.model.on("change:center_grid",this.handle_change,this),this.model.on("change:clip_object_colors",this.handle_change,this),this.model.on("change:measure",this.handle_change,this),this.listenTo(this.model,"msg:custom",this.onCustomMessage.bind(this)),this.shell=d.A.getShell(),this.backupClipping(),this.init=!1,this.disposed=!1,this.title=this.model.get("title"),this.anchor=this.model.get("anchor"),this.container=null,this.container_id=null,this.observer=null,this.height=null,this.width=null,d.A.cleanupCellViewers(),this._position=null,this._quaternion=null,this._target=null,this._zoom=null,this._camera_distance=null,this._clipping=null,window.getCadViewers=d.A.getCadViewers,window.currentCadViewer=this,this.model.rendered=!0)}getDisplayOptions(){return{cadWidth:this.model.get("cad_width"),height:this.model.get("height"),treeWidth:this.model.get("tree_width"),theme:this.model.get("theme"),glass:this.model.get("glass"),tools:this.model.get("tools"),pinning:this.model.get("pinning"),keymap:this.model.get("keymap"),newTreeBehavior:this.model.get("new_tree_behavior")}}getRenderOptions(){var e={normalLen:this.model.get("normal_len"),edgeColor:this.model.get("default_edgecolor"),defaultOpacity:this.model.get("default_opacity"),ambientIntensity:this.model.get("ambient_intensity"),directIntensity:this.model.get("direct_intensity"),metalness:this.model.get("metalness"),roughness:this.model.get("roughness"),measureTools:!0};return this.debug("getRenderOptions",e),e}getViewerOptions(){let e={1:1,E:0,C:2,R:3};const t={control:"control",up:"up",tools:"tools",glass:"glass",axes:"axes",axes0:"axes0",grid:"grid",ortho:"ortho",ticks:"ticks",collapse:"collapse",transparent:"transparent",black_edges:"blackEdges",timeit:"timeit",zoom_speed:"zoomSpeed",pan_speed:"panSpeed",rotate_speed:"rotateSpeed",center_grid:"centerGrid",clip_slider_0:"clipSlider0",clip_slider_1:"clipSlider1",clip_slider_2:"clipSlider2",clip_normal_0:"clipNormal0",clip_normal_1:"clipNormal1",clip_normal_2:"clipNormal2",clip_intersection:"clipIntersection",clip_planes:"clipPlaneHelpers",clip_object_colors:"clipObjectColors",new_tree_behavior:"newTreeBehavior"};var i={measureTools:!0};for(let s of Object.keys(t))if(null!=this.model.get(s)){i[t[s]]="grid"==s?this.model.get(s).slice():"collapse"==s?e[this.model.get(s)]:this.model.get(s)}return this.debug("getViewerOptions",i),i}dispose(){this.disposed||(this.viewer.dispose(),this.disposed=!0,this.model.set("disposed",!0),this.model.save_changes())}_barHandler(e,t){this.title===t.title.label&&(this.shell._rightHandler.sideBar.tabCloseRequested.disconnect(this._barHandler,this),this.widget.title.owner.dispose())}resize=e=>{var t=Math.round(e.width),i=Math.round(e.height);const s=this.getDisplayOptions();if(this.viewer&&this.viewer.ready){if(t>0&&i>0){s.glass||(t-=s.treeWidth),t=Math.max(780,t-12),i-=60;const e=this.model.get("aspect_ratio");null!=this.title&&e>0&&(t<(i=Math.round(Math.min(i,e*t)))?i=Math.round(Math.min(i,e*t)):t=Math.round(Math.max(780,Math.min(t,i/e)))),this.viewer.resizeCadView(t,s.treeWidth,i,s.glass)}this.model.set("cad_width",t),this.model.set("height",i),this.model.save_changes()}};showViewer(){const e=this.getDisplayOptions();if(this._debug=this.model.get("debug"),null==this.display){const t=document.createElement("div");t.id=`cvw_${Math.random().toString().slice(2)}`,t.innerHTML="",this.container_id=t.id,this.container=t,null==this.title?d.A.addCellViewer(t.id,this):d.A.getSidecar(this.title).registerChild(this),this.el.appendChild(t);let i=t.parentNode.parentNode.getBoundingClientRect();null==e.height&&(this.height=Math.round(i.height)-60,e.height=this.height,this.model.set("height",this.height),this.model.save_changes()),e.cadWidth<i.width&&null!=this.title&&(this.width=Math.round(i.width-(e.glass?0:e.treeWidth))-12,e.cadWidth=this.width,this.model.set("cad_width",this.width),this.model.save_changes()),this.display=new l.Display(t,e),null!=this.title&&(this.observer=new ResizeObserver((e=>{for(const t of e)this.resize(t.contentRect)})),this.observer.observe(t.parentNode.parentNode))}this.display.glassMode(e.glass),this.display.showTools(e.tools),null!=this.viewer&&this.clear(),this.viewer=new l.Viewer(this.display,e,this.handleNotification.bind(this),null)}handleNotification(e){Object.keys(e).forEach((t=>{const i=e[t].new;this.model.set(t,i),this.debug(`Setting Python attribute ${t} to`,i)})),this.model.save_changes()}clear(){this.viewer.hasAnimationLoop=!1,this.viewer.continueAnimation=!1,this.viewer.dispose(),this.viewer=null}clearOrAddShapes(){this.init=this.model.get("initialize"),this.init?(this.empty||(this.lastPosition=this.viewer.getCameraPosition(),this.lastQuaternion=this.viewer.getCameraQuaternion(),this.lastZoom=this.viewer.getCameraZoom(),this.lastTarget=this.viewer.getCameraTarget()),this.showViewer()):(this.addShapes(),null!=this.title&&this.resize(this.container.parentNode.parentNode.getBoundingClientRect()))}backupClipping(){this.clipSettings={tab:this.model.get("tab"),clip_planes:this.model.get("clip_planes"),clip_intersection:this.model.get("clip_intersection"),clip_normal_0:this.model.get("clip_normal_0"),clip_normal_1:this.model.get("clip_normal_1"),clip_normal_2:this.model.get("clip_normal_2"),clip_slider_0:this.model.get("clip_slider_0"),clip_slider_1:this.model.get("clip_slider_1"),clip_slider_2:this.model.get("clip_slider_2")}}setClipping(){null!=this.clipSettings.tab&&this.viewer.display.selectTabByName(this.clipSettings.tab),null!=this.clipSettings.clip_intersection&&this.viewer.setClipIntersection(this.clipSettings.clip_intersection,!1),null!=this.clipSettings.clip_planes&&this.viewer.setClipPlaneHelpers(this.clipSettings.clip_planes,!1),null!=this.clipSettings.clip_normal_0&&this.viewer.setClipNormal(0,this.clipSettings.clip_normal_0,!1),null!=this.clipSettings.clip_normal_1&&this.viewer.setClipNormal(1,this.clipSettings.clip_normal_1,!1),null!=this.clipSettings.clip_normal_2&&this.viewer.setClipNormal(2,this.clipSettings.clip_normal_2,!1),null!=this.clipSettings.clip_slider_0&&this.viewer.setClipSlider(0,this.clipSettings.clip_slider_0,!1),null!=this.clipSettings.clip_slider_1&&this.viewer.setClipSlider(1,this.clipSettings.clip_slider_1,!1),null!=this.clipSettings.clip_slider_2&&this.viewer.setClipSlider(2,this.clipSettings.clip_slider_2,!1)}addShapes(){if(null==this.model.get("initialize"))return;this.shapes={data:this.model.get("shapes")},function(e){function t(e){var i;if("string"==typeof e.buffer){var s;s="b64"===e.codec?function(e){let t=atob(e),i=new Uint8Array(t.length);for(var s=0;s<t.length;s++)i[s]=t[s].charCodeAt(0);return i}(e.buffer):function(e){const t=new Uint8Array(Math.floor((e||"").length/2));let i;for(i=0;i<t.length;i++){const s=a[e[2*i]],l=a[e[2*i+1]];if(void 0===s||void 0===l)break;t[i]=s<<4|l}return i===t.length?t:t.slice(0,i)}(e.buffer),"float32"===e.dtype?i=new Float32Array(s.buffer):"int32"===e.dtype||"uint32"===e.dtype?i=new Uint32Array(s.buffer):console.log("Error: unknown dtype",e.dtype)}else{if(Array.isArray(e)){for(var l of(i=[],e))i.push(t(l));return i}console.log("Error: unknown buffer type",e.buffer)}return i}const i=e.data.instances;e.data.instances.forEach((e=>{e.vertices=t(e.vertices),e.obj_vertices=t(e.obj_vertices),e.normals=t(e.normals),e.edge_types=t(e.edge_types),e.face_types=t(e.face_types),e.triangles=t(e.triangles),e.triangles_per_face=t(e.triangles_per_face),e.edges=t(e.edges),e.segments_per_edge=t(e.segments_per_edge)})),function e(s){var l=null;for(var a in s)if("parts"===a)for(var n in s.parts)e(s.parts[n]);else if("type"===a)l=s.type;else if("shape"===a)if("shapes"===l)if(void 0===s.shape.ref)s.shape.vertices=t(s.shape.vertices),s.shape.obj_vertices=t(s.shape.obj_vertices),s.shape.normals=t(s.shape.normals),s.shape.edge_types=t(s.shape.edge_types),s.shape.face_types=t(s.shape.face_types),s.shape.triangles=t(s.shape.triangles),s.shape.triangles_per_face=t(s.shape.triangles_per_face),s.shape.edges=t(s.shape.edges),s.shape.segments_per_edge=t(s.shape.segments_per_edge);else{const e=s.shape.ref;void 0!==e&&(s.shape=i[e])}else"edges"===l?(s.shape.edges=t(s.shape.edges),s.shape.segments_per_edge=t(s.shape.segments_per_edge),s.shape.obj_vertices=t(s.shape.obj_vertices)):s.shape.obj_vertices=t(s.shape.obj_vertices)}(e.data.shapes),e.data.instances=[]}(this.shapes),this.shapes=this.shapes.data.shapes;const e=this.shapes.bb,t=[(e.xmax+e.xmin)/2,(e.ymax+e.ymin)/2,(e.zmax+e.zmin)/2];let i=Math.max(Math.sqrt(Math.pow(e.xmax-e.xmin,2)+Math.pow(e.ymax-e.ymin,2)+Math.pow(e.zmax-e.zmin,2)),r(t));const s=new l.Timer("addShapes",this.model.get("timeit")),n=this.model.get("reset_camera");this.tracks=[];var h=this.getViewerOptions();if(s.split("viewer"),this.viewer.cadWidth=this.model.get("cad_width"),null==this.viewer.cadWidth&&(this.viewer.cadWidth=this.width),this.viewer.treeWidth=this.model.get("tree_width"),this.viewer.height=this.model.get("height"),null==this.viewer.height&&(this.viewer.height=this.height),this.viewer.glass=this.model.get("glass"),"reset"===n)void 0!==this.model.get("zoom")&&(h.zoom=this.model.get("zoom")),void 0!==this.model.get("position")&&(h.position=this.model.get("position")),void 0!==this.model.get("quaternion")&&(h.quaternion=this.model.get("quaternion")),void 0!==this.model.get("target")&&(h.target=this.model.get("target")),this._camera_distance=null;else{if(this.model.get("position"))h.position=this.model.get("position");else if(this._position)if("keep"===n){const e=5*i;for(var o=[0,0,0],d=0;d<3;d++)o[d]=this._position[d]-this._target[d];o=function(e){let t=r(e);return[e[0]/t,e[1]/t,e[2]/t]}(o);var c="keep"===n?this._target:[0,0,0];for(d=0;d<3;d++)o[d]=o[d]*e+c[d]}else{for(o=[0,0,0],d=0;d<3;d++)o[d]=this._position[d]-this._target[d]+t[d];this._target=t}h.position=o,this._position=h.position,this.model.get("quaternion")?h.quaternion=this.model.get("quaternion"):this._quaternion&&(h.quaternion=this._quaternion),this.model.get("target")?h.target=this.model.get("target"):this._target&&(h.target=this._target),this.model.get("zoom")?h.zoom=this.model.get("zoom"):this._zoom&&(h.zoom=this._zoom)}this.viewer.render(this.shapes,this.getRenderOptions(),h),"keep"===n&&null!=this.camera_distance&&viewer.setCameraZoom((null==this.zoom?1:this.zoom)*viewer.camera.camera_distance/this.camera_distance),this._position=viewer.getCameraPosition(),this._quaternion=viewer.getCameraQuaternion(),this._target=viewer.controls.getTarget().toArray(),this._zoom=viewer.getCameraZoom(),this._camera_distance=viewer.camera.camera_distance,this.clipping={sliders:[viewer.getClipSlider(0),viewer.getClipSlider(1),viewer.getClipSlider(2)],normals:[viewer.getClipNormal(0),viewer.getClipNormal(1),viewer.getClipNormal(2)],planeHelpers:viewer.getClipPlaneHelpers(),objectColors:viewer.getObjectColorCaps(),intersection:viewer.getClipIntersection()},s.split("renderer"),this.model.set("position",this._position),this.model.set("quaternion",this._quaternion),this.model.set("target",this._target),this.model.set("zoom",this._zoom),this.model.save_changes(),this.setClipping();const g=this.model.get("tracks");if(""!=g&&null!=g&&(this.addTracks(g),this.animate()),null!=this.model.get("explode")){let e=this.model.get("explode");this.viewer.display.setExplode("",!e),this.viewer.display.setExplode("",e),this.viewer.display.setExplodeCheck(e)}return s.stop(),!0}updateCamera(){var e=this.viewer.getCameraZoom(),t=this.viewer.getCameraPosition(),i=this.viewer.getCameraQuaternion(),s=this.viewer.getCameraTarget();this.model.set("zoom",e),this.model.set("position",t),this.model.set("quaternion",i),this.model.set("target",s)}addTracks(e){if(this.tracks=e,Array.isArray(this.tracks)&&this.tracks.length>0)for(var t of this.tracks)this.viewer.addAnimationTrack(...t)}animate(){const e=this.model.get("animation_speed"),t=Math.max(...this.tracks.map((e=>Math.max(...e[2]))));e>0&&this.viewer.initAnimation(t,e)}clearAnimation(){this.viewer.clipAction&&this.viewer.controlAnimation("stop"),this.viewer.clearAnimation(),this.tracks=[]}handle_change(e){const t=(t,i,s,l=null,a=null)=>{if(null==this.viewer)return;const n=e.changed[s];h(null==l?this.viewer[t]():this.viewer[t](l),n)||(this.debug(`Setting Javascript attribute ${s} to`,n),null==l&&null==a?this.viewer[i](n,!0):null!=l&&null!=a?this.viewer[i](l,n,a,!0):null!=l?this.viewer[i](l,n,!0):null!=a&&this.viewer[i](n,a,!0))},i=Object.keys(e.changed)[0];if(this.init)this.debug("Ignore message");else{var s="",l=null,a=null;switch(this.debug("handle_change:",i,e.changed[i]),i){case"zoom":t("getCameraZoom","setCameraZoom",i),this._zoom=this.viewer.getCameraZoom();break;case"position":t("getCameraPosition","setCameraPosition",i,null,!1),this._position=this.viewer.getCameraPosition();break;case"quaternion":t("getCameraQuaternion","setCameraQuaternion",i),this._quaternion=this.viewer.getCameraQuaternion();break;case"target":t("getCameraTarget","setCameraTarget",i),this._target=this.viewer.getCameraTarget();break;case"axes":t("getAxes","setAxes",i);break;case"grid":t("getGrids","setGrids",i);break;case"center_grid":this.viewer.setGridCenter(e.changed[i]);break;case"axes0":t("getAxes0","setAxes0",i);break;case"ortho":t("getOrtho","switchCamera",i);break;case"transparent":t("getTransparent","setTransparent",i);break;case"black_edges":t("getBlackEdges","setBlackEdges",i);break;case"explode":if(null!=this.model.get("explode")){let t=e.changed[i];this.viewer.display.setExplode("",t),this.viewer.display.setExplodeCheck(!t),this.viewer.display.setExplodeCheck(t)}break;case"collapse":var n=e.changed[i];["1","R","E","C"].includes(n)&&this.viewer.display.collapseNodes(n);break;case"tools":t("getTools","showTools",i);break;case"glass":a=e.changed[i],this.viewer.display.glassMode(a);break;case"cad_width":l=e.changed[i],this.viewer.resizeCadView(l,this.model.get("tree_width"),this.model.get("height"),this.model.get("glass"));break;case"tree_width":l=e.changed[i],this.viewer.resizeCadView(this.model.get("cad_width"),l,this.model.get("height"),this.model.get("glass"));break;case"height":l=e.changed[i],this.viewer.resizeCadView(this.model.get("cad_width"),this.model.get("tree_width"),l,this.model.get("glass"));break;case"pinning":a=e.changed[i],this.viewer.display.showPinning(a);break;case"default_edgecolor":t("getEdgeColor","setEdgeColor",i);break;case"default_opacity":t("getOpacity","setOpacity",i);break;case"ambient_intensity":t("getAmbientLight","setAmbientLight",i,null,!0);break;case"direct_intensity":t("getDirectLight","setDirectLight",i,null,!0);break;case"metalness":t("getMetalness","setMetalness",i,null,!0);break;case"roughness":t("getRoughness","setRoughness",i,null,!0);break;case"zoom_speed":t("getZoomSpeed","setZoomSpeed",i);break;case"pan_speed":t("getPanSpeed","setPanSpeed",i);break;case"rotate_speed":t("getRotateSpeed","setRotateSpeed",i);break;case"tracks":""==(s=this.model.get("tracks"))?this.clearAnimation():this.addTracks(s);break;case"state_updates":var r=e.changed[i];for(var o in r)this.viewer.setState(o,r[o],!1);break;case"tab":l=e.changed[i],this.activeTab!==l&&(this.activeTab=l,"tree"===l||"clip"==l||"material"==l?this.viewer.display.selectTabByName(l):console.error(`cad-viewer-widget: unkonwn tab name ${l}`));break;case"clip_intersection":t("getClipIntersection","setClipIntersection",i);break;case"clip_planes":t("getClipPlaneHelpers","setClipPlaneHelpers",i);break;case"clip_normal_0":t("getClipNormal","setClipNormal",i,0,this.viewer.getClipSlider(0));break;case"clip_normal_1":t("getClipNormal","setClipNormal",i,1,this.viewer.getClipSlider(1));break;case"clip_normal_2":t("getClipNormal","setClipNormal",i,2,this.viewer.getClipSlider(2));break;case"clip_slider_0":t("getClipSlider","setClipSlider",i,0);break;case"clip_slider_1":t("getClipSlider","setClipSlider",i,1);break;case"clip_slider_2":t("getClipSlider","setClipSlider",i,2);break;case"clip_object_colors":this.viewer.setClipObjectColorCaps(e.changed[i]);break;case"debug":this._debug=e.changed[i];break;case"disposed":if(null!=this.title){const e=d.A.getSidecar(this.title);null!=e&&("right"==this.anchor?e.disposeSidebar(null,e.widget):e.widget.title.owner.dispose())}else this.dispose();break;case"measure":this.viewer.handleBackendResponse(e.changed[i])}}}exportPng(e,t){null==e?(this.model.set("result",JSON.stringify({display_id:this.model.get("image_id"),src:image.src,width:image.width,height:image.height})),this.model.save_changes(),this.dispose(),d.A.removeCellViewer(this.container_id)):(this.model.set("result",JSON.stringify({filename:e,src:t})),this.model.save_changes())}saveAsPng(e){this.viewer.getImage(e).then((e=>{this.exportPng(e.task,e.dataUrl)}))}pinAsPng(){this.viewer.pinAsPng()}onCustomMessage(e,t){this.debug("New message with msgType:",e.type,"msgId:",e.id,", method:",e.method,", args:",e.args,", buffers:",t);var i=this,s=e.method,l=s.pop();try{s.forEach((e=>i=i[e])),this.debug("object:",i,"method:",l)}catch(e){return void console.error(e)}var a=null;try{a=e.args,this.debug("args:",a)}catch(e){console.error(e)}var n=null;try{n=null==a?i[l]():i[l](...a),this.debug("method executed, result: ",n)}catch(e){console.log(e)}}}},6726:e=>{"use strict";e.exports="data:image/svg+xml,%3Csvg viewBox=%270 0 24 24%27 width=%2716%27 xmlns=%27http://www.w3.org/2000/svg%27%3E%3Cg class=%27jp-icon3 jp-icon-selectable jp-icon-accent2-hover%27 fill=%27%23616161%27%3E%3Cpath d=%27M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z%27/%3E%3C/g%3E%3C/svg%3E"},7103:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var s=i(8318),l=i.n(s),a=i(5879),n=i.n(a),h=i(237),r=i.n(h),o=i(4862),d=i.n(o),c=i(1050),g=i.n(c),p=i(8495),m=i.n(p),u=i(3296),_={};_.styleTagTransform=m(),_.setAttributes=d(),_.insert=r().bind(null,"head"),_.domAPI=n(),_.insertStyleElement=g(),l()(u.A,_);const w=u.A&&u.A.locals?u.A.locals:void 0},8330:e=>{"use strict";e.exports={version:"3.0.2"}},8509:(e,t,i)=>{var s=i(5569),l=i(1250);e.exports={...s,...l},e.exports.version=i(8330).version}}]);