export const id=4624;export const ids=[4624];export const modules={46999:(t,e,s)=>{s.d(e,{Vy:()=>n,fI:()=>o});var a=s(3254);const i=["#44739e","#984ea3","#00d2d5","#ff7f00","#af8d00","#7f80cd","#b3e900","#c42e60","#a65628","#f781bf","#8dd3c7","#bebada","#fb8072","#80b1d3","#fdb462","#fccde5","#bc80bd","#ffed6f","#c4eaff","#cf8c00","#1b9e77","#d95f02","#e7298a","#e6ab02","#a6761d","#0097ff","#00d067","#f43600","#4ba93b","#5779bb","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function n(t){return i[t%i.length]}function o(t,e){const s=e.getPropertyValue(`--graph-color-${t+1}`)||n(t);return(0,a.RQ)(s)}},96979:(t,e,s)=>{s.d(e,{I:()=>n});s(89655),s(253),s(54846),s(78266);class a{constructor(t=window.localStorage){this.storage=void 0,this._storage={},this._listeners={},this.storage=t,t===window.localStorage&&window.addEventListener("storage",(t=>{t.key&&this.hasKey(t.key)&&(this._storage[t.key]=t.newValue?JSON.parse(t.newValue):t.newValue,this._listeners[t.key]&&this._listeners[t.key].forEach((e=>e(t.oldValue?JSON.parse(t.oldValue):t.oldValue,this._storage[t.key]))))}))}addFromStorage(t){if(!this._storage[t]){const e=this.storage.getItem(t);e&&(this._storage[t]=JSON.parse(e))}}subscribeChanges(t,e){return this._listeners[t]?this._listeners[t].push(e):this._listeners[t]=[e],()=>{this.unsubscribeChanges(t,e)}}unsubscribeChanges(t,e){if(!(t in this._listeners))return;const s=this._listeners[t].indexOf(e);-1!==s&&this._listeners[t].splice(s,1)}hasKey(t){return t in this._storage}getValue(t){return this._storage[t]}setValue(t,e){const s=this._storage[t];this._storage[t]=e;try{void 0===e?this.storage.removeItem(t):this.storage.setItem(t,JSON.stringify(e))}catch(t){}finally{this._listeners[t]&&this._listeners[t].forEach((t=>t(s,e)))}}}const i={},n=t=>e=>{const s=t.storage||"localStorage";let n;s&&s in i?n=i[s]:(n=new a(window[s]),i[s]=n);const o=String(e.key),r=t.key||String(e.key),d=e.initializer?e.initializer():void 0;n.addFromStorage(r);const c=!1!==t.subscribe?t=>n.subscribeChanges(r,((s,a)=>{t.requestUpdate(e.key,s)})):void 0,u=()=>n.hasKey(r)?t.deserializer?t.deserializer(n.getValue(r)):n.getValue(r):d;return{kind:"method",placement:"prototype",key:e.key,descriptor:{set(s){((s,a)=>{let i;t.state&&(i=u()),n.setValue(r,t.serializer?t.serializer(a):a),t.state&&s.requestUpdate(e.key,i)})(this,s)},get:()=>u(),enumerable:!0,configurable:!0},finisher(s){if(t.state&&t.subscribe){const t=s.prototype.connectedCallback,e=s.prototype.disconnectedCallback;s.prototype.connectedCallback=function(){t.call(this),this[`__unbsubLocalStorage${o}`]=c?.(this)},s.prototype.disconnectedCallback=function(){e.call(this),this[`__unbsubLocalStorage${o}`]?.(),this[`__unbsubLocalStorage${o}`]=void 0}}t.state&&s.createProperty(e.key,{noAccessor:!0,...t.stateOptions})}}}},56136:(t,e,s)=>{s.d(e,{a:()=>a});const a=t=>!(t.native instanceof MouseEvent)||t.native instanceof PointerEvent&&"mouse"!==t.native.pointerType},20712:(t,e,s)=>{s.d(e,{E:()=>o});var a=s(36312),i=s(68689),n=s(77706);const o=t=>(0,a.A)(null,(function(t,e){class s extends e{constructor(...e){super(...e),t(this)}}return{F:s,d:[{kind:"field",decorators:[(0,n.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,i.A)(s,"connectedCallback",this,3)([]),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,i.A)(s,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const t=this.__unsubs.pop();t instanceof Promise?t.then((t=>t())):t()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(t){if((0,i.A)(s,"updated",this,3)([t]),t.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const e of t.keys())if(this.hassSubscribeRequiredHostProps.includes(e))return void this.__checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){void 0===this.__unsubs&&this.isConnected&&void 0!==this.hass&&!this.hassSubscribeRequiredHostProps?.some((t=>void 0===this[t]))&&(this.__unsubs=this.hassSubscribe())}}]}}),t)},23469:(t,e,s)=>{s.d(e,{g:()=>n});var a=s(3254),i=s(92164);function n(t,e,s,n,o,r){const d=t.getPropertyValue(o+"-"+r).trim(),c=d.length>0?d:t.getPropertyValue(o).trim();let u=(0,a.RQ)(c);return 0===d.length&&r&&(u=(0,a.v2)((0,a.BE)(e?(0,i.T)((0,a.Nc)((0,a.xp)(u)),r):(0,i.d)((0,a.Nc)((0,a.xp)(u)),r)))),n?u+=s?"32":"7F":s&&(u+="7F"),u}},37334:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{o:()=>f});var i=s(65513),n=s(31195),o=s(6711),r=s(83324),d=s(57636),c=s(57289),u=s(41924),h=t([d,c,u]);function l(t,e){let s=new Date(e);return t>2&&0===s.getHours()&&(s=(0,i.O)(s,1)),s.setMinutes(0,0,0),t>35&&s.setDate(1),t>2&&s.setHours(0),s.getTime()}function f(t,e,s,a,i,h,f){const p=(0,n.c)(e,t),_=void 0!==h&&void 0!==f;if(_&&p<=35){const s=(0,o.M)(e,t),a=(0,o.M)(f,h);a>s?e=(0,r.L)(e,a-s):s>a&&(f=(0,r.L)(f,s-a))}const k={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),max:l(p,e),adapters:{date:{locale:s,config:a}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:t=>t.tick&&t.tick.major?{weight:"bold"}:{}},time:{tooltipFormat:p>35?"monthyear":p>7?"date":p>2?"weekday":p>0?"datetime":"hour",minUnit:p>35?"month":p>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:i},ticks:{beginAtZero:!0,callback:t=>(0,d.ZV)(Math.abs(t),s)}}},plugins:{tooltip:{position:"nearest",filter:t=>"0"!==t.formattedValue,itemSort:function(t,e){return e.datasetIndex-t.datasetIndex},callbacks:{title:t=>{if(p>0)return t[0].label;const e=new Date(t[0].parsed.x);return`${_?`${(0,c.sl)(e,s,a)}: `:""}${(0,u.fU)(e,s,a)} â€“ ${(0,u.fU)((0,r.L)(e,1),s,a)}`},label:t=>`${t.dataset.label}: ${(0,d.ZV)(t.parsed.y,s)} ${i}`}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,d.Yf)(s)};return _&&(k.scales.xAxisCompare={...k.scales.x,suggestedMin:h.getTime(),max:l(p,f),display:!1}),k}[d,c,u]=h.then?(await h)():h,a()}catch(p){a(p)}}))},1799:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.r(e),s.d(e,{HuiEnergyDevicesDetailGraphCard:()=>S});var i=s(36312),n=(s(89655),s(253),s(2075),s(54846),s(16891),s(79784)),o=s(75697),r=s(15112),d=s(77706),c=s(85323),u=s(94100),h=s(46999),l=s(23469),f=(s(13082),s(47076)),p=s(4826),_=s(20712),k=s(7934),g=s(37334),b=s(34897),m=s(96979),v=s(56136),y=t([f,g]);[f,g]=y.then?(await y)():y;const x="kWh";let S=(0,i.A)([(0,d.EM)("hui-energy-devices-detail-graph-card")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,d.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,d.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,d.wk)()],key:"_chartData",value:()=>({datasets:[]})},{kind:"field",decorators:[(0,d.wk)()],key:"_chartDatasetExtra",value:()=>[]},{kind:"field",decorators:[(0,d.wk)()],key:"_data",value:void 0},{kind:"field",decorators:[(0,d.wk)()],key:"_start",value:()=>(0,n.R)()},{kind:"field",decorators:[(0,d.wk)()],key:"_end",value:()=>(0,o.o)()},{kind:"field",decorators:[(0,d.wk)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,d.wk)()],key:"_compareEnd",value:void 0},{kind:"field",decorators:[(0,m.I)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],key:"_hiddenStats",value:()=>[]},{kind:"field",key:"_untrackedIndex",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"hassSubscribe",value:function(){return[(0,f.tb)(this.hass,{key:this._config?.collection_key}).subscribe((t=>{this._data=t,this._processStatistics()}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,k.xP)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"willUpdate",value:function(t){(t.has("_hiddenStats")||t.has("_config"))&&this._data&&this._processStatistics()}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?r.qy` <ha-card> ${this._config.title?r.qy`<h1 class="card-header">${this._config.title}</h1>`:""} <div class="content ${(0,c.H)({"has-header":!!this._config.title})}"> <ha-chart-base externalHidden .hass="${this.hass}" .data="${this._chartData}" .extraData="${this._chartDatasetExtra}" .options="${this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,x,this._compareStart,this._compareEnd)}" chart-type="bar" @dataset-hidden="${this._datasetHidden}" @dataset-unhidden="${this._datasetUnhidden}"></ha-chart-base> </div> </ha-card> `:r.s6}},{kind:"method",key:"_datasetHidden",value:function(t){const e=t.detail.index===this._untrackedIndex?"untracked":this._data.prefs.device_consumption[t.detail.index].stat_consumption;this._hiddenStats=[...this._hiddenStats,e]}},{kind:"method",key:"_datasetUnhidden",value:function(t){const e=t.detail.index===this._untrackedIndex?"untracked":this._data.prefs.device_consumption[t.detail.index].stat_consumption;this._hiddenStats=this._hiddenStats.filter((t=>t!==e))}},{kind:"field",key:"_createOptions",value(){return(0,u.A)(((t,e,s,a,i,n,o)=>{const r=(0,g.o)(t,e,s,a,i,n,o);return{...r,interaction:{mode:"nearest"},plugins:{...r.plugins,legend:{display:!0,labels:{usePointStyle:!0}}},onClick:(t,e,s)=>{if((0,v.a)(t))return;const a=e[0]?.datasetIndex??-1;if(a<0)return;const i=this._data?.prefs.device_consumption[a]?.stat_consumption;i&&!(0,p.OQ)(i)&&((0,b.r)(this,"hass-more-info",{entityId:i}),s?.canvas?.dispatchEvent(new Event("mouseout")))}}}))}},{kind:"method",key:"_processStatistics",value:function(){const t=this._data,e=t.stats,s=t.statsCompare,a=getComputedStyle(this),i={};t.prefs.device_consumption.forEach((t=>{const s=t.stat_consumption in e&&(0,p.$j)(e[t.stat_consumption])||0;i[t.stat_consumption]=s}));const n=t.prefs.device_consumption.map((t=>t.stat_consumption));n.sort(((t,e)=>i[e]-i[t]));const r=[],d=[],{data:c,dataExtras:u}=this._processDataSet(a,e,t.statsMetadata,t.prefs.device_consumption,n);r.push(...c),d.push(...u);const{summedData:h,compareSummedData:l}=(0,f.gv)(t),_="from_grid"in h||"solar"in h||"from_battery"in h,{consumption:k,compareConsumption:g}=_?(0,f.DR)(h,l):{consumption:void 0,compareConsumption:void 0};if(_){this._untrackedIndex=r.length;const{dataset:t,datasetExtra:e}=this._processUntracked(a,c,k,!1);r.push(t),d.push(e)}if(s){r.push({order:0,data:[]}),d.push({show_legend:!1}),r.push({order:999,data:[],xAxisID:"xAxisCompare"}),d.push({show_legend:!1});const{data:e,dataExtras:i}=this._processDataSet(a,s,t.statsMetadata,t.prefs.device_consumption,n,!0);if(r.push(...e),d.push(...i),_){const{dataset:t,datasetExtra:s}=this._processUntracked(a,e,g,!0);r.push(t),d.push(s)}}this._start=t.start,this._end=t.end||(0,o.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,this._chartData={datasets:r},this._chartDatasetExtra=d}},{kind:"method",key:"_processUntracked",value:function(t,e,s,a){const i={};e.forEach((t=>{t.data.forEach((t=>{i[t.x]=(i[t.x]||0)+t.y}))}));const n=[];Object.keys(s.total).forEach((t=>{n.push({x:Number(t),y:s.total[t]-(i[t]||0)})}));return{dataset:{label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),hidden:this._hiddenStats.includes("untracked"),borderColor:(0,l.g)(t,this.hass.themes.darkMode,!1,a,"--state-unavailable-color"),backgroundColor:(0,l.g)(t,this.hass.themes.darkMode,!0,a,"--state-unavailable-color"),data:n,order:1+this._untrackedIndex,stack:"devices",pointStyle:!a&&"circle",xAxisID:a?"xAxisCompare":void 0},datasetExtra:{show_legend:!a}}}},{kind:"method",key:"_processDataSet",value:function(t,e,s,a,i,n=!1){const o=[],r=[];return a.forEach(((a,d)=>{const c=(0,h.fI)(d,t);let u=null;const l=[];if(a.stat_consumption in e){const t=e[a.stat_consumption];let s;for(const e of t){if(null===e.change||void 0===e.change)continue;if(u===e.start)continue;const t=new Date(e.start);l.push({x:t.getTime(),y:e.change}),u=e.start,s=e.end}1===l.length&&l.push({x:s,y:0})}const f=i.indexOf(a.stat_consumption),_=!!(this._config?.max_devices&&f>=this._config.max_devices);o.push({label:a.name||(0,p.$O)(this.hass,a.stat_consumption,s[a.stat_consumption]),hidden:this._hiddenStats.includes(a.stat_consumption)||_,borderColor:n?c+"7F":c,backgroundColor:n?c+"32":c+"7F",data:l,order:1+f,stack:"devices",pointStyle:!n&&"circle",xAxisID:n?"xAxisCompare":void 0}),r.push({show_legend:!n&&!_})})),{data:o,dataExtras:r}}},{kind:"get",static:!0,key:"styles",value:function(){return r.AH`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`}}]}}),(0,_.E)(r.WF));a()}catch(t){a(t)}}))},61310:(t,e,s)=>{s.d(e,{f:()=>n});var a=s(30429),i=s(59613);function n(t,e){const s=(0,a.a)(t);return isNaN(e)?(0,i.w)(t,NaN):e?(s.setDate(s.getDate()+e),s):s}},83324:(t,e,s)=>{s.d(e,{L:()=>n});var a=s(31293),i=s(3941);function n(t,e){return(0,a.A)(t,e*i.s0)}},31293:(t,e,s)=>{s.d(e,{A:()=>n});var a=s(30429),i=s(59613);function n(t,e){const s=+(0,a.a)(t);return(0,i.w)(t,s+e)}},39902:(t,e,s)=>{s.d(e,{P:()=>n});var a=s(30429),i=s(59613);function n(t,e){const s=(0,a.a)(t);if(isNaN(e))return(0,i.w)(t,NaN);if(!e)return s;const n=s.getDate(),o=(0,i.w)(t,s.getTime());o.setMonth(s.getMonth()+e+1,0);return n>=o.getDate()?o:(s.setFullYear(o.getFullYear(),o.getMonth(),n),s)}},24226:(t,e,s)=>{s.d(e,{z:()=>i});var a=s(30429);function i(t,e){const s=(0,a.a)(t),i=(0,a.a)(e),n=s.getTime()-i.getTime();return n<0?-1:n>0?1:n}},6711:(t,e,s)=>{s.d(e,{M:()=>o});var a=s(48240),i=s(3941),n=s(27320);function o(t,e,s){const o=(0,n.b)(t,e)/i.s0;return(0,a.u)(s?.roundingMethod)(o)}},27320:(t,e,s)=>{s.d(e,{b:()=>i});var a=s(30429);function i(t,e){return+(0,a.a)(t)-+(0,a.a)(e)}},72730:(t,e,s)=>{s.d(e,{W:()=>r});var a=s(24226),i=s(30429);function n(t,e){const s=(0,i.a)(t),a=(0,i.a)(e);return 12*(s.getFullYear()-a.getFullYear())+(s.getMonth()-a.getMonth())}var o=s(91103);function r(t,e){const s=(0,i.a)(t),r=(0,i.a)(e),d=(0,a.z)(s,r),c=Math.abs(n(s,r));let u;if(c<1)u=0;else{1===s.getMonth()&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-d*c);let e=(0,a.z)(s,r)===-d;(0,o.c)((0,i.a)(t))&&1===c&&1===(0,a.z)(t,r)&&(e=!1),u=d*(c-Number(e))}return 0===u?0:u}},60132:(t,e,s)=>{s.d(e,{D:()=>i});var a=s(30429);function i(t){const e=(0,a.a)(t);return e.setHours(23,59,59,999),e}},12152:(t,e,s)=>{s.d(e,{p:()=>i});var a=s(30429);function i(t){const e=(0,a.a)(t),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}},75697:(t,e,s)=>{s.d(e,{o:()=>i});var a=s(60132);function i(){return(0,a.D)(Date.now())}},77301:(t,e,s)=>{s.d(e,{e:()=>i});var a=s(30429);function i(t){return 1===(0,a.a)(t).getDate()}},91103:(t,e,s)=>{s.d(e,{c:()=>o});var a=s(60132),i=s(12152),n=s(30429);function o(t){const e=(0,n.a)(t);return+(0,a.D)(e)==+(0,i.p)(e)}},79784:(t,e,s)=>{s.d(e,{R:()=>i});var a=s(63165);function i(){return(0,a.o)(Date.now())}},65513:(t,e,s)=>{s.d(e,{O:()=>i});var a=s(83324);function i(t,e){return(0,a.L)(t,-e)}}};
//# sourceMappingURL=4624.MQZQPO84a70.js.map