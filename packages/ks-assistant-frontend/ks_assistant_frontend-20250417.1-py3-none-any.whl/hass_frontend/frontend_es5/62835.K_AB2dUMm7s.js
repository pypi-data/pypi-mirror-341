"use strict";(self.webpackChunkks_assistant_frontend=self.webpackChunkks_assistant_frontend||[]).push([[62835],{20712:function(e,t,a){a.d(t,{E:function(){return l}});var n=a(64782),r=a(35806),s=a(71008),i=a(62193),o=a(2816),c=a(27927),u=a(35890),d=(a(81027),a(82386),a(95737),a(39790),a(66457),a(36604),a(253),a(4525),a(96858),a(29818)),l=function(e){var t=(0,c.A)(null,(function(e,t){var a=function(t){function a(){var t;(0,s.A)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=(0,i.A)(this,a,[].concat(r)),e(t),t}return(0,o.A)(a,t),(0,r.A)(a)}(t);return{F:a,d:[{kind:"field",decorators:[(0,d.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,u.A)(a,"connectedCallback",this,3)([]),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,u.A)(a,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){var e=this.__unsubs.pop();e instanceof Promise?e.then((function(e){return e()})):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,u.A)(a,"updated",this,3)([e]),e.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps){var t,r=(0,n.A)(e.keys());try{for(r.s();!(t=r.n()).done;){var s=t.value;if(this.hassSubscribeRequiredHostProps.includes(s))return void this.__checkSubscribed()}}catch(i){r.e(i)}finally{r.f()}}}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){var e,t=this;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((function(e){return void 0===t[e]}))||(this.__unsubs=this.hassSubscribe())}}]}}),e);return t}},23469:function(e,t,a){a.d(t,{g:function(){return s}});a(79641);var n=a(3254),r=a(92164);function s(e,t,a,s,i,o){var c=e.getPropertyValue(i+"-"+o).trim(),u=c.length>0?c:e.getPropertyValue(i).trim(),d=(0,n.RQ)(u);return 0===c.length&&o&&(d=(0,n.v2)((0,n.BE)(t?(0,r.T)((0,n.Nc)((0,n.xp)(d)),o):(0,r.d)((0,n.Nc)((0,n.xp)(d)),o)))),s?d+=a?"32":"7F":a&&(d+="7F"),d}},37334:function(e,t,a){var n=a(22858).A,r=a(33994).A;a.a(e,function(){var e=n(r().mark((function e(n,s){var i,o,c,u,d,l,h,f,p,v,g,k,b;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,b=function(e,t,a,n,r,s,i){var o=(0,u.c)(t,e),c=void 0!==s&&void 0!==i;if(c&&o<=35){var v=(0,d.M)(t,e),g=(0,d.M)(i,s);g>v?t=(0,l.L)(t,g-v):v>g&&(i=(0,l.L)(i,v-g))}var b={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:e.getTime(),max:k(o,t),adapters:{date:{locale:a,config:n}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:function(e){return e.tick&&e.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:o>35?"monthyear":o>7?"date":o>2?"weekday":o>0?"datetime":"hour",minUnit:o>35?"month":o>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:r},ticks:{beginAtZero:!0,callback:function(e){return(0,h.ZV)(Math.abs(e),a)}}}},plugins:{tooltip:{position:"nearest",filter:function(e){return"0"!==e.formattedValue},itemSort:function(e,t){return t.datasetIndex-e.datasetIndex},callbacks:{title:function(e){if(o>0)return e[0].label;var t=new Date(e[0].parsed.x);return"".concat(c?"".concat((0,f.sl)(t,a,n),": "):"").concat((0,p.fU)(t,a,n)," â€“ ").concat((0,p.fU)((0,l.L)(t,1),a,n))},label:function(e){return"".concat(e.dataset.label,": ").concat((0,h.ZV)(e.parsed.y,a)," ").concat(r)}}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,h.Yf)(a)};return c&&(b.scales.xAxisCompare=Object.assign(Object.assign({},b.scales.x),{},{suggestedMin:s.getTime(),max:k(o,i),display:!1})),b},k=function(e,t){var a=new Date(t);return e>2&&0===a.getHours()&&(a=(0,c.O)(a,1)),a.setMinutes(0,0,0),e>35&&a.setDate(1),e>2&&a.setHours(0),a.getTime()},a.d(t,{o:function(){return b}}),i=a(81027),o=a(26098),c=a(65513),u=a(31195),d=a(6711),l=a(83324),h=a(57636),f=a(57289),p=a(41924),!(v=n([h,f,p])).then){e.next=23;break}return e.next=19,v;case 19:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=24;break;case 23:e.t0=v;case 24:g=e.t0,h=g[0],f=g[1],p=g[2],s(),e.next=34;break;case 31:e.prev=31,e.t2=e.catch(0),s(e.t2);case 34:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,a){return e.apply(this,arguments)}}())},62835:function(e,t,a){var n=a(22858).A,r=a(33994).A;a.a(e,function(){var e=n(r().mark((function e(n,s){var i,o,c,u,d,l,h,f,p,v,g,k,b,y,_,m,x,A,S,w,C,D,O,M,j,R,E,P,H,z,q,F,V,T,Z,I,W,U,L,N,$,B,G,Q,Y;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a.r(t),a.d(t,{HuiEnergySolarGraphCard:function(){return Y}}),i=a(658),o=a(33994),c=a(41981),u=a(22858),d=a(64782),l=a(64599),h=a(35806),f=a(71008),p=a(62193),v=a(2816),g=a(27927),k=a(81027),b=a(13025),y=a(89655),_=a(29193),m=a(26098),x=a(99471),A=a(39790),S=a(253),w=a(2075),C=a(54846),D=a(4525),O=a(66555),M=a(79784),j=a(75697),R=a(5343),E=a(31195),P=a(15112),H=a(29818),z=a(85323),q=a(94100),F=a(23469),V=a(57636),a(90701),a(13082),T=a(47076),Z=a(4826),I=a(20712),W=a(7934),U=a(37334),!(L=n([V,T,U])).then){e.next=63;break}return e.next=59,L;case 59:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=64;break;case 63:e.t0=L;case 64:N=e.t0,V=N[0],T=N[1],U=N[2],Y=(0,g.A)([(0,H.EM)("hui-energy-solar-graph-card")],(function(e,t){var a,n=function(t){function a(){var t;(0,f.A)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t=(0,p.A)(this,a,[].concat(r)),e(t),t}return(0,v.A)(a,t),(0,h.A)(a)}(t);return{F:n,d:[{kind:"field",decorators:[(0,H.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,H.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,H.wk)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,H.wk)()],key:"_start",value:function(){return(0,M.R)()}},{kind:"field",decorators:[(0,H.wk)()],key:"_end",value:function(){return(0,j.o)()}},{kind:"field",decorators:[(0,H.wk)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,H.wk)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:function(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e,t=this;return[(0,T.tb)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((function(e){return t._getStatistics(e)}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,W.xP)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,P.qy)($||($=(0,l.A)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,P.qy)(B||(B=(0,l.A)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,z.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.length?"":(0,P.qy)(G||(G=(0,l.A)(['<div class="no-data"> '," </div>"])),(0,R.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):P.s6}},{kind:"field",key:"_createOptions",value:function(){var e=this;return(0,q.A)((function(t,a,n,r,s,i){var o=(0,U.o)(t,a,n,r,"kWh",s,i);return Object.assign(Object.assign({},o),{},{plugins:Object.assign(Object.assign({},o.plugins),{},{tooltip:Object.assign(Object.assign({},o.plugins.tooltip),{},{callbacks:Object.assign(Object.assign({},o.plugins.tooltip.callbacks),{},{footer:function(t){var a=t.filter((function(e){var t;return"solar"===(null===(t=e.dataset)||void 0===t?void 0:t.stack)}));if(a.length<2)return[];var r,s=0,i=(0,d.A)(a);try{for(i.s();!(r=i.n()).done;){var o=r.value;s+=o.dataset.data[o.dataIndex].y}}catch(c){i.e(c)}finally{i.f()}return 0===s?[]:[e.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.total_produced",{num:(0,V.ZV)(s,n)})]}})})}),elements:{line:{tension:.3,borderWidth:1.5},bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:5}}})}))}},{kind:"method",key:"_getStatistics",value:(a=(0,u.A)((0,o.A)().mark((function e(t){var a,n,r,s;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.prefs.energy_sources.filter((function(e){return"solar"===e.type}))).some((function(e){var t;return null===(t=e.config_entry_solar_forecast)||void 0===t?void 0:t.length}))){e.next=10;break}return e.prev=2,e.next=5,(0,T.al)(this.hass);case 5:n=e.sent,e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:r=[],s=getComputedStyle(this),r.push.apply(r,(0,c.A)(this._processDataSet(t.stats,t.statsMetadata,a,s))),t.statsCompare&&(r.push({order:0,data:[]}),r.push({order:999,data:[],xAxisID:"xAxisCompare"}),r.push.apply(r,(0,c.A)(this._processDataSet(t.statsCompare,t.statsMetadata,a,s,!0)))),n&&r.push.apply(r,(0,c.A)(this._processForecast(t.statsMetadata,n,a,s.getPropertyValue("--primary-text-color"),t.start,t.end))),this._start=t.start,this._end=t.end||(0,j.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,this._chartData={datasets:r};case 20:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e){return a.apply(this,arguments)})},{kind:"method",key:"_processDataSet",value:function(e,t,a,n){var r=this,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=[];return a.forEach((function(a,o){var c=null,u=[];if(a.stat_energy_from in e){var l,h,f=e[a.stat_energy_from],p=(0,d.A)(f);try{for(p.s();!(h=p.n()).done;){var v=h.value;if(null!==v.change&&void 0!==v.change&&c!==v.start){var g=new Date(v.start);u.push({x:g.getTime(),y:v.change}),c=v.start,l=v.end}}}catch(k){p.e(k)}finally{p.f()}1===u.length&&u.push({x:l,y:0})}i.push({label:r.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.production",{name:(0,Z.$O)(r.hass,a.stat_energy_from,t[a.stat_energy_from])}),borderColor:(0,F.g)(n,r.hass.themes.darkMode,!1,s,"--energy-solar-color",o),backgroundColor:(0,F.g)(n,r.hass.themes.darkMode,!0,s,"--energy-solar-color",o),data:u,order:1,stack:"solar",xAxisID:s?"xAxisCompare":void 0})})),i}},{kind:"method",key:"_processForecast",value:function(e,t,a,n,r,s){var o=this,c=[],u=(0,E.c)(s||new Date,r);return a.forEach((function(a){if(a.config_entry_solar_forecast){var d={};if(a.config_entry_solar_forecast.forEach((function(e){t[e]&&Object.entries(t[e].wh_hours).forEach((function(e){var t=(0,i.A)(e,2),a=t[0],n=t[1],o=new Date(a);if(!(o<r||s&&o>s)){u>35&&o.setDate(1),u>2?o.setHours(0,0,0,0):o.setMinutes(0,0,0);var c=o.getTime();c in d?d[c]+=n:d[c]=n}}))})),d){for(var l=[],h=0,f=Object.entries(d);h<f.length;h++){var p=(0,i.A)(f[h],2),v=p[0],g=p[1];l.push({x:Number(v),y:g/1e3})}l.length&&c.push({type:"line",label:o.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.forecast",{name:(0,Z.$O)(o.hass,a.stat_energy_from,e[a.stat_energy_from])}),fill:!1,stepped:!1,borderColor:n,borderDash:[7,5],pointRadius:0,data:l})}}})),c}},{kind:"get",static:!0,key:"styles",value:function(){return(0,P.AH)(Q||(Q=(0,l.A)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}"])))}}]}}),(0,I.E)(P.WF)),s(),e.next=75;break;case 72:e.prev=72,e.t2=e.catch(0),s(e.t2);case 75:case"end":return e.stop()}}),e,null,[[0,72]])})));return function(t,a){return e.apply(this,arguments)}}())}}]);
//# sourceMappingURL=62835.K_AB2dUMm7s.js.map